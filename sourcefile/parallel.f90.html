<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A High-Accuracy PIC Code for the Maxwell-Vlasov Equations">
    
    <meta name="author" content="The ALaDyn Collaboration" >
    <link rel="icon" href="../favicon.png">

    <title>parallel.F90 &ndash; ALaDyn</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">ALaDyn <small>3.0.1</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Guide</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/aladyn.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/aladyn.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>parallel.F90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 2.9% of total for source files.">724 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/parallel.F90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">parallel.F90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/parallel.html">parallel</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/parallel.f90.html#src">parallel.F90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~parallel.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileparallelf90EfferentGraph" width="494pt" height="133pt"
 viewBox="0.00 0.00 494.00 133.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~parallel.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 129)">
<title>sourcefile~~parallel.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-129 490,-129 490,4 -4,4"/>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~parallel.f90</title>
<polygon fill="none" stroke="#000000" points="486,-75 410,-75 410,-51 486,-51 486,-75"/>
<text text-anchor="middle" x="448" y="-60.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">parallel.F90</text>
</g>
<!-- sourcefile~common_param.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~common_param.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/common_param.f90.html" xlink:title="common_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="263,-125 142,-125 142,-101 263,-101 263,-125"/>
<text text-anchor="middle" x="202.5" y="-110.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">common_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M409.7964,-74.7001C398.3508,-77.9723 385.7241,-81.3535 374,-84 341.0417,-91.4398 304.1316,-97.9161 273.0204,-102.8499"/>
<polygon fill="#ff0000" stroke="#ff0000" points="272.474,-99.3927 263.1354,-104.3968 273.5564,-106.3085 272.474,-99.3927"/>
</g>
<!-- sourcefile~util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~util.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/util.f90.html" xlink:title="util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="363.5,-75 309.5,-75 309.5,-51 363.5,-51 363.5,-75"/>
<text text-anchor="middle" x="336.5" y="-60.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M409.9399,-63C398.3476,-63 385.6169,-63 374.058,-63"/>
<polygon fill="#ff0000" stroke="#ff0000" points="373.8385,-59.5001 363.8384,-63 373.8384,-66.5001 373.8385,-59.5001"/>
</g>
<!-- sourcefile~mpi_var.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~mpi_var.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/mpi_var.f90.html" xlink:title="mpi_var.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="374,-24 299,-24 299,0 374,0 374,-24"/>
<text text-anchor="middle" x="336.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_var.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M421.5761,-50.9137C406.8258,-44.1669 388.2466,-35.6689 372.2163,-28.3366"/>
<polygon fill="#ff0000" stroke="#ff0000" points="373.6704,-25.153 363.1207,-24.1763 370.7587,-31.5187 373.6704,-25.153"/>
</g>
<!-- sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~precision_def.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/precision_def.f90.html" xlink:title="precision_def.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="106,-65 0,-65 0,-41 106,-41 106,-65"/>
<text text-anchor="middle" x="53" y="-50.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">precision_def.F90</text>
</a>
</g>
</g>
<!-- sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M172.2464,-100.8581C149.2731,-91.638 117.4835,-78.8797 92.5041,-68.8545"/>
<polygon fill="#ff0000" stroke="#ff0000" points="93.5372,-65.4978 82.9531,-65.0213 90.9299,-71.9941 93.5372,-65.4978"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M309.3168,-62.0412C265.2319,-60.4861 176.9886,-57.3735 116.4734,-55.2389"/>
<polygon fill="#00ff00" stroke="#00ff00" points="116.3803,-51.7336 106.2631,-54.8788 116.1334,-58.7292 116.3803,-51.7336"/>
</g>
<!-- sourcefile~code_util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~code_util.f90</title>
<g id="a_sourcefile~~parallel.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/code_util.f90.html" xlink:title="code_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="243,-45 162,-45 162,-21 243,-21 243,-45"/>
<text text-anchor="middle" x="202.5" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">code_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M309.3831,-56.9291C293.1674,-53.2987 272.0512,-48.5712 252.8746,-44.2779"/>
<polygon fill="#00ff00" stroke="#00ff00" points="253.5826,-40.8498 243.0595,-42.0805 252.0533,-47.6807 253.5826,-40.8498"/>
</g>
<!-- sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M298.6996,-7.2611C259.1283,-3.396 195.4338,-.2839 142,-12 120.6882,-16.6729 98.3929,-26.9538 81.4482,-36.051"/>
<polygon fill="#0000ff" stroke="#0000ff" points="79.6756,-33.0318 72.6252,-40.9401 83.0685,-39.1546 79.6756,-33.0318"/>
</g>
<!-- sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~parallel.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M161.6485,-38.4651C147.6065,-40.3436 131.5398,-42.493 116.1461,-44.5524"/>
<polygon fill="#00ffff" stroke="#00ffff" points="115.603,-41.0938 106.1554,-45.8889 116.5312,-48.0319 115.603,-41.0938"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~parallel.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileparallelf90AfferentGraph" width="641pt" height="342pt"
 viewBox="0.00 0.00 641.00 341.93" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~parallel.f90~~AfferentGraph" class="graph" transform="scale(.7436 .7436) rotate(0) translate(4 455.8212)">
<title>sourcefile~~parallel.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-455.8212 858,-455.8212 858,4 -4,4"/>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~parallel.f90</title>
<polygon fill="none" stroke="#000000" points="76,-305.2775 0,-305.2775 0,-281.2775 76,-281.2775 76,-305.2775"/>
<text text-anchor="middle" x="38" y="-290.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">parallel.F90</text>
</g>
<!-- sourcefile~pic_dump.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~pic_dump.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/pic_dump.f90.html" xlink:title="pic_dump.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="198.5,-449.2775 113.5,-449.2775 113.5,-425.2775 198.5,-425.2775 198.5,-449.2775"/>
<text text-anchor="middle" x="156" y="-434.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_dump.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_dump.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~pic_dump.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M141.8897,-425.0133C132.93,-416.9415 121.3111,-405.9335 112,-395.2775 88.8017,-368.7282 65.486,-335.1848 51.3936,-313.9736"/>
<polygon fill="#ff0000" stroke="#ff0000" points="54.1932,-311.8609 45.7735,-305.4298 48.345,-315.7078 54.1932,-311.8609"/>
</g>
<!-- sourcefile~prl_fft.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~prl_fft.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/prl_fft.f90.html" xlink:title="prl_fft.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="188,-386.2775 124,-386.2775 124,-362.2775 188,-362.2775 188,-386.2775"/>
<text text-anchor="middle" x="156" y="-371.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">prl_fft.f90</text>
</a>
</g>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M135.6336,-362.2456C128.1219,-357.6866 119.5942,-352.3665 112,-347.2775 95.0413,-335.913 76.4849,-322.369 62.1964,-311.6882"/>
<polygon fill="#ff0000" stroke="#ff0000" points="64,-308.6653 53.9039,-305.453 59.7932,-314.2602 64,-308.6653"/>
</g>
<!-- sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~grid_fields.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/grid_fields.f90.html" xlink:title="grid_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="200,-305.2775 112,-305.2775 112,-281.2775 200,-281.2775 200,-305.2775"/>
<text text-anchor="middle" x="156" y="-290.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M111.7254,-293.2775C103.4497,-293.2775 94.7611,-293.2775 86.3692,-293.2775"/>
<polygon fill="#ff0000" stroke="#ff0000" points="86.3278,-289.7776 76.3278,-293.2775 86.3277,-296.7776 86.3278,-289.7776"/>
</g>
<!-- sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~mpi_field_interface.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/mpi_field_interface.f90.html" xlink:title="mpi_field_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="371,-265.2775 236,-265.2775 236,-241.2775 371,-241.2775 371,-265.2775"/>
<text text-anchor="middle" x="303.5" y="-250.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_field_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M285.2959,-241.0782C256.9427,-223.6998 200.835,-195.8548 156,-214.2775"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node6" class="node">
<title>sourcefile~mpi_curr_interface.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node6"><a xlink:href=".././sourcefile/mpi_curr_interface.f90.html" xlink:title="mpi_curr_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="370,-345.2775 237,-345.2775 237,-321.2775 370,-321.2775 370,-345.2775"/>
<text text-anchor="middle" x="303.5" y="-330.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_curr_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M236.6152,-329.5654C199.6474,-326.783 153.0287,-322.0704 112,-314.2775 103.3255,-312.6298 94.1956,-310.4325 85.4243,-308.0793"/>
<polygon fill="#ff0000" stroke="#ff0000" points="86.2892,-304.687 75.7168,-305.3772 84.412,-311.4307 86.2892,-304.687"/>
</g>
<!-- sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node7" class="node">
<title>sourcefile~mpi_part_interface.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node7"><a xlink:href=".././sourcefile/mpi_part_interface.f90.html" xlink:title="mpi_part_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="370,-143.2775 237,-143.2775 237,-119.2775 370,-119.2775 370,-143.2775"/>
<text text-anchor="middle" x="303.5" y="-128.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_part_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_part_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~mpi_part_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M256.8688,-143.3724C249.7069,-145.9124 242.53,-148.874 236,-152.2775 196.1096,-173.0684 197.6078,-197.1808 156,-214.2775"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M156,-214.2775C119.4015,-229.3158 82.3129,-256.549 59.7339,-274.7753"/>
<polygon fill="#ff0000" stroke="#ff0000" points="57.3268,-272.2231 51.8219,-281.2756 61.7705,-277.6318 57.3268,-272.2231"/>
</g>
<!-- sourcefile~pic_out.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node8" class="node">
<title>sourcefile~pic_out.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node8"><a xlink:href=".././sourcefile/pic_out.f90.html" xlink:title="pic_out.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="191.5,-108.2775 120.5,-108.2775 120.5,-84.2775 191.5,-84.2775 191.5,-108.2775"/>
<text text-anchor="middle" x="156" y="-93.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_out.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge7" class="edge">
<title>sourcefile~pic_out.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M148.7962,-108.3041C129.2525,-140.9322 75.0506,-231.4218 50.4412,-272.5069"/>
<polygon fill="#ff0000" stroke="#ff0000" points="47.3955,-270.7806 45.2595,-281.1579 53.4006,-274.3776 47.3955,-270.7806"/>
</g>
<!-- sourcefile~diag_part_and_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node9" class="node">
<title>sourcefile~diag_part_and_fields.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node9"><a xlink:href=".././sourcefile/diag_part_and_fields.f90.html" xlink:title="diag_part_and_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="742,-66.2775 600,-66.2775 600,-42.2775 742,-42.2775 742,-66.2775"/>
<text text-anchor="middle" x="671" y="-51.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">diag_part_and_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~diag_part_and_fields.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge8" class="edge">
<title>sourcefile~diag_part_and_fields.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M633.6028,-42.1845C535.6723,-13.0572 268.5033,49.7362 112,-75.2775 80.5062,-100.4345 52.7026,-221.278 42.3247,-271.4101"/>
<polygon fill="#ff0000" stroke="#ff0000" points="38.8893,-270.7408 40.3272,-281.2376 45.749,-272.1351 38.8893,-270.7408"/>
</g>
<!-- sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node10" class="node">
<title>sourcefile~run_data_info.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node10"><a xlink:href=".././sourcefile/run_data_info.f90.html" xlink:title="run_data_info.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="356.5,-185.2775 250.5,-185.2775 250.5,-161.2775 356.5,-161.2775 356.5,-185.2775"/>
<text text-anchor="middle" x="303.5" y="-170.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">run_data_info.f90</text>
</a>
</g>
</g>
<!-- sourcefile~run_data_info.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge9" class="edge">
<title>sourcefile~run_data_info.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M250.2627,-184.832C221.7565,-191.8215 186.3613,-201.802 156,-214.2775"/>
</g>
<!-- sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node11" class="node">
<title>sourcefile~pic_out_util.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node11"><a xlink:href=".././sourcefile/pic_out_util.f90.html" xlink:title="pic_out_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="532,-347.2775 439,-347.2775 439,-323.2775 532,-323.2775 532,-347.2775"/>
<text text-anchor="middle" x="485.5" y="-332.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_out_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge16" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M438.7272,-324.9944C428.1116,-322.0508 417.0181,-318.4775 407,-314.2775 379.0178,-302.5462 349.4163,-284.45 329.0715,-271.0108"/>
<polygon fill="#00ff00" stroke="#00ff00" points="330.9378,-268.0483 320.6829,-265.3862 327.0395,-273.8623 330.9378,-268.0483"/>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge21" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#00ffa9" stroke-dasharray="5,2" d="M438.6305,-334.7624C420.8721,-334.5673 400.1552,-334.3396 380.3542,-334.122"/>
<polygon fill="#00ffa9" stroke="#00ffa9" points="380.1415,-330.6196 370.1036,-334.0094 380.0645,-337.6191 380.1415,-330.6196"/>
</g>
<!-- sourcefile~psolve.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node21" class="node">
<title>sourcefile~psolve.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node21"><a xlink:href=".././sourcefile/psolve.f90.html" xlink:title="psolve.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="337,-387.2775 270,-387.2775 270,-363.2775 337,-363.2775 337,-387.2775"/>
<text text-anchor="middle" x="303.5" y="-372.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">psolve.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~psolve.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge44" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~psolve.f90</title>
<path fill="none" stroke="#ff008b" stroke-dasharray="5,2" d="M438.6305,-345.5785C410.3957,-351.7839 374.6823,-359.633 347.0622,-365.7034"/>
<polygon fill="#ff008b" stroke="#ff008b" points="346.2969,-362.2879 337.2813,-367.853 347.7996,-369.1248 346.2969,-362.2879"/>
</g>
<!-- sourcefile~start_all.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node12" class="node">
<title>sourcefile~start_all.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node12"><a xlink:href=".././sourcefile/start_all.f90.html" xlink:title="start_all.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="709.5,-419.2775 632.5,-419.2775 632.5,-395.2775 709.5,-395.2775 709.5,-419.2775"/>
<text text-anchor="middle" x="671" y="-404.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">start_all.F90</text>
</a>
</g>
</g>
<!-- sourcefile~start_all.f90&#45;&gt;sourcefile~pic_dump.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge10" class="edge">
<title>sourcefile~start_all.f90&#45;&gt;sourcefile~pic_dump.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M640.6651,-419.2997C619.5479,-427.0026 590.5274,-436.2797 564,-440.2775 437.6398,-459.3204 286.7615,-450.0349 208.6692,-442.8899"/>
<polygon fill="#ff0000" stroke="#ff0000" points="208.8834,-439.3947 198.5997,-441.9433 208.2281,-446.364 208.8834,-439.3947"/>
</g>
<!-- sourcefile~start_all.f90&#45;&gt;sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge29" class="edge">
<title>sourcefile~start_all.f90&#45;&gt;sourcefile~run_data_info.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M635.7277,-395.1171C623.0526,-389.2757 609.5451,-381.1337 600,-370.2775 569.3612,-335.4299 598.6355,-303.1558 564,-272.2775 510.4117,-224.5023 473.5367,-261.2411 407,-234.2775 378.7111,-222.8135 348.9425,-204.5223 328.6304,-190.9557"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="330.5093,-188.001 320.2697,-185.2807 326.578,-193.7928 330.5093,-188.001"/>
</g>
<!-- sourcefile~pic_in.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node22" class="node">
<title>sourcefile~pic_in.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node22"><a xlink:href=".././sourcefile/pic_in.f90.html" xlink:title="pic_in.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="517.5,-431.2775 453.5,-431.2775 453.5,-407.2775 517.5,-407.2775 517.5,-431.2775"/>
<text text-anchor="middle" x="485.5" y="-416.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_in.f90</text>
</a>
</g>
</g>
<!-- sourcefile~start_all.f90&#45;&gt;sourcefile~pic_in.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge46" class="edge">
<title>sourcefile~start_all.f90&#45;&gt;sourcefile~pic_in.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M632.1131,-409.7931C601.5693,-411.7689 559.0993,-414.5163 527.7274,-416.5458"/>
<polygon fill="#ff0000" stroke="#ff0000" points="527.3002,-413.066 517.547,-417.2043 527.7521,-420.0514 527.3002,-413.066"/>
</g>
<!-- sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node13" class="node">
<title>sourcefile~curr_and_fields_util.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node13"><a xlink:href=".././sourcefile/curr_and_fields_util.f90.html" xlink:title="curr_and_fields_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="553.5,-305.2775 417.5,-305.2775 417.5,-281.2775 553.5,-281.2775 553.5,-305.2775"/>
<text text-anchor="middle" x="485.5" y="-290.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">curr_and_fields_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge15" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M417.2274,-293.2775C355.8276,-293.2775 266.8242,-293.2775 210.1896,-293.2775"/>
<polygon fill="#aaff00" stroke="#aaff00" points="210.0053,-289.7776 200.0053,-293.2775 210.0053,-296.7776 210.0053,-289.7776"/>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge17" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M430.894,-281.2761C411.1881,-276.9452 388.7561,-272.0151 368.2648,-267.5115"/>
<polygon fill="#00ff00" stroke="#00ff00" points="368.9,-264.0676 358.3818,-265.3394 367.3973,-270.9044 368.9,-264.0676"/>
</g>
<!-- sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge22" class="edge">
<title>sourcefile~curr_and_fields_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#00ffa9" stroke-dasharray="5,2" d="M430.894,-305.2788C411.1881,-309.6098 388.7561,-314.5399 368.2648,-319.0434"/>
<polygon fill="#00ffa9" stroke="#00ffa9" points="367.3973,-315.6505 358.3818,-321.2155 368.9,-322.4873 367.3973,-315.6505"/>
</g>
<!-- sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node14" class="node">
<title>sourcefile~init_beam_part_distrib.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node14"><a xlink:href=".././sourcefile/init_beam_part_distrib.f90.html" xlink:title="init_beam_part_distrib.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="561,-389.2775 410,-389.2775 410,-365.2775 561,-365.2775 561,-389.2775"/>
<text text-anchor="middle" x="485.5" y="-374.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">init_beam_part_distrib.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge18" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M424.6994,-365.1731C418.4796,-362.7298 412.4522,-359.7971 407,-356.2775 385.7719,-342.5739 388.5731,-330.4325 371,-312.2775 357.1052,-297.9224 340.1743,-283.1298 326.7452,-271.9473"/>
<polygon fill="#00ff00" stroke="#00ff00" points="328.8404,-269.1388 318.8946,-265.4874 324.3925,-274.5441 328.8404,-269.1388"/>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge23" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#00ffa9" stroke-dasharray="5,2" d="M435.7677,-365.2543C413.2973,-359.8219 386.5678,-353.3598 363.0385,-347.6714"/>
<polygon fill="#00ffa9" stroke="#00ffa9" points="363.7146,-344.2341 353.1722,-345.2861 362.0697,-351.0381 363.7146,-344.2341"/>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge45" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90</title>
<path fill="none" stroke="#ff008b" stroke-dasharray="5,2" d="M409.8967,-376.4467C388.6364,-376.213 366.2212,-375.9667 347.4765,-375.7607"/>
<polygon fill="#ff008b" stroke="#ff008b" points="347.5089,-372.261 337.471,-375.6508 347.4319,-379.2605 347.5089,-372.261"/>
</g>
<!-- sourcefile~window.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node15" class="node">
<title>sourcefile~window.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node15"><a xlink:href=".././sourcefile/window.f90.html" xlink:title="window.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="521.5,-183.2775 449.5,-183.2775 449.5,-159.2775 521.5,-159.2775 521.5,-183.2775"/>
<text text-anchor="middle" x="485.5" y="-168.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">window.f90</text>
</a>
</g>
</g>
<!-- sourcefile~window.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge19" class="edge">
<title>sourcefile~window.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M449.2573,-178.7942C435.7259,-182.1625 420.4009,-186.6593 407,-192.2775 379.0178,-204.0087 349.4163,-222.1049 329.0715,-235.5441"/>
<polygon fill="#00ff00" stroke="#00ff00" points="327.0395,-232.6926 320.6829,-241.1687 330.9378,-238.5066 327.0395,-232.6926"/>
</g>
<!-- sourcefile~window.f90&#45;&gt;sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge26" class="edge">
<title>sourcefile~window.f90&#45;&gt;sourcefile~mpi_part_interface.f90</title>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M449.107,-163.279C425.9174,-158.1824 395.2202,-151.4358 367.992,-145.4515"/>
<polygon fill="#00a9ff" stroke="#00a9ff" points="368.656,-142.014 358.1378,-143.2858 367.1534,-148.8508 368.656,-142.014"/>
</g>
<!-- sourcefile~window.f90&#45;&gt;sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge31" class="edge">
<title>sourcefile~window.f90&#45;&gt;sourcefile~run_data_info.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M449.107,-171.6774C425.6512,-171.9351 394.5144,-172.2773 367.0556,-172.579"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="366.6964,-169.0827 356.7355,-172.6925 366.7734,-176.0823 366.6964,-169.0827"/>
</g>
<!-- sourcefile~env_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node16" class="node">
<title>sourcefile~env_evolve_in_time.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node16"><a xlink:href=".././sourcefile/env_evolve_in_time.f90.html" xlink:title="env_evolve_in_time.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="739.5,-225.2775 602.5,-225.2775 602.5,-201.2775 739.5,-201.2775 739.5,-225.2775"/>
<text text-anchor="middle" x="671" y="-210.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">env_evolve_in_time.f90</text>
</a>
</g>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge24" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90</title>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M617.5456,-201.1563C611.3895,-198.7027 605.394,-195.7721 600,-192.2775 579.3664,-178.9097 582.0707,-166.9476 564,-150.2775 532.3088,-121.0425 528.1811,-99.388 485.5,-93.2775"/>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge34" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M642.8265,-225.4277C610.7719,-239.2519 558.2883,-261.8863 522.8447,-277.1719"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="521.1272,-274.1009 513.3308,-281.275 523.8993,-280.5287 521.1272,-274.1009"/>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~window.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge37" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~window.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M617.8431,-201.2419C590.6231,-195.0789 557.802,-187.6477 531.6549,-181.7276"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="532.15,-178.2512 521.6239,-179.4565 530.6041,-185.0784 532.15,-178.2512"/>
</g>
<!-- sourcefile~fluid_density_momenta.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node20" class="node">
<title>sourcefile~fluid_density_momenta.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node20"><a xlink:href=".././sourcefile/fluid_density_momenta.f90.html" xlink:title="fluid_density_momenta.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="564,-225.2775 407,-225.2775 407,-201.2775 564,-201.2775 564,-225.2775"/>
<text text-anchor="middle" x="485.5" y="-210.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fluid_density_momenta.f90</text>
</a>
</g>
</g>
<!-- sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge42" class="edge">
<title>sourcefile~env_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M602.4537,-213.2775C593.2828,-213.2775 583.7724,-213.2775 574.3166,-213.2775"/>
<polygon fill="#e700ff" stroke="#e700ff" points="574.0963,-209.7776 564.0962,-213.2775 574.0962,-216.7776 574.0963,-209.7776"/>
</g>
<!-- sourcefile~aladyn.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node17" class="node">
<title>sourcefile~aladyn.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node17"><a xlink:href=".././sourcefile/aladyn.f90.html" xlink:title="ALaDyn.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="854,-204.2775 778,-204.2775 778,-180.2775 854,-180.2775 854,-204.2775"/>
<text text-anchor="middle" x="816" y="-189.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALaDyn.F90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge27" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M797.8075,-180.2071C783.2198,-170.9652 761.9573,-158.4543 742,-150.2775 711.7728,-137.8929 702.2429,-140.8138 671,-131.2775"/>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M671,-131.2775C620.4293,-115.8417 615.5272,-91.135 564,-79.2775 435.3284,-49.6672 277.9371,-72.1373 201.7138,-86.5822"/>
<polygon fill="#0000ff" stroke="#0000ff" points="200.6594,-83.2214 191.5085,-88.5609 201.9919,-90.0934 200.6594,-83.2214"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~diag_part_and_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge28" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~diag_part_and_fields.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M804.4492,-180.0821C790.0885,-165.0349 764.6951,-138.8022 742,-117.2775 725.9077,-102.015 707.1122,-85.3879 692.9034,-73.0493"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="694.9766,-70.215 685.1226,-66.3228 690.3987,-75.5105 694.9766,-70.215"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~run_data_info.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge30" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~run_data_info.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M671,-131.2775C558.622,-96.4982 523.3979,-133.2499 407,-150.2775 391.9058,-152.4856 375.7375,-155.6744 360.7726,-158.9777"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="359.6134,-155.6514 350.6324,-161.2721 361.1583,-162.4788 359.6134,-155.6514"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge32" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M809.9798,-204.4499C793.2611,-236.6767 742.7233,-323.9544 671,-356.2775"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M671,-356.2775C648.633,-366.3574 587.8469,-357.1712 541.9041,-347.9806"/>
<polygon fill="#ff0000" stroke="#ff0000" points="542.5503,-344.5404 532.0517,-345.965 541.1473,-351.3983 542.5503,-344.5404"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~start_all.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge33" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~start_all.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M813.8807,-204.6359C807.9288,-235.9888 788.3719,-319.7148 742,-370.2775 734.3755,-378.5911 724.4497,-385.3521 714.4479,-390.7093"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="712.712,-387.6633 705.3052,-395.2389 715.8196,-393.9357 712.712,-387.6633"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge36" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M671,-356.2775C640.3376,-370.0959 604.054,-376.1622 571.7443,-378.4905"/>
<polygon fill="#5cff00" stroke="#5cff00" points="571.1747,-375.0186 561.406,-379.1202 571.6003,-382.0057 571.1747,-375.0186"/>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~env_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge39" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~env_evolve_in_time.f90</title>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M777.903,-197.795C769.1844,-199.0577 759.6017,-200.4455 749.8647,-201.8557"/>
<polygon fill="#00ffb9" stroke="#00ffb9" points="749.0866,-198.4318 739.6916,-203.329 750.09,-205.3595 749.0866,-198.4318"/>
</g>
<!-- sourcefile~pic_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node18" class="node">
<title>sourcefile~pic_evolve_in_time.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node18"><a xlink:href=".././sourcefile/pic_evolve_in_time.f90.html" xlink:title="pic_evolve_in_time.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="737.5,-183.2775 604.5,-183.2775 604.5,-159.2775 737.5,-159.2775 737.5,-183.2775"/>
<text text-anchor="middle" x="671" y="-168.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pic_evolve_in_time.f90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_evolve_in_time.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge40" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_evolve_in_time.f90</title>
<path fill="none" stroke="#002eff" stroke-dasharray="5,2" d="M777.903,-186.76C768.5557,-185.4062 758.2153,-183.9086 747.7563,-182.3939"/>
<polygon fill="#002eff" stroke="#002eff" points="748.1193,-178.91 737.7208,-180.9405 747.1159,-185.8377 748.1193,-178.91"/>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge25" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~mpi_part_interface.f90</title>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M636.4923,-159.2313C624.8306,-155.0041 611.7834,-150.1027 600,-145.2775 548.2776,-124.0974 540.8268,-101.1985 485.5,-93.2775"/>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M485.5,-93.2775C435.1182,-86.0644 377.7555,-102.1523 341.1241,-115.5744"/>
<polygon fill="#00a9ff" stroke="#00a9ff" points="339.4787,-112.4548 331.3649,-119.2679 341.9564,-119.0017 339.4787,-112.4548"/>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge35" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~curr_and_fields_util.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M617.5456,-183.3986C611.3895,-185.8522 605.394,-188.7829 600,-192.2775 579.3664,-205.6453 581.9327,-217.459 564,-234.2775 547.8418,-249.4316 527.8628,-264.4022 512.1044,-275.4714"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="510.0649,-272.6263 503.835,-281.1959 514.0492,-278.3818 510.0649,-272.6263"/>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~window.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge38" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~window.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M604.2923,-171.2775C580.2612,-171.2775 553.692,-171.2775 531.7853,-171.2775"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="531.7567,-167.7776 521.7566,-171.2775 531.7566,-174.7776 531.7567,-167.7776"/>
</g>
<!-- sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge43" class="edge">
<title>sourcefile~pic_evolve_in_time.f90&#45;&gt;sourcefile~fluid_density_momenta.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M617.8431,-183.313C596.2069,-188.2117 571.032,-193.9117 548.4828,-199.0172"/>
<polygon fill="#e700ff" stroke="#e700ff" points="547.6448,-195.6183 538.6646,-201.2402 549.1907,-202.4455 547.6448,-195.6183"/>
</g>
<!-- sourcefile~init_laser_field.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_node19" class="node">
<title>sourcefile~init_laser_field.f90</title>
<g id="a_sourcefile~~parallel.f90~~AfferentGraph_node19"><a xlink:href=".././sourcefile/init_laser_field.f90.html" xlink:title="init_laser_field.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="358,-430.2775 249,-430.2775 249,-406.2775 358,-406.2775 358,-430.2775"/>
<text text-anchor="middle" x="303.5" y="-415.8775" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">init_laser_field.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_laser_field.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge12" class="edge">
<title>sourcefile~init_laser_field.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M254.616,-406.2437C248.0527,-403.5327 241.6465,-400.2471 236,-396.2775 227.6848,-390.4317 191.6742,-342.1102 170.9122,-313.7766"/>
<polygon fill="#aaff00" stroke="#aaff00" points="173.4873,-311.3683 164.7615,-305.359 167.8353,-315.4981 173.4873,-311.3683"/>
</g>
<!-- sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge13" class="edge">
<title>sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M406.8636,-208.0037C356.4582,-207.3173 290.5046,-211.5294 236,-232.2775 212.2307,-241.3257 189.6179,-259.817 174.5366,-274.0812"/>
<polygon fill="#aaff00" stroke="#aaff00" points="172.0773,-271.5908 167.3703,-281.0826 176.9691,-276.5978 172.0773,-271.5908"/>
</g>
<!-- sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge20" class="edge">
<title>sourcefile~fluid_density_momenta.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M430.894,-225.2788C411.1881,-229.6098 388.7561,-234.5399 368.2648,-239.0434"/>
<polygon fill="#00ff00" stroke="#00ff00" points="367.3973,-235.6505 358.3818,-241.2155 368.9,-242.4873 367.3973,-235.6505"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge11" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M269.6605,-375.048C248.4186,-374.904 220.8554,-374.7172 198.1922,-374.5635"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="198.188,-371.0635 188.1645,-374.4955 198.1405,-378.0633 198.188,-371.0635"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge14" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M269.9709,-367.3571C258.8312,-364.0756 246.5783,-359.7382 236,-354.2775 214.1314,-342.9886 192.0999,-325.6465 176.71,-312.3348"/>
<polygon fill="#aaff00" stroke="#aaff00" points="178.6968,-309.4195 168.8866,-305.418 174.0602,-314.6638 178.6968,-309.4195"/>
</g>
<!-- sourcefile~pic_in.f90&#45;&gt;sourcefile~init_laser_field.f90 -->
<g id="sourcefile~~parallel.f90~~AfferentGraph_edge41" class="edge">
<title>sourcefile~pic_in.f90&#45;&gt;sourcefile~init_laser_field.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M453.381,-419.101C429.8294,-418.9716 397.0566,-418.7915 368.1609,-418.6327"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="368.1425,-415.1327 358.1233,-418.5776 368.1039,-422.1326 368.1425,-415.1327"/>
</g>
</g>
</svg>
</div><script>var pansourcefileparallelf90AfferentGraph = svgPanZoom('#sourcefileparallelf90AfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/parallel.html">parallel</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/parallel.f90.html#src">parallel.F90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-2"></a><span class="c">!                            Copyright 2008-2020  The ALaDyn Collaboration                            !</span>
<a name="ln-3"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-4"></a>
<a name="ln-5"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-6"></a><span class="c">!  This file is part of ALaDyn.                                                                       !</span>
<a name="ln-7"></a><span class="c">!                                                                                                     !</span>
<a name="ln-8"></a><span class="c">!  ALaDyn is free software: you can redistribute it and/or modify                                     !</span>
<a name="ln-9"></a><span class="c">!  it under the terms of the GNU General Public License as published by                               !</span>
<a name="ln-10"></a><span class="c">!  the Free Software Foundation, either version 3 of the License, or                                  !</span>
<a name="ln-11"></a><span class="c">!  (at your option) any later version.                                                                !</span>
<a name="ln-12"></a><span class="c">!                                                                                                     !</span>
<a name="ln-13"></a><span class="c">!  ALaDyn is distributed in the hope that it will be useful,                                          !</span>
<a name="ln-14"></a><span class="c">!  but WITHOUT ANY WARRANTY; without even the implied warranty of                                     !</span>
<a name="ln-15"></a><span class="c">!  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                      !</span>
<a name="ln-16"></a><span class="c">!  GNU General Public License for more details.                                                       !</span>
<a name="ln-17"></a><span class="c">!                                                                                                     !</span>
<a name="ln-18"></a><span class="c">!  You should have received a copy of the GNU General Public License                                  !</span>
<a name="ln-19"></a><span class="c">!  along with ALaDyn.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                                    !</span>
<a name="ln-20"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-21"></a>
<a name="ln-22"></a> <span class="k">module </span><span class="n">parallel</span>
<a name="ln-23"></a>  <span class="k">use </span><span class="n">mpi_var</span>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">common_param</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">util</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">init_random_seed</span>
<a name="ln-26"></a>
<a name="ln-27"></a><span class="cp">#if !defined (_CRESCO)</span>
<a name="ln-28"></a><span class="cp">#define ENABLE_MPI_LONG_INT</span>
<a name="ln-29"></a><span class="cp">#endif</span>
<a name="ln-30"></a>
<a name="ln-31"></a><span class="cp">#if defined (FORCE_OLD_MPI) &amp;&amp; !defined (USE_MPI_MODULE)</span>
<a name="ln-32"></a> <span class="k">implicit none</span>
<a name="ln-33"></a><span class="k"> include</span> <span class="s1">&#39;mpif.h&#39;</span>
<a name="ln-34"></a><span class="cp">#else</span>
<a name="ln-35"></a> <span class="k">use </span><span class="n">mpi</span>
<a name="ln-36"></a> <span class="k">implicit none</span>
<a name="ln-37"></a><span class="cp">#endif</span>
<a name="ln-38"></a>
<a name="ln-39"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">offset_kind</span> <span class="o">=</span> <span class="n">mpi_offset_kind</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-40"></a>    <span class="n">whence</span> <span class="o">=</span> <span class="n">mpi_seek_set</span>
<a name="ln-41"></a>
<a name="ln-42"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">mpi_err</span>
<a name="ln-43"></a>
<a name="ln-44"></a>  <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">fp0x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="n">fp1x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-45"></a>
<a name="ln-46"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">status</span><span class="p">(</span><span class="n">mpi_status_size</span><span class="p">),</span> <span class="n">error</span><span class="p">,</span> <span class="n">mpi_sd</span>
<a name="ln-47"></a>
<a name="ln-48"></a> <span class="k">contains</span>
<a name="ln-49"></a>  <span class="c">!==================</span>
<a name="ln-50"></a>
<a name="ln-51"></a>  <span class="k">subroutine </span><span class="n">check_decomposition</span>
<a name="ln-52"></a>
<a name="ln-53"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">npe_yz</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-54"></a><span class="k">    </span><span class="n">nprocy</span> <span class="o">=</span> <span class="n">npe_yz</span>
<a name="ln-55"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nz</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-56"></a><span class="k">     </span><span class="n">nprocz</span> <span class="o">=</span> <span class="n">npe_yz</span>
<a name="ln-57"></a>    <span class="k">else</span>
<a name="ln-58"></a><span class="k">     </span><span class="n">nprocz</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-59"></a>    <span class="k">end if</span>
<a name="ln-60"></a><span class="k">    </span><span class="n">nprocx</span> <span class="o">=</span> <span class="n">mpi_size</span><span class="o">/</span><span class="n">nprocy</span><span class="o">/</span><span class="n">nprocz</span>
<a name="ln-61"></a>   <span class="k">end if</span>
<a name="ln-62"></a><span class="k">   if</span> <span class="p">(</span><span class="n">nprocx</span><span class="o">&lt;</span><span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">nprocy</span><span class="o">&lt;</span><span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">nprocz</span><span class="o">&lt;</span><span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-63"></a>     <span class="n">nprocx</span><span class="o">*</span><span class="n">nprocy</span><span class="o">*</span><span class="n">nprocz</span><span class="o">/=</span><span class="n">mpi_size</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-64"></a><span class="k">    if</span> <span class="p">(</span><span class="n">mpi_rank</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-65"></a><span class="k">     write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Invalid MPI decomposition&#39;</span>
<a name="ln-66"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;mpi_size =&#39;</span><span class="p">,</span> <span class="n">mpi_size</span>
<a name="ln-67"></a>     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nprocx =&#39;</span><span class="p">,</span> <span class="n">nprocx</span><span class="p">,</span> <span class="s1">&#39;nprocy =&#39;</span><span class="p">,</span> <span class="n">nprocy</span><span class="p">,</span> <span class="s1">&#39;nprocz =&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-68"></a>       <span class="n">nprocz</span>
<a name="ln-69"></a>     <span class="k">stop </span><span class="mi">674</span>
<a name="ln-70"></a>    <span class="k">end if</span>
<a name="ln-71"></a><span class="k">   end if</span>
<a name="ln-72"></a><span class="k">  end subroutine</span>
<a name="ln-73"></a>
<a name="ln-74"></a><span class="k">  subroutine </span><span class="n">start_parallel</span><span class="p">(</span><span class="n">ncmp</span><span class="p">,</span> <span class="n">p_ind</span><span class="p">,</span> <span class="n">b_ind</span><span class="p">)</span>
<a name="ln-75"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ncmp</span><span class="p">,</span> <span class="n">p_ind</span><span class="p">,</span> <span class="n">b_ind</span>
<a name="ln-76"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">pen</span><span class="p">,</span> <span class="n">pkind</span><span class="p">,</span> <span class="n">bkind</span>
<a name="ln-77"></a>
<a name="ln-78"></a>   <span class="k">call </span><span class="n">mpi_init</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<a name="ln-79"></a>   <span class="k">call </span><span class="n">mpi_comm_size</span><span class="p">(</span><span class="n">mpi_comm_world</span><span class="p">,</span> <span class="n">mpi_size</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-80"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">mpi_comm_world</span><span class="p">,</span> <span class="n">mpi_rank</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-81"></a>
<a name="ln-82"></a>   <span class="k">call </span><span class="n">check_decomposition</span>
<a name="ln-83"></a>   <span class="c">!===================================</span>
<a name="ln-84"></a>   <span class="n">npe_xloc</span> <span class="o">=</span> <span class="n">nprocx</span>
<a name="ln-85"></a>   <span class="n">npe_yloc</span> <span class="o">=</span> <span class="n">nprocy</span>
<a name="ln-86"></a>   <span class="n">npe_zloc</span> <span class="o">=</span> <span class="n">nprocz</span>
<a name="ln-87"></a>   <span class="n">npe</span> <span class="o">=</span> <span class="n">mpi_size</span>
<a name="ln-88"></a>
<a name="ln-89"></a>   <span class="n">pe_min</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-90"></a>   <span class="n">pe_max</span> <span class="o">=</span> <span class="n">npe</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-91"></a>
<a name="ln-92"></a>   <span class="n">mype</span> <span class="o">=</span> <span class="n">mpi_rank</span>
<a name="ln-93"></a>   <span class="n">pe0</span> <span class="o">=</span> <span class="p">(</span><span class="n">mype</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-94"></a>   <span class="n">pe1</span> <span class="o">=</span> <span class="p">(</span><span class="n">mype</span><span class="o">==</span><span class="n">pe_max</span><span class="p">)</span>
<a name="ln-95"></a>
<a name="ln-96"></a>   <span class="n">prl</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-97"></a>   <span class="n">prlx</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe_xloc</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-98"></a>   <span class="n">prly</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe_yloc</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-99"></a>   <span class="n">prlz</span> <span class="o">=</span> <span class="p">(</span><span class="n">npe_zloc</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-100"></a>
<a name="ln-101"></a>   <span class="n">comm</span> <span class="o">=</span> <span class="n">mpi_comm_world</span>
<a name="ln-102"></a>
<a name="ln-103"></a>   <span class="n">mpi_sd</span> <span class="o">=</span> <span class="n">mpi_double_precision</span>
<a name="ln-104"></a>
<a name="ln-105"></a>   <span class="k">call </span><span class="n">mpi_type_contiguous</span><span class="p">(</span><span class="n">ncmp</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">partype</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-106"></a>   <span class="k">call </span><span class="n">mpi_type_commit</span><span class="p">(</span><span class="n">partype</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-107"></a>
<a name="ln-108"></a>
<a name="ln-109"></a>   <span class="c">!================</span>
<a name="ln-110"></a>   <span class="n">ndims</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-111"></a>   <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">npe_yloc</span>
<a name="ln-112"></a>   <span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">npe_zloc</span>
<a name="ln-113"></a>   <span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">npe_xloc</span>
<a name="ln-114"></a>   <span class="c">!================</span>
<a name="ln-115"></a>   <span class="n">imodzx</span> <span class="o">=</span> <span class="n">mype</span><span class="o">/</span><span class="n">npe_yloc</span>
<a name="ln-116"></a>   <span class="n">imody</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">mype</span><span class="p">,</span> <span class="n">npe_yloc</span><span class="p">)</span>
<a name="ln-117"></a>   <span class="n">imodz</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">imodzx</span><span class="p">,</span> <span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-118"></a>   <span class="n">imodx</span> <span class="o">=</span> <span class="n">imodzx</span><span class="o">/</span><span class="n">npe_zloc</span>
<a name="ln-119"></a>
<a name="ln-120"></a>   <span class="n">imodyx</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="n">npe_zloc</span><span class="o">*</span><span class="n">imodx</span>
<a name="ln-121"></a>   <span class="n">imodyz</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="n">imodz</span>
<a name="ln-122"></a>   <span class="c">!======================</span>
<a name="ln-123"></a>   <span class="c">!=================</span>
<a name="ln-124"></a>
<a name="ln-125"></a>   <span class="c">!================= MPI cartesiantopology with (imody,imodz,imodx) coordinates</span>
<a name="ln-126"></a>   <span class="c">! mype=imody+npe_yloc*imodzx</span>
<a name="ln-127"></a>   <span class="c">! imodzx=imodz+npe_zloc*imodx</span>
<a name="ln-128"></a>   <span class="c">!----------------------------</span>
<a name="ln-129"></a>   <span class="c">! mype=imodyx+npe_yloc*imodz</span>
<a name="ln-130"></a>   <span class="c">! imodyx=imody+npe_yloc*npe_zloc*imodx</span>
<a name="ln-131"></a>   <span class="c">!===================</span>
<a name="ln-132"></a>   <span class="c">! mype=imodyz+npe_yloc*npe_zloc*imodx</span>
<a name="ln-133"></a>   <span class="n">col_or</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">imodz</span><span class="o">+</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">imodx</span><span class="p">)</span>
<a name="ln-134"></a>   <span class="c">! imodyz=imody+npe_yloc*imodz</span>
<a name="ln-135"></a>   <span class="n">col_or</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">imodx</span>
<a name="ln-136"></a>   <span class="c">!==========================</span>
<a name="ln-137"></a>   <span class="n">col_or</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">imodz</span>
<a name="ln-138"></a>   <span class="c">!======================</span>
<a name="ln-139"></a>   <span class="k">call </span><span class="n">mpi_comm_split</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">col_or</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">imody</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-140"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">coor</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-141"></a>   <span class="k">call </span><span class="n">mpi_comm_split</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">col_or</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-142"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">coor</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-143"></a>   <span class="k">call </span><span class="n">mpi_comm_split</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">col_or</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-144"></a>   <span class="k">call </span><span class="n">mpi_comm_rank</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">coor</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-145"></a>   <span class="c">!imodzx=&gt;&gt; all pes in the (imodz,imodx) plane for given imody</span>
<a name="ln-146"></a>   <span class="c">!imodyx=&gt; all pes in the (imody,imodx) plane for given imodz</span>
<a name="ln-147"></a>   <span class="c">!all pes in the (imody,imodz) plane for given imodx</span>
<a name="ln-148"></a>   <span class="c">!============ for diagnostic</span>
<a name="ln-149"></a>   <span class="n">pe0y</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">==</span> <span class="mi">0</span>
<a name="ln-150"></a>   <span class="n">pe1y</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">==</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-151"></a>   <span class="n">pe0z</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">==</span> <span class="mi">0</span>
<a name="ln-152"></a>   <span class="n">pe1z</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">==</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-153"></a>   <span class="n">pex0</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">==</span> <span class="mi">0</span>
<a name="ln-154"></a>   <span class="n">pex1</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">==</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-155"></a>   <span class="c">!===========================</span>
<a name="ln-156"></a>   <span class="n">pe_min_y</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-157"></a>   <span class="n">pe_max_y</span> <span class="o">=</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-158"></a>   <span class="n">pe_min_z</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-159"></a>   <span class="n">pe_max_z</span> <span class="o">=</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-160"></a>   <span class="n">pe_min_x</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-161"></a>   <span class="n">pe_max_x</span> <span class="o">=</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-162"></a>   <span class="c">!===========================</span>
<a name="ln-163"></a>   <span class="n">xl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-164"></a>   <span class="n">xr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-165"></a>   <span class="n">yl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-166"></a>   <span class="n">yr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-167"></a>   <span class="n">zl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-168"></a>   <span class="n">zr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-169"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pex0</span><span class="p">)</span> <span class="n">xl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-170"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pex1</span><span class="p">)</span> <span class="n">xr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-171"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0y</span><span class="p">)</span> <span class="n">yl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-172"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe1y</span><span class="p">)</span> <span class="n">yr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-173"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0z</span><span class="p">)</span> <span class="n">zl_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-174"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe1z</span><span class="p">)</span> <span class="n">zr_bd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-175"></a>   <span class="n">pe0x</span> <span class="o">=</span> <span class="n">pex0</span>
<a name="ln-176"></a>   <span class="n">pe1x</span> <span class="o">=</span> <span class="n">pex1</span>
<a name="ln-177"></a>   <span class="c">! Logical idensification of mpi boundary coordinates</span>
<a name="ln-178"></a>   <span class="n">pkind</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p_ind</span><span class="p">)</span>
<a name="ln-179"></a>   <span class="n">bkind</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b_ind</span><span class="p">)</span>
<a name="ln-180"></a>   <span class="c">!====================</span>
<a name="ln-181"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_npart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">pkind</span><span class="p">))</span>
<a name="ln-182"></a>   <span class="n">loc_npart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">pkind</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-183"></a>   <span class="c">!========================================</span>
<a name="ln-184"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_ne_ionz</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-185"></a>   <span class="n">loc_ne_ionz</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-186"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_tpart</span><span class="p">(</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-187"></a>   <span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-188"></a>
<a name="ln-189"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">bkind</span><span class="p">))</span>
<a name="ln-190"></a>   <span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">bkind</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-191"></a>
<a name="ln-192"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">yp_next</span><span class="p">(</span><span class="n">npe_yloc</span><span class="p">),</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">npe_yloc</span><span class="p">))</span>
<a name="ln-193"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">zp_next</span><span class="p">(</span><span class="n">npe_zloc</span><span class="p">),</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">npe_zloc</span><span class="p">))</span>
<a name="ln-194"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">xp_next</span><span class="p">(</span><span class="n">npe_xloc</span><span class="p">),</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">npe_xloc</span><span class="p">))</span>
<a name="ln-195"></a>
<a name="ln-196"></a>   <span class="n">yp_next</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-197"></a>   <span class="n">yp_prev</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-198"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">npe_yloc</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-199"></a><span class="k">    do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-200"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-201"></a>     <span class="n">yp_next</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">npe_yloc</span><span class="p">)</span>
<a name="ln-202"></a>     <span class="c">!============================</span>
<a name="ln-203"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imody</span> <span class="o">-</span> <span class="n">ipe</span>
<a name="ln-204"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">pen</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">pen</span> <span class="o">=</span> <span class="n">pen</span> <span class="o">+</span> <span class="n">npe_yloc</span>
<a name="ln-205"></a>     <span class="n">yp_prev</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="n">pen</span>
<a name="ln-206"></a>    <span class="k">end do</span>
<a name="ln-207"></a><span class="k">   end if</span>
<a name="ln-208"></a><span class="k">   </span><span class="n">zp_next</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-209"></a>   <span class="n">zp_prev</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-210"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">npe_zloc</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-211"></a><span class="k">    do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-212"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-213"></a>     <span class="n">zp_next</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-214"></a>
<a name="ln-215"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodz</span> <span class="o">-</span> <span class="n">ipe</span>
<a name="ln-216"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">pen</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">pen</span> <span class="o">=</span> <span class="n">pen</span> <span class="o">+</span> <span class="n">npe_zloc</span>
<a name="ln-217"></a>     <span class="n">zp_prev</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="n">pen</span>
<a name="ln-218"></a>    <span class="k">end do</span>
<a name="ln-219"></a><span class="k">   end if</span>
<a name="ln-220"></a><span class="k">   </span><span class="n">xp_next</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-221"></a>   <span class="n">xp_prev</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-222"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prlx</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-223"></a><span class="k">    do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-224"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-225"></a>     <span class="n">xp_next</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">npe_xloc</span><span class="p">)</span>
<a name="ln-226"></a>     <span class="c">!============= output arrays</span>
<a name="ln-227"></a>     <span class="n">pen</span> <span class="o">=</span> <span class="n">imodx</span> <span class="o">-</span> <span class="n">ipe</span>
<a name="ln-228"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">pen</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">pen</span> <span class="o">=</span> <span class="n">pen</span> <span class="o">+</span> <span class="n">npe_xloc</span>
<a name="ln-229"></a>     <span class="n">xp_prev</span><span class="p">(</span><span class="n">ipe</span><span class="p">)</span> <span class="o">=</span> <span class="n">pen</span>
<a name="ln-230"></a>    <span class="k">end do</span>
<a name="ln-231"></a><span class="k">   end if</span>
<a name="ln-232"></a>  
<a name="ln-233"></a>   <span class="c">!==========================================</span>
<a name="ln-234"></a>   <span class="c">! INITIALIZE THE RANDOM SEED FOR EVERY MYPE</span>
<a name="ln-235"></a>   <span class="c">!==========================================</span>
<a name="ln-236"></a>
<a name="ln-237"></a>   <span class="k">call </span><span class="n">init_random_seed</span><span class="p">(</span><span class="n">mype</span><span class="p">)</span>
<a name="ln-238"></a>   <span class="c">!call processor_grid_diag</span>
<a name="ln-239"></a>   
<a name="ln-240"></a>  <span class="k">end subroutine</span>
<a name="ln-241"></a>
<a name="ln-242"></a>
<a name="ln-243"></a><span class="k">  subroutine </span><span class="n">mpi_write_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-244"></a>
<a name="ln-245"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-246"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-247"></a>   <span class="kt">integer</span> <span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-248"></a>   <span class="kt">character</span> <span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-249"></a>   <span class="c">!===========================</span>
<a name="ln-250"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-251"></a>   <span class="c">!========================</span>
<a name="ln-252"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span><span class="o">+</span><span class="n">mpi_mode_create</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-253"></a>     <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-254"></a>
<a name="ln-255"></a>
<a name="ln-256"></a>   <span class="k">call </span><span class="n">mpi_file_write_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-257"></a>     <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-258"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-259"></a>
<a name="ln-260"></a>  <span class="k">end subroutine</span>
<a name="ln-261"></a>  <span class="c">!======== each process acces thefile and writes at disp(byte) coordinate</span>
<a name="ln-262"></a>  <span class="k">subroutine </span><span class="n">mpi_write_row_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-263"></a>
<a name="ln-264"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-265"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-266"></a>   <span class="kt">integer</span> <span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-267"></a>   <span class="kt">character</span> <span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-268"></a>
<a name="ln-269"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-270"></a>   <span class="c">!=======================================</span>
<a name="ln-271"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span><span class="o">+</span><span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-272"></a>     <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-273"></a>
<a name="ln-274"></a>
<a name="ln-275"></a>
<a name="ln-276"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-277"></a>   <span class="k">call </span><span class="n">mpi_file_write_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-278"></a>     <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-279"></a>   <span class="c">! mpi_sd, &#39;native&#39;, &amp;</span>
<a name="ln-280"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-281"></a>  <span class="k">end subroutine</span>
<a name="ln-282"></a>  <span class="c">!mpi_info_null, ierr)</span>
<a name="ln-283"></a>  <span class="k">subroutine </span><span class="n">mpi_write_col_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-284"></a>
<a name="ln-285"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-286"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-287"></a>   <span class="kt">integer</span> <span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-288"></a>   <span class="kt">character</span> <span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-289"></a>
<a name="ln-290"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-291"></a>   <span class="c">!===================</span>
<a name="ln-292"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span><span class="o">+</span><span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-293"></a>     <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-294"></a>
<a name="ln-295"></a>
<a name="ln-296"></a>
<a name="ln-297"></a>
<a name="ln-298"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-299"></a>   <span class="k">call </span><span class="n">mpi_file_write_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-300"></a>     <span class="n">mpi_double_precision</span><span class="p">,</span> <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-301"></a>   <span class="c">! mpi_sd, &#39;native&#39;, &amp;</span>
<a name="ln-302"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-303"></a>   <span class="c">! mpi_info_null, ierr)</span>
<a name="ln-304"></a>  <span class="k">end subroutine</span>
<a name="ln-305"></a>
<a name="ln-306"></a><span class="k">  subroutine </span><span class="n">mpi_read_col_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-307"></a>
<a name="ln-308"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-309"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-310"></a>   <span class="kt">integer</span> <span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-311"></a>   <span class="kt">character</span> <span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-312"></a>
<a name="ln-313"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-314"></a>   <span class="c">!========================</span>
<a name="ln-315"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_rdonly</span><span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-316"></a>     <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-317"></a>
<a name="ln-318"></a>
<a name="ln-319"></a>
<a name="ln-320"></a>
<a name="ln-321"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-322"></a>   <span class="k">call </span><span class="n">mpi_file_read_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-323"></a>     <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-324"></a>   <span class="c">!mpi_sd, &#39;native&#39;, &amp;</span>
<a name="ln-325"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-326"></a>   <span class="c">!mpi_info_null, ierr)</span>
<a name="ln-327"></a>  <span class="k">end subroutine</span>
<a name="ln-328"></a>
<a name="ln-329"></a><span class="k">  subroutine </span><span class="n">mpi_read_dp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-330"></a>
<a name="ln-331"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-332"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-333"></a>   <span class="kt">integer</span> <span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-334"></a>   <span class="kt">character</span> <span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-335"></a>
<a name="ln-336"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-337"></a>   <span class="c">!=======================================</span>
<a name="ln-338"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_rdonly</span><span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-339"></a>     <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-340"></a>
<a name="ln-341"></a>
<a name="ln-342"></a>
<a name="ln-343"></a>   <span class="k">call </span><span class="n">mpi_file_read_at</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-344"></a>     <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-345"></a>   <span class="c">!call mpi_file_set_view(thefile, disp, mpi_sd, &amp;</span>
<a name="ln-346"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-347"></a>   <span class="c">! mpi_sd, &#39;native&#39;, mpi_info_null, ierr)</span>
<a name="ln-348"></a>  <span class="k">end subroutine</span>
<a name="ln-349"></a>  <span class="c">!call mpi_file_seek(thefile,disp,whence,ierr)</span>
<a name="ln-350"></a>  <span class="k">subroutine </span><span class="n">mpi_write_part</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">loc_np</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-351"></a>
<a name="ln-352"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-353"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">loc_np</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-354"></a>   <span class="kt">integer</span> <span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-355"></a>   <span class="kt">character</span> <span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-356"></a>
<a name="ln-357"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-358"></a>   <span class="c">!===============================</span>
<a name="ln-359"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span><span class="o">+</span><span class="n">mpi_mode_create</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-360"></a>     <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-361"></a>
<a name="ln-362"></a>
<a name="ln-363"></a>
<a name="ln-364"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-365"></a>     <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-366"></a>
<a name="ln-367"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">loc_np</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-368"></a>     <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-369"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-370"></a>     <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-371"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-372"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-373"></a>  <span class="k">end subroutine</span>
<a name="ln-374"></a>  <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-375"></a>
<a name="ln-376"></a>  <span class="k">subroutine </span><span class="n">mpi_write_part_col</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-377"></a>
<a name="ln-378"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-379"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span>
<a name="ln-380"></a>   <span class="kt">integer</span> <span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-381"></a>   <span class="kt">character</span> <span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-382"></a>   <span class="c">!========================</span>
<a name="ln-383"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-384"></a>   <span class="c">!========================</span>
<a name="ln-385"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span><span class="o">+</span><span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-386"></a>     <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-387"></a>
<a name="ln-388"></a>
<a name="ln-389"></a>
<a name="ln-390"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-391"></a>     <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-392"></a>
<a name="ln-393"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-394"></a>     <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-395"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-396"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-397"></a>   <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-398"></a>  <span class="k">end subroutine</span>
<a name="ln-399"></a>
<a name="ln-400"></a><span class="k">  subroutine </span><span class="n">mpi_write_field</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-401"></a>    <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-402"></a>
<a name="ln-403"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-404"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">header</span><span class="p">(:)</span>
<a name="ln-405"></a>   <span class="kt">integer</span> <span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-406"></a>   <span class="kt">character</span> <span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-407"></a>
<a name="ln-408"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-409"></a>   <span class="c">!========================</span>
<a name="ln-410"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span><span class="o">+</span><span class="n">mpi_mode_create</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-411"></a>     <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-412"></a>
<a name="ln-413"></a>
<a name="ln-414"></a>
<a name="ln-415"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-416"></a>     <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-417"></a>
<a name="ln-418"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-419"></a>     <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-420"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-421"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-422"></a>     <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-423"></a>   <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-424"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-425"></a>  <span class="k">end subroutine</span>
<a name="ln-426"></a>
<a name="ln-427"></a><span class="k">  subroutine </span><span class="n">mpi_write_field_col</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-428"></a>    <span class="n">disp</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
<a name="ln-429"></a>   <span class="c">!========================</span>
<a name="ln-430"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buf</span><span class="p">(:)</span>
<a name="ln-431"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">nchar</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">header</span><span class="p">(:)</span>
<a name="ln-432"></a>   <span class="kt">integer</span> <span class="p">(</span><span class="n">offset_kind</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">disp</span>
<a name="ln-433"></a>   <span class="kt">character</span> <span class="p">(</span><span class="n">nchar</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fout</span>
<a name="ln-434"></a>   <span class="c">!different from mpi_write_field because of the different communicator in</span>
<a name="ln-435"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">thefile</span>
<a name="ln-436"></a>   <span class="c">!mpi_file_open</span>
<a name="ln-437"></a>   <span class="k">call </span><span class="n">mpi_file_open</span><span class="p">(</span><span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">fout</span><span class="p">,</span> <span class="n">mpi_mode_wronly</span><span class="o">+</span><span class="n">mpi_mode_create</span> <span class="p">&amp;</span>
<a name="ln-438"></a>     <span class="p">,</span> <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-439"></a>
<a name="ln-440"></a>
<a name="ln-441"></a>
<a name="ln-442"></a>   <span class="k">call </span><span class="n">mpi_file_set_view</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-443"></a>     <span class="n">mpi_info_null</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-444"></a>
<a name="ln-445"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">header_size</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-446"></a>     <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-447"></a>   <span class="c">!mpi_file_set_view is broken on Windows 10 with Intel MPI 5 (don&#39;t have money to upgrade MPI-Lib and check)</span>
<a name="ln-448"></a>   <span class="k">call </span><span class="n">mpi_file_write</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-449"></a>     <span class="n">mpi_status_ignore</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-450"></a>   <span class="c">!please disable any binary output in Windows/IFORT if it doesn&#39;t work for you</span>
<a name="ln-451"></a>   <span class="k">call </span><span class="n">mpi_file_close</span><span class="p">(</span><span class="n">thefile</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-452"></a>  <span class="k">end subroutine</span>
<a name="ln-453"></a>
<a name="ln-454"></a><span class="k">  subroutine </span><span class="n">End_parallel</span>
<a name="ln-455"></a>
<a name="ln-456"></a>   <span class="k">call </span><span class="n">MPI_FINALIZE</span><span class="p">(</span> <span class="n">error</span> <span class="p">)</span>
<a name="ln-457"></a>
<a name="ln-458"></a>  <span class="k">end subroutine</span>
<a name="ln-459"></a>
<a name="ln-460"></a>
<a name="ln-461"></a><span class="k">  subroutine </span><span class="n">exchange_idata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">idat</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-462"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-463"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">idat</span><span class="p">(:)</span>
<a name="ln-464"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-465"></a>
<a name="ln-466"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-467"></a>    <span class="c">!=======================</span>
<a name="ln-468"></a>    <span class="k">call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-469"></a>    <span class="c">!=====================================</span>
<a name="ln-470"></a>   <span class="k">else</span>
<a name="ln-471"></a>
<a name="ln-472"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-473"></a>      <span class="n">error</span><span class="p">)</span>
<a name="ln-474"></a>   <span class="k">end if</span>
<a name="ln-475"></a>
<a name="ln-476"></a><span class="k">  end subroutine</span>
<a name="ln-477"></a>
<a name="ln-478"></a><span class="k">  subroutine </span><span class="n">exchange_2d_idata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">idat</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-479"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-480"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">idat</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-481"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-482"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-483"></a>
<a name="ln-484"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span>
<a name="ln-485"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-486"></a>
<a name="ln-487"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-488"></a>
<a name="ln-489"></a>   <span class="k">else</span>
<a name="ln-490"></a>
<a name="ln-491"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">idat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-492"></a>      <span class="n">error</span><span class="p">)</span>
<a name="ln-493"></a>   <span class="k">end if</span>
<a name="ln-494"></a>
<a name="ln-495"></a><span class="k">  end subroutine</span>
<a name="ln-496"></a>
<a name="ln-497"></a><span class="k">  subroutine </span><span class="n">exchange_3d_sp_data</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-498"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-499"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-500"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-501"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-502"></a>
<a name="ln-503"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span><span class="o">*</span><span class="n">n3</span>
<a name="ln-504"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-505"></a>
<a name="ln-506"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-507"></a>    <span class="c">!====================</span>
<a name="ln-508"></a>   <span class="k">else</span>
<a name="ln-509"></a>
<a name="ln-510"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-511"></a>      <span class="n">error</span><span class="p">)</span>
<a name="ln-512"></a>   <span class="k">end if</span>
<a name="ln-513"></a>
<a name="ln-514"></a><span class="k">  end subroutine</span>
<a name="ln-515"></a>
<a name="ln-516"></a><span class="k">  subroutine </span><span class="n">exchange_1d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-517"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-518"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:)</span>
<a name="ln-519"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-520"></a>
<a name="ln-521"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-522"></a>
<a name="ln-523"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-524"></a>
<a name="ln-525"></a>   <span class="k">else</span>
<a name="ln-526"></a>    <span class="c">!====================</span>
<a name="ln-527"></a>    <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-528"></a>   <span class="k">end if</span>
<a name="ln-529"></a>
<a name="ln-530"></a><span class="k">  end subroutine</span>
<a name="ln-531"></a>
<a name="ln-532"></a><span class="k">  subroutine </span><span class="n">exchange_2d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-533"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-534"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-535"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-536"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-537"></a>
<a name="ln-538"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span>
<a name="ln-539"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-540"></a>
<a name="ln-541"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-542"></a>
<a name="ln-543"></a>   <span class="k">else</span>
<a name="ln-544"></a>
<a name="ln-545"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-546"></a>      <span class="n">error</span><span class="p">)</span>
<a name="ln-547"></a>   <span class="k">end if</span>
<a name="ln-548"></a>
<a name="ln-549"></a><span class="k">  end subroutine</span>
<a name="ln-550"></a><span class="c">!====================</span>
<a name="ln-551"></a>  <span class="k">subroutine </span><span class="n">exchange_3d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span><span class="p">)</span>
<a name="ln-552"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span>
<a name="ln-553"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-554"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-555"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span>
<a name="ln-556"></a>
<a name="ln-557"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-558"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-559"></a>
<a name="ln-560"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-561"></a>      <span class="n">error</span><span class="p">)</span>
<a name="ln-562"></a>    <span class="c">!=========================</span>
<a name="ln-563"></a>   <span class="k">else</span>
<a name="ln-564"></a>
<a name="ln-565"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-566"></a>      <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-567"></a>   <span class="k">end if</span>
<a name="ln-568"></a><span class="k">  end subroutine</span>
<a name="ln-569"></a><span class="k">  subroutine </span><span class="n">exchange_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">dat0</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span><span class="p">)</span>
<a name="ln-570"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">ipe</span>
<a name="ln-571"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-572"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-573"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span>
<a name="ln-574"></a>
<a name="ln-575"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">ipe</span>
<a name="ln-576"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-577"></a>
<a name="ln-578"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-579"></a>      <span class="n">error</span><span class="p">)</span>
<a name="ln-580"></a>    <span class="c">!=========================</span>
<a name="ln-581"></a>   <span class="k">else</span>
<a name="ln-582"></a>
<a name="ln-583"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-584"></a>      <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-585"></a>   <span class="k">end if</span>
<a name="ln-586"></a>
<a name="ln-587"></a><span class="k">  end subroutine</span>
<a name="ln-588"></a>
<a name="ln-589"></a><span class="k">  subroutine </span><span class="n">realvec_distribute</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nproc</span><span class="p">)</span>
<a name="ln-590"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nproc</span>
<a name="ln-591"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rs</span>
<a name="ln-592"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv</span><span class="p">(:),</span> <span class="n">rc</span>
<a name="ln-593"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ipe</span>
<a name="ln-594"></a>
<a name="ln-595"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-596"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="mi">20</span><span class="o">+</span><span class="n">mype</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-597"></a>   <span class="k">else</span>
<a name="ln-598"></a><span class="k">    </span><span class="n">rv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">rs</span>
<a name="ln-599"></a>    <span class="k">do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nproc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-600"></a>     <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="mi">20</span><span class="o">+</span><span class="n">ipe</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-601"></a>     <span class="n">rv</span><span class="p">(</span><span class="n">ipe</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">rc</span>
<a name="ln-602"></a>    <span class="k">end do</span>
<a name="ln-603"></a><span class="k">   end if</span>
<a name="ln-604"></a>
<a name="ln-605"></a><span class="k">  end subroutine</span>
<a name="ln-606"></a>
<a name="ln-607"></a><span class="k">  subroutine </span><span class="n">intvec_distribute</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">nproc</span><span class="p">)</span>
<a name="ln-608"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nproc</span>
<a name="ln-609"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nc</span><span class="p">(:)</span>
<a name="ln-610"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">nr</span>
<a name="ln-611"></a>
<a name="ln-612"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-613"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">mype</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-614"></a>   <span class="k">else</span>
<a name="ln-615"></a><span class="k">    </span><span class="n">nc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ns</span>
<a name="ln-616"></a>    <span class="k">do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nproc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-617"></a>     <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-618"></a>     <span class="n">nc</span><span class="p">(</span><span class="n">ipe</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nr</span>
<a name="ln-619"></a>    <span class="k">end do</span>
<a name="ln-620"></a><span class="k">   end if</span>
<a name="ln-621"></a><span class="k">   call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">nproc</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-622"></a>
<a name="ln-623"></a>  <span class="k">end subroutine</span>
<a name="ln-624"></a>
<a name="ln-625"></a><span class="k">  subroutine </span><span class="n">sr_idata</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-626"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ns</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span>
<a name="ln-627"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nr</span>
<a name="ln-628"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-629"></a>
<a name="ln-630"></a>   <span class="n">nr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-631"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">dir</span>
<a name="ln-632"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-633"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-634"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-635"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> 
<a name="ln-636"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> <span class="c">!=============</span>
<a name="ln-637"></a>    <span class="k">else</span>
<a name="ln-638"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span> 
<a name="ln-639"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span> <span class="c">!sends to left ns data</span>
<a name="ln-640"></a>    <span class="k">end if</span>
<a name="ln-641"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-642"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-643"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-644"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-645"></a>    <span class="k">else</span>
<a name="ln-646"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-647"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-648"></a>    <span class="k">end if</span>
<a name="ln-649"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-650"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-651"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-652"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-653"></a>    <span class="k">else</span>
<a name="ln-654"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-655"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-656"></a>    <span class="k">end if</span>
<a name="ln-657"></a><span class="k">   end select</span>
<a name="ln-658"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-659"></a>     <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-660"></a>   <span class="c">!receives from right nr daata</span>
<a name="ln-661"></a>  <span class="k">end subroutine</span>
<a name="ln-662"></a>  <span class="c">!sends to right ns data</span>
<a name="ln-663"></a>  <span class="k">subroutine </span><span class="n">sr_pdata</span><span class="p">(</span><span class="n">sdata</span><span class="p">,</span> <span class="n">rdata</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-664"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sdata</span><span class="p">(:)</span>
<a name="ln-665"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rdata</span><span class="p">(:)</span>
<a name="ln-666"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span>
<a name="ln-667"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">per</span>
<a name="ln-668"></a>   <span class="c">!receives form left nr data</span>
<a name="ln-669"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">dir</span>
<a name="ln-670"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-671"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-672"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-673"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-674"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-675"></a>    <span class="k">else</span>
<a name="ln-676"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-677"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-678"></a>    <span class="k">end if</span>
<a name="ln-679"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-680"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-681"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-682"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-683"></a>    <span class="k">else</span>
<a name="ln-684"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-685"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-686"></a>    <span class="k">end if</span>
<a name="ln-687"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-688"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-689"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-690"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-691"></a>    <span class="k">else</span>
<a name="ln-692"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-693"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-694"></a>    <span class="k">end if</span>
<a name="ln-695"></a><span class="k">   end select</span>
<a name="ln-696"></a><span class="k">   if</span> <span class="p">(</span><span class="n">ns</span><span class="o">*</span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-697"></a><span class="k">    call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">sdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ns</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">rdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">nr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-698"></a>      <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-699"></a>   <span class="k">else</span>
<a name="ln-700"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ns</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">sdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ns</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-701"></a>      <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-702"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">rdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">nr</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-703"></a>      <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-704"></a>   <span class="k">end if</span>
<a name="ln-705"></a><span class="k">  end subroutine</span>
<a name="ln-706"></a>
<a name="ln-707"></a><span class="k">  subroutine </span><span class="n">sr_vidata</span><span class="p">(</span><span class="n">sidat</span><span class="p">,</span> <span class="n">ridat</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-708"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span>
<a name="ln-709"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sidat</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span>
<a name="ln-710"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ridat</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span>
<a name="ln-711"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">nq</span>
<a name="ln-712"></a>   <span class="c">!==================</span>
<a name="ln-713"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">dir</span>
<a name="ln-714"></a>   <span class="n">nq</span> <span class="o">=</span> <span class="n">n2</span><span class="o">*</span><span class="n">n3</span>
<a name="ln-715"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-716"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-717"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-718"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-719"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-720"></a>    <span class="k">else</span>
<a name="ln-721"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-722"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-723"></a>    <span class="k">end if</span>
<a name="ln-724"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-725"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-726"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-727"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-728"></a>    <span class="k">else</span>
<a name="ln-729"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-730"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-731"></a>    <span class="k">end if</span>
<a name="ln-732"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-733"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-734"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-735"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-736"></a>    <span class="k">else</span>
<a name="ln-737"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-738"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-739"></a>    <span class="k">end if</span>
<a name="ln-740"></a><span class="k">   end select</span>
<a name="ln-741"></a>
<a name="ln-742"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">sidat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">nq</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">ridat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-743"></a>     <span class="n">nq</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-744"></a>   <span class="c">!====================</span>
<a name="ln-745"></a>  <span class="k">end subroutine</span>
<a name="ln-746"></a>
<a name="ln-747"></a><span class="k">  subroutine </span><span class="n">exchange_pdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-748"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-749"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-750"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">sp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">pdata</span><span class="p">(:)</span>
<a name="ln-751"></a>
<a name="ln-752"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-753"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">pdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-754"></a>
<a name="ln-755"></a>   <span class="k">else</span>
<a name="ln-756"></a>
<a name="ln-757"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">pdata</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_real</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-758"></a>      <span class="n">error</span><span class="p">)</span>
<a name="ln-759"></a>   <span class="k">end if</span>
<a name="ln-760"></a>
<a name="ln-761"></a><span class="k">  end subroutine</span>
<a name="ln-762"></a>
<a name="ln-763"></a><span class="k">  subroutine </span><span class="n">exchange_rdata</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-764"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff</span><span class="p">(:)</span>
<a name="ln-765"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-766"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-767"></a>
<a name="ln-768"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-769"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-770"></a>   <span class="k">else</span>
<a name="ln-771"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-772"></a>      <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-773"></a>   <span class="k">end if</span>
<a name="ln-774"></a>
<a name="ln-775"></a><span class="k">  end subroutine</span>
<a name="ln-776"></a>
<a name="ln-777"></a><span class="k">  subroutine </span><span class="n">exchange_rdata_int</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<a name="ln-778"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff</span><span class="p">(:)</span>
<a name="ln-779"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-780"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-781"></a>
<a name="ln-782"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-783"></a><span class="k">    call </span><span class="n">mpi_send</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-784"></a>   <span class="k">else</span>
<a name="ln-785"></a><span class="k">    call </span><span class="n">mpi_recv</span><span class="p">(</span><span class="n">buff</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-786"></a>      <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-787"></a>   <span class="k">end if</span>
<a name="ln-788"></a>
<a name="ln-789"></a><span class="k">  end subroutine</span>
<a name="ln-790"></a>  <span class="c">!=======================</span>
<a name="ln-791"></a>  <span class="k">subroutine </span><span class="n">vint_2d_bcast</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
<a name="ln-792"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span>
<a name="ln-793"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:)</span> <span class="kd">::</span> <span class="n">mydat</span>
<a name="ln-794"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-795"></a>
<a name="ln-796"></a>   <span class="n">nt</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span>
<a name="ln-797"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">mydat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-798"></a>
<a name="ln-799"></a>  <span class="k">end subroutine</span>
<a name="ln-800"></a>
<a name="ln-801"></a><span class="k">  subroutine </span><span class="n">vint_bcast</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-802"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-803"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mydat</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-804"></a>
<a name="ln-805"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-806"></a>
<a name="ln-807"></a>  <span class="k">end subroutine</span>
<a name="ln-808"></a>
<a name="ln-809"></a><span class="k">  subroutine </span><span class="n">int_bcast</span><span class="p">(</span><span class="n">mydat</span><span class="p">)</span>
<a name="ln-810"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mydat</span>
<a name="ln-811"></a>
<a name="ln-812"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">mydat</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-813"></a>
<a name="ln-814"></a>  <span class="k">end subroutine</span>
<a name="ln-815"></a>
<a name="ln-816"></a><span class="k">  subroutine </span><span class="n">all_gather_dpreal</span><span class="p">(</span><span class="n">rv_send</span><span class="p">,</span> <span class="n">rv_recv</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-817"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv_send</span><span class="p">(:),</span> <span class="n">rv_recv</span><span class="p">(:)</span>
<a name="ln-818"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dir</span><span class="p">,</span> <span class="n">nt</span>
<a name="ln-819"></a>
<a name="ln-820"></a>   <span class="k">call </span><span class="n">mpi_allgather</span><span class="p">(</span><span class="n">rv_send</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">rv_recv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-821"></a>     <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-822"></a>  <span class="k">end subroutine</span>
<a name="ln-823"></a><span class="k">  subroutine </span><span class="n">allreduce_dpreal</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-824"></a>
<a name="ln-825"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span><span class="p">,</span> <span class="n">nt</span>
<a name="ln-826"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv_loc</span><span class="p">(:)</span>
<a name="ln-827"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rv</span><span class="p">(:)</span>
<a name="ln-828"></a>
<a name="ln-829"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-830"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span>
<a name="ln-831"></a>    <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!min</span>
<a name="ln-832"></a>
<a name="ln-833"></a>     <span class="k">call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-834"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c">!sum</span>
<a name="ln-835"></a>
<a name="ln-836"></a>     <span class="k">call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-837"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c">!max</span>
<a name="ln-838"></a>
<a name="ln-839"></a>     <span class="k">call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">rv_loc</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_max</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-840"></a>    <span class="k">end select</span>
<a name="ln-841"></a>
<a name="ln-842"></a><span class="k">   else</span>
<a name="ln-843"></a><span class="k">    </span><span class="n">rv</span> <span class="o">=</span> <span class="n">rv_loc</span>
<a name="ln-844"></a>   <span class="k">end if</span>
<a name="ln-845"></a>
<a name="ln-846"></a><span class="k">  end subroutine</span>
<a name="ln-847"></a>
<a name="ln-848"></a>
<a name="ln-849"></a><span class="cp">#ifdef ENABLE_MPI_LONG_INT</span>
<a name="ln-850"></a>  <span class="c">! WARNING: unsupported on some architecture!!</span>
<a name="ln-851"></a>  <span class="k">subroutine </span><span class="n">allreduce_big_int</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
<a name="ln-852"></a>
<a name="ln-853"></a>   <span class="kt">integer</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n0</span>
<a name="ln-854"></a>   <span class="kt">integer</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span>
<a name="ln-855"></a>
<a name="ln-856"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-857"></a>
<a name="ln-858"></a><span class="k">    call </span><span class="n">mpi_allreduce</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_long_int</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-859"></a>   <span class="k">end if</span>
<a name="ln-860"></a>   <span class="c">!===========================</span>
<a name="ln-861"></a>  <span class="k">end subroutine</span>
<a name="ln-862"></a><span class="cp">#endif</span>
<a name="ln-863"></a>
<a name="ln-864"></a>
<a name="ln-865"></a>  <span class="k">subroutine </span><span class="n">allreduce_sint</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">)</span>
<a name="ln-866"></a>
<a name="ln-867"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span>
<a name="ln-868"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt0</span>
<a name="ln-869"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span>
<a name="ln-870"></a>
<a name="ln-871"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-872"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span>
<a name="ln-873"></a>    <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!---------------------------------------------</span>
<a name="ln-874"></a>
<a name="ln-875"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_min</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-876"></a>       <span class="n">error</span><span class="p">)</span>
<a name="ln-877"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> 
<a name="ln-878"></a>
<a name="ln-879"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-880"></a>       <span class="n">error</span><span class="p">)</span>
<a name="ln-881"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
<a name="ln-882"></a>
<a name="ln-883"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_max</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-884"></a>       <span class="n">error</span><span class="p">)</span>
<a name="ln-885"></a>    <span class="k">end select</span>
<a name="ln-886"></a><span class="k">    call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-887"></a>   <span class="k">else</span>
<a name="ln-888"></a><span class="k">    </span><span class="n">dt_tot</span> <span class="o">=</span> <span class="n">dt0</span>
<a name="ln-889"></a>   <span class="k">end if</span>
<a name="ln-890"></a>
<a name="ln-891"></a><span class="k">  end subroutine</span>
<a name="ln-892"></a>
<a name="ln-893"></a><span class="k">  subroutine </span><span class="n">allreduce_vint</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-894"></a>
<a name="ln-895"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span><span class="p">,</span> <span class="n">nt</span>
<a name="ln-896"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt0</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-897"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-898"></a>
<a name="ln-899"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-900"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span>
<a name="ln-901"></a>    <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!max</span>
<a name="ln-902"></a>
<a name="ln-903"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_min</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-904"></a>       <span class="n">error</span><span class="p">)</span>
<a name="ln-905"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> 
<a name="ln-906"></a>     <span class="c">!==============================</span>
<a name="ln-907"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-908"></a>       <span class="n">error</span><span class="p">)</span>
<a name="ln-909"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
<a name="ln-910"></a>
<a name="ln-911"></a>     <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt0</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_max</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-912"></a>       <span class="n">error</span><span class="p">)</span>
<a name="ln-913"></a>    <span class="k">end select</span>
<a name="ln-914"></a><span class="k">    call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-915"></a>   <span class="k">else</span>
<a name="ln-916"></a><span class="k">    </span><span class="n">dt_tot</span> <span class="o">=</span> <span class="n">dt0</span>
<a name="ln-917"></a>   <span class="k">end if</span>
<a name="ln-918"></a>
<a name="ln-919"></a><span class="k">  end subroutine</span>
<a name="ln-920"></a>
<a name="ln-921"></a><span class="k">  subroutine </span><span class="n">bcast_grdata</span><span class="p">(</span><span class="n">dat0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>
<a name="ln-922"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">nc</span>
<a name="ln-923"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dat0</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-924"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">lenw</span>
<a name="ln-925"></a>
<a name="ln-926"></a>   <span class="n">lenw</span> <span class="o">=</span> <span class="n">n1</span><span class="o">*</span><span class="n">n2</span><span class="o">*</span><span class="n">n3</span><span class="o">*</span><span class="n">nc</span>
<a name="ln-927"></a>
<a name="ln-928"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dat0</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenw</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-929"></a>
<a name="ln-930"></a>  <span class="k">end subroutine</span>
<a name="ln-931"></a>
<a name="ln-932"></a><span class="k">  subroutine </span><span class="n">bcast_realv_sum</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-933"></a>
<a name="ln-934"></a>   <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ib</span>
<a name="ln-935"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-936"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_prl</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-937"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-938"></a>
<a name="ln-939"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-940"></a>
<a name="ln-941"></a><span class="k">    call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-942"></a>      <span class="n">error</span><span class="p">)</span>
<a name="ln-943"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ib</span><span class="p">)</span> <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-944"></a>   <span class="k">else</span>
<a name="ln-945"></a><span class="k">    </span><span class="n">dt_tot</span> <span class="o">=</span> <span class="n">dt_prl</span>
<a name="ln-946"></a>   <span class="k">end if</span>
<a name="ln-947"></a>
<a name="ln-948"></a><span class="k">  end subroutine</span>
<a name="ln-949"></a>
<a name="ln-950"></a><span class="k">  subroutine </span><span class="n">bcast_int_sum</span><span class="p">(</span><span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">)</span>
<a name="ln-951"></a>
<a name="ln-952"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_prl</span>
<a name="ln-953"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span>
<a name="ln-954"></a>
<a name="ln-955"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-956"></a>
<a name="ln-957"></a><span class="k">    call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">dt_prl</span><span class="p">,</span> <span class="n">dt_tot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_sum</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-958"></a>      <span class="n">error</span><span class="p">)</span>
<a name="ln-959"></a>    <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-960"></a>   <span class="k">else</span>
<a name="ln-961"></a><span class="k">    </span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt_prl</span>
<a name="ln-962"></a>   <span class="k">end if</span>
<a name="ln-963"></a><span class="k">  end subroutine</span>
<a name="ln-964"></a>
<a name="ln-965"></a><span class="k">  subroutine </span><span class="n">real_bcast</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">ndt</span><span class="p">)</span>
<a name="ln-966"></a>
<a name="ln-967"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ndt</span>
<a name="ln-968"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt_tot</span><span class="p">(</span><span class="n">ndt</span><span class="p">)</span>
<a name="ln-969"></a>
<a name="ln-970"></a>   <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dt_tot</span><span class="p">,</span> <span class="n">ndt</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pe_min</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-971"></a>
<a name="ln-972"></a>  <span class="k">end subroutine</span>
<a name="ln-973"></a>
<a name="ln-974"></a><span class="k">  subroutine </span><span class="n">local_to_global_grdata</span><span class="p">(</span><span class="n">buff1</span><span class="p">,</span> <span class="n">buff2</span><span class="p">,</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">dir</span><span class="p">)</span>
<a name="ln-975"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff1</span><span class="p">(:)</span>
<a name="ln-976"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff2</span><span class="p">(:)</span>
<a name="ln-977"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">dir</span>
<a name="ln-978"></a>   <span class="kt">integer </span><span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-979"></a>
<a name="ln-980"></a>
<a name="ln-981"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">250</span> <span class="o">+</span> <span class="n">ip</span>
<a name="ln-982"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-983"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-984"></a>    <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-985"></a>    <span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-986"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-987"></a>    <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-988"></a>    <span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-989"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-990"></a>    <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-991"></a>    <span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-992"></a>   <span class="k">end select</span>
<a name="ln-993"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">buff1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">buff2</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-994"></a>     <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-995"></a>
<a name="ln-996"></a>  <span class="k">end subroutine</span>
<a name="ln-997"></a>
<a name="ln-998"></a><span class="k">  subroutine </span><span class="n">exchange_bd_3d_data</span><span class="p">(</span><span class="n">buff1</span><span class="p">,</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">buff2</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-999"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff1</span><span class="p">(:,:,:)</span>
<a name="ln-1000"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff2</span><span class="p">(:,:,:)</span>
<a name="ln-1001"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span>
<a name="ln-1002"></a>   <span class="kt">integer</span> <span class="p">(</span><span class="n">hp_int</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">side</span>
<a name="ln-1003"></a>   <span class="kt">integer </span><span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-1004"></a>
<a name="ln-1005"></a>   <span class="c">!===============================</span>
<a name="ln-1006"></a>   <span class="c">! side &gt; recievies next sends left</span>
<a name="ln-1007"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">610</span>
<a name="ln-1008"></a>
<a name="ln-1009"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-1010"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1011"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1012"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1013"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1014"></a>    <span class="k">else</span>
<a name="ln-1015"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1016"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1017"></a>    <span class="k">end if</span>
<a name="ln-1018"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1019"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1020"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1021"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1022"></a>    <span class="k">else</span>
<a name="ln-1023"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1024"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1025"></a>    <span class="k">end if</span>
<a name="ln-1026"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1027"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1028"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1029"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1030"></a>    <span class="k">else</span>
<a name="ln-1031"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1032"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1033"></a>    <span class="k">end if</span>
<a name="ln-1034"></a><span class="k">   end select</span>
<a name="ln-1035"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">buff1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">buff2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenwr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1036"></a>     <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-1037"></a>
<a name="ln-1038"></a>  <span class="k">end subroutine</span>
<a name="ln-1039"></a>
<a name="ln-1040"></a><span class="k">  subroutine </span><span class="n">exchange_bdx_data</span><span class="p">(</span><span class="n">buff1</span><span class="p">,</span> <span class="n">buff2</span><span class="p">,</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
<a name="ln-1041"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff1</span><span class="p">(:)</span>
<a name="ln-1042"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">buff2</span><span class="p">(:)</span>
<a name="ln-1043"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">lenwr</span><span class="p">,</span> <span class="n">dir</span>
<a name="ln-1044"></a>   <span class="kt">integer</span> <span class="p">(</span><span class="n">hp_int</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">side</span>
<a name="ln-1045"></a>   <span class="kt">integer </span><span class="n">pes</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span>
<a name="ln-1046"></a>
<a name="ln-1047"></a>   <span class="c">!===============================</span>
<a name="ln-1048"></a>   <span class="n">tag</span> <span class="o">=</span> <span class="mi">610</span>
<a name="ln-1049"></a>
<a name="ln-1050"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-1051"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1052"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1053"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1054"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1055"></a>    <span class="k">else</span>
<a name="ln-1056"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">yp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1057"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">yp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1058"></a>    <span class="k">end if</span>
<a name="ln-1059"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1060"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1061"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1062"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1063"></a>    <span class="k">else</span>
<a name="ln-1064"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">zp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1065"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">zp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1066"></a>    <span class="k">end if</span>
<a name="ln-1067"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1068"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1069"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1070"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1071"></a>    <span class="k">else</span>
<a name="ln-1072"></a><span class="k">     </span><span class="n">pes</span> <span class="o">=</span> <span class="n">xp_next</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1073"></a>     <span class="n">per</span> <span class="o">=</span> <span class="n">xp_prev</span><span class="p">(</span><span class="o">-</span><span class="n">side</span><span class="p">)</span>
<a name="ln-1074"></a>    <span class="k">end if</span>
<a name="ln-1075"></a><span class="k">   end select</span>
<a name="ln-1076"></a><span class="k">   call </span><span class="n">mpi_sendrecv</span><span class="p">(</span><span class="n">buff1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenws</span><span class="p">,</span> <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">pes</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">buff2</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lenwr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1077"></a>     <span class="n">mpi_sd</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">comm_col</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span> <span class="n">status</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<a name="ln-1078"></a>
<a name="ln-1079"></a>  <span class="k">end subroutine</span>
<a name="ln-1080"></a>
<a name="ln-1081"></a><span class="k">  subroutine </span><span class="n">processor_grid_diag</span>
<a name="ln-1082"></a>   <span class="c">!============================</span>
<a name="ln-1083"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-1084"></a>   <span class="kt">character</span> <span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;          &#39;</span>
<a name="ln-1085"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">lun</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-1086"></a>
<a name="ln-1087"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">mype</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1088"></a><span class="k">    write</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;(a9,i1)&#39;</span><span class="p">)</span> <span class="s1">&#39;proc_map0&#39;</span><span class="p">,</span> <span class="n">mype</span>
<a name="ln-1089"></a>   <span class="k">else</span>
<a name="ln-1090"></a><span class="k">    write</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;(a8,i2)&#39;</span><span class="p">)</span> <span class="s1">&#39;proc_map&#39;</span><span class="p">,</span> <span class="n">mype</span>
<a name="ln-1091"></a>   <span class="k">end if</span>
<a name="ln-1092"></a><span class="k">   open</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">fname</span><span class="o">//</span><span class="s1">&#39;.dat&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">)</span>
<a name="ln-1093"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;== local carteisan ranks&#39;</span>
<a name="ln-1094"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span>
<a name="ln-1095"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">coor</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1096"></a>   <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1097"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;====== y-neighbors=========&#39;</span>
<a name="ln-1098"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">yp_next</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">yp_prev</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1099"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;====== z-neighbors=========&#39;</span>
<a name="ln-1100"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">zp_next</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">zp_prev</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1101"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;====== x-neighbors=========&#39;</span>
<a name="ln-1102"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">xp_next</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">xp_prev</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1103"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;======== comm_col===========&#39;</span>
<a name="ln-1104"></a>   <span class="k">write</span> <span class="p">(</span><span class="n">lun</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">comm_col</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1105"></a>   <span class="k">close</span> <span class="p">(</span><span class="n">lun</span><span class="p">)</span>
<a name="ln-1106"></a>
<a name="ln-1107"></a>  <span class="k">end subroutine</span>
<a name="ln-1108"></a>  <span class="c">!================== side &lt;0 receives from left   side &gt;0 receives from right</span>
<a name="ln-1109"></a> <span class="k">end module</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-01-29 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ALaDyn was developed by The ALaDyn Collaboration</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>