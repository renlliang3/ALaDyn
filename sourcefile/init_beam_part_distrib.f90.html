<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A High-Accuracy PIC Code for the Maxwell-Vlasov Equations">
    
    <meta name="author" content="The ALaDyn Collaboration" >
    <link rel="icon" href="../favicon.png">

    <title>init_beam_part_distrib.f90 &ndash; ALaDyn</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">ALaDyn <small>3.0.1</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Guide</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/aladyn.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/aladyn.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>init_beam_part_distrib.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 2.0% of total for source files.">485 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/init_beam_part_distrib.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">init_beam_part_distrib.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/init_beam_part_distrib.html">init_beam_part_distrib</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/init_beam_part_distrib.f90.html#src">init_beam_part_distrib.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~init_beam_part_distrib.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileinit_beam_part_distribf90EfferentGraph" width="641pt" height="346pt"
 viewBox="0.00 0.00 641.00 345.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph" class="graph" transform="scale(.5886 .5886) rotate(0) translate(4 583.4874)">
<title>sourcefile~~init_beam_part_distrib.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-583.4874 1085,-583.4874 1085,4 -4,4"/>
<!-- sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~init_beam_part_distrib.f90</title>
<polygon fill="none" stroke="#000000" points="1081,-407.5038 930,-407.5038 930,-383.5038 1081,-383.5038 1081,-407.5038"/>
<text text-anchor="middle" x="1005.5" y="-393.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">init_beam_part_distrib.f90</text>
</g>
<!-- sourcefile~grid_part_util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~grid_part_util.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/grid_part_util.f90.html" xlink:title="grid_part_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="878,-449.5038 775,-449.5038 775,-425.5038 878,-425.5038 878,-449.5038"/>
<text text-anchor="middle" x="826.5" y="-435.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_part_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~grid_part_util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~grid_part_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M954.2058,-407.5394C933.4213,-412.4162 909.2527,-418.087 887.5687,-423.1749"/>
<polygon fill="#ff0000" stroke="#ff0000" points="886.7378,-419.7747 877.8017,-425.4666 888.3368,-426.5896 886.7378,-419.7747"/>
</g>
<!-- sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~mpi_field_interface.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/mpi_field_interface.f90.html" xlink:title="mpi_field_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="894,-407.5038 759,-407.5038 759,-383.5038 894,-383.5038 894,-407.5038"/>
<text text-anchor="middle" x="826.5" y="-393.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_field_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M929.8473,-395.5038C921.4358,-395.5038 912.857,-395.5038 904.418,-395.5038"/>
<polygon fill="#ff0000" stroke="#ff0000" points="904.2141,-392.0039 894.2141,-395.5038 904.2141,-399.0039 904.2141,-392.0039"/>
</g>
<!-- sourcefile~init_grid_fields.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~init_grid_fields.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/init_grid_fields.f90.html" xlink:title="init_grid_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="881,-533.5038 772,-533.5038 772,-509.5038 881,-509.5038 881,-533.5038"/>
<text text-anchor="middle" x="826.5" y="-519.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">init_grid_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~init_grid_fields.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~init_grid_fields.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M995.7875,-407.7628C977.9145,-429.5301 937.6279,-475.0293 894,-500.5038 890.9397,-502.2908 887.7111,-503.9417 884.3909,-505.4647"/>
<polygon fill="#ff0000" stroke="#ff0000" points="882.7487,-502.3568 874.8557,-509.4244 885.4334,-508.8215 882.7487,-502.3568"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~mpi_curr_interface.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/mpi_curr_interface.f90.html" xlink:title="mpi_curr_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="893,-365.5038 760,-365.5038 760,-341.5038 893,-341.5038 893,-365.5038"/>
<text text-anchor="middle" x="826.5" y="-351.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_curr_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M954.2058,-383.4683C933.4213,-378.5915 909.2527,-372.9207 887.5687,-367.8328"/>
<polygon fill="#ff0000" stroke="#ff0000" points="888.3368,-364.4181 877.8017,-365.5411 886.7378,-371.233 888.3368,-364.4181"/>
</g>
<!-- sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~grid_param.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/grid_param.f90.html" xlink:title="grid_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="397.5,-334.5038 303.5,-334.5038 303.5,-310.5038 397.5,-310.5038 397.5,-334.5038"/>
<text text-anchor="middle" x="350.5" y="-320.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M991.032,-383.3282C944.9544,-346.0784 797.3885,-238.5508 673.5,-278.5038"/>
</g>
<!-- sourcefile~code_util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~code_util.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/code_util.f90.html" xlink:title="code_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="238.5,-72.5038 157.5,-72.5038 157.5,-48.5038 238.5,-48.5038 238.5,-72.5038"/>
<text text-anchor="middle" x="198" y="-58.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">code_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M673.5,-80.5038C607.9475,-57.9211 586.7102,-84.6334 517.5,-80.5038"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M517.5,-80.5038C469.3409,-77.6303 459.0164,-64.1927 411,-59.5038 357.4768,-54.2772 343.777,-59.2116 290,-59.5038 276.6352,-59.5765 262.1787,-59.7085 248.7719,-59.8532"/>
<polygon fill="#ff0000" stroke="#ff0000" points="248.7198,-56.3535 238.7597,-59.9657 248.7984,-63.3531 248.7198,-56.3535"/>
</g>
<!-- sourcefile~array_alloc.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~array_alloc.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/array_alloc.f90.html" xlink:title="array_alloc.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="872.5,-491.5038 780.5,-491.5038 780.5,-467.5038 872.5,-467.5038 872.5,-491.5038"/>
<text text-anchor="middle" x="826.5" y="-477.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">array_alloc.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~array_alloc.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~array_alloc.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M986.7995,-407.7114C965.1477,-421.4513 928.0834,-443.7727 894,-458.5038 889.5184,-460.4408 884.7997,-462.2829 880.0257,-464.0128"/>
<polygon fill="#ff0000" stroke="#ff0000" points="878.5188,-460.8302 870.2073,-467.4006 880.8021,-467.4474 878.5188,-460.8302"/>
</g>
<!-- sourcefile~util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~util.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/util.f90.html" xlink:title="util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="377.5,-92.5038 323.5,-92.5038 323.5,-68.5038 377.5,-68.5038 377.5,-92.5038"/>
<text text-anchor="middle" x="350.5" y="-78.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M517.5,-80.5038C473.1041,-77.8549 421.951,-78.3805 388.0794,-79.2273"/>
<polygon fill="#ff0000" stroke="#ff0000" points="387.6206,-75.7384 377.7198,-79.5099 387.8116,-82.7358 387.6206,-75.7384"/>
</g>
<!-- sourcefile~control_bunch_input.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~control_bunch_input.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/control_bunch_input.f90.html" xlink:title="control_bunch_input.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="588,-33.5038 447,-33.5038 447,-9.5038 588,-9.5038 588,-33.5038"/>
<text text-anchor="middle" x="517.5" y="-19.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">control_bunch_input.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~control_bunch_input.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~control_bunch_input.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M999.9323,-383.1086C985.6929,-352.3739 945.4198,-271.2596 894,-217.5038 814.249,-134.1298 788.3719,-91.2697 673.5,-80.5038"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M673.5,-80.5038C633.728,-66.8025 588.8574,-49.6512 557.4834,-37.3781"/>
<polygon fill="#ff0000" stroke="#ff0000" points="558.3823,-33.9711 547.7949,-33.5753 555.8247,-40.4871 558.3823,-33.9711"/>
</g>
<!-- sourcefile~psolve.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~psolve.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/psolve.f90.html" xlink:title="psolve.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="860,-250.5038 793,-250.5038 793,-226.5038 860,-226.5038 860,-250.5038"/>
<text text-anchor="middle" x="826.5" y="-236.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">psolve.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~psolve.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M998.1112,-383.2584C982.1525,-357.7627 941.9991,-298.529 894,-264.5038 886.6308,-259.28 878.0737,-254.9391 869.5782,-251.3973"/>
<polygon fill="#ff0000" stroke="#ff0000" points="870.6687,-248.0667 860.0791,-247.7337 868.1497,-254.5978 870.6687,-248.0667"/>
</g>
<!-- sourcefile~phys_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~phys_param.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/phys_param.f90.html" xlink:title="phys_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="722.5,-570.5038 624.5,-570.5038 624.5,-546.5038 722.5,-546.5038 722.5,-570.5038"/>
<text text-anchor="middle" x="673.5" y="-556.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">phys_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~phys_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~init_beam_part_distrib.f90&#45;&gt;sourcefile~phys_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1000.4906,-407.8094C987.7759,-437.2295 951.1527,-511.492 894,-542.5038 844.6025,-569.3076 779.5754,-570.6837 732.9589,-566.9511"/>
<polygon fill="#ff0000" stroke="#ff0000" points="732.9871,-563.4395 722.7127,-566.0253 732.3572,-570.4111 732.9871,-563.4395"/>
</g>
<!-- sourcefile~grid_part_lib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node17" class="node">
<title>sourcefile~grid_part_lib.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node17"><a xlink:href=".././sourcefile/grid_part_lib.f90.html" xlink:title="grid_part_lib.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="723,-368.5038 624,-368.5038 624,-344.5038 723,-344.5038 723,-368.5038"/>
<text text-anchor="middle" x="673.5" y="-354.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_part_lib.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_util.f90&#45;&gt;sourcefile~grid_part_lib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~grid_part_util.f90&#45;&gt;sourcefile~grid_part_lib.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M778.1396,-425.4323C771.4996,-422.9303 764.9325,-419.9737 759,-416.5038 740.0029,-405.3928 740.9087,-395.2955 723,-382.5038 718.5074,-379.2949 713.5678,-376.2285 708.6015,-373.3997"/>
<polygon fill="#ff0000" stroke="#ff0000" points="710.1833,-370.276 699.7243,-368.5849 706.8459,-376.4292 710.1833,-370.276"/>
</g>
<!-- sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node20" class="node">
<title>sourcefile~pstruct_data.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node20"><a xlink:href=".././sourcefile/pstruct_data.f90.html" xlink:title="pstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="723,-448.5038 624,-448.5038 624,-424.5038 723,-424.5038 723,-448.5038"/>
<text text-anchor="middle" x="673.5" y="-434.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_util.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~grid_part_util.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M774.7012,-437.1653C761.4373,-437.0786 747.0635,-436.9847 733.4277,-436.8955"/>
<polygon fill="#ff0000" stroke="#ff0000" points="733.1974,-433.3941 723.1747,-436.8285 733.1516,-440.3939 733.1974,-433.3941"/>
</g>
<!-- sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node21" class="node">
<title>sourcefile~fstruct_data.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node21"><a xlink:href=".././sourcefile/fstruct_data.f90.html" xlink:title="fstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="721.5,-490.5038 625.5,-490.5038 625.5,-466.5038 721.5,-466.5038 721.5,-490.5038"/>
<text text-anchor="middle" x="673.5" y="-476.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_util.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~grid_part_util.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M781.4225,-449.5834C764.8433,-454.0262 745.8809,-459.1077 728.5236,-463.759"/>
<polygon fill="#ff0000" stroke="#ff0000" points="727.2727,-460.4706 718.5195,-466.4398 729.0847,-467.232 727.2727,-460.4706"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M758.6954,-397.1818C732.1206,-397.5163 701.3733,-397.5047 673.5,-396.5038"/>
</g>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~parallel.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/parallel.f90.html" xlink:title="parallel.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="555.5,-212.5038 479.5,-212.5038 479.5,-188.5038 555.5,-188.5038 555.5,-212.5038"/>
<text text-anchor="middle" x="517.5" y="-198.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">parallel.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M776.8547,-383.3855C770.6141,-380.9141 764.4989,-377.9782 759,-374.5038 739.058,-361.9038 740.419,-351.4105 723,-335.5038 682.0388,-298.099 665.2027,-296.6425 624,-259.5038 606.7194,-243.9277 607.8218,-233.6829 588,-221.5038 581.0377,-217.226 573.1516,-213.7747 565.2385,-211.004"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="566.2234,-207.6446 555.633,-207.9522 564.1036,-214.316 566.2234,-207.6446"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M781.4225,-407.5834C764.8433,-412.0262 745.8809,-417.1077 728.5236,-421.759"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="727.2727,-418.4706 718.5195,-424.4398 729.0847,-425.232 727.2727,-418.4706"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M776.4201,-407.6353C770.3154,-410.0981 764.3524,-413.0282 759,-416.5038 738.6621,-429.7106 742.6552,-443.3009 723,-457.5038 720.9476,-458.9869 718.7744,-460.3915 716.5291,-461.7175"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="714.8105,-458.6671 707.6139,-466.4427 718.0887,-464.852 714.8105,-458.6671"/>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~phys_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~phys_param.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M776.8253,-533.5167C762.7171,-536.9285 747.2152,-540.6773 732.6068,-544.21"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="731.5613,-540.8619 722.6642,-546.6145 733.2067,-547.6658 731.5613,-540.8619"/>
</g>
<!-- sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node18" class="node">
<title>sourcefile~grid_field_param.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node18"><a xlink:href=".././sourcefile/grid_field_param.f90.html" xlink:title="grid_field_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="579,-292.5038 456,-292.5038 456,-268.5038 579,-268.5038 579,-292.5038"/>
<text text-anchor="middle" x="517.5" y="-278.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_field_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M771.9725,-531.7982C726.5158,-537.0026 663.0862,-535.8858 624,-499.5038 558.5302,-438.5637 647.6848,-368.1201 588,-301.5038 587.1132,-300.514 586.1819,-299.57 585.2114,-298.6696"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="587.1883,-295.7775 577.0849,-292.588 582.9941,-301.3819 587.1883,-295.7775"/>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M776.3415,-509.492C770.2496,-507.0096 764.3111,-504.0422 759,-500.5038 738.2573,-486.6845 743.029,-472.3387 723,-457.5038 721.141,-456.127 719.1781,-454.8199 717.1488,-453.5819"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="718.4027,-450.2807 707.9427,-448.5955 715.0688,-456.4358 718.4027,-450.2807"/>
</g>
<!-- sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~init_grid_fields.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M783.4738,-509.4115C765.6426,-504.4001 744.7891,-498.5394 726.0635,-493.2766"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="726.7773,-489.8417 716.2032,-490.5054 724.8833,-496.5806 726.7773,-489.8417"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M785.9681,-365.5567C742.6118,-378.3488 679.256,-396.7105 673.5,-396.5038"/>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M673.5,-396.5038C602.5847,-393.9576 588.3416,-366.6173 517.5,-362.5038"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M817.662,-341.3441C793.863,-308.6756 729.7648,-221.2119 723,-217.5038 674.4657,-190.9008 609.6021,-190.23 565.8344,-193.8719"/>
<polygon fill="#5cff00" stroke="#5cff00" points="565.3633,-190.4007 555.7341,-194.8199 566.0174,-197.37 565.3633,-190.4007"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M777.6929,-365.5566C771.1879,-368.053 764.7773,-371.0131 759,-374.5038 739.6332,-386.2054 741.2231,-397.0905 723,-410.5038 718.7125,-413.6597 713.9902,-416.6567 709.2162,-419.418"/>
<polygon fill="#5cff00" stroke="#5cff00" points="707.1675,-416.5491 700.0725,-424.4175 710.5257,-422.691 707.1675,-416.5491"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M772.229,-365.6036C767.4391,-368.0447 762.9269,-370.9784 759,-374.5038 729.0796,-401.3657 751.546,-429.1858 723,-457.5038 721.9023,-458.5927 720.7395,-459.6286 719.5246,-460.6138"/>
<polygon fill="#5cff00" stroke="#5cff00" points="717.2445,-457.9286 710.8875,-466.4045 721.1426,-463.7428 717.2445,-457.9286"/>
</g>
<!-- sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node16" class="node">
<title>sourcefile~precision_def.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node16"><a xlink:href=".././sourcefile/precision_def.f90.html" xlink:title="precision_def.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="106,-152.5038 0,-152.5038 0,-128.5038 106,-128.5038 106,-152.5038"/>
<text text-anchor="middle" x="53" y="-138.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">precision_def.F90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M303.1958,-312.4511C272.603,-305.2296 232.2467,-294.3387 198,-280.5038"/>
</g>
<!-- sourcefile~struct_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node22" class="node">
<title>sourcefile~struct_def.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node22"><a xlink:href=".././sourcefile/struct_def.f90.html" xlink:title="struct_def.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="240.5,-334.5038 155.5,-334.5038 155.5,-310.5038 240.5,-310.5038 240.5,-334.5038"/>
<text text-anchor="middle" x="198" y="-320.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">struct_def.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M303.084,-322.5038C286.5752,-322.5038 267.9516,-322.5038 251.018,-322.5038"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="250.727,-319.0039 240.7269,-322.5038 250.7269,-326.0039 250.727,-319.0039"/>
</g>
<!-- sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ffb9" stroke-dasharray="5,2" d="M170.3586,-72.6019C161.2242,-76.7939 151.0793,-81.6609 142,-86.5038 120.8163,-97.8034 97.6521,-111.9169 80.2672,-122.8811"/>
<polygon fill="#00ffb9" stroke="#00ffb9" points="78.3077,-119.9794 71.7439,-128.2961 82.0614,-125.8878 78.3077,-119.9794"/>
</g>
<!-- sourcefile~array_alloc.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge31" class="edge">
<title>sourcefile~array_alloc.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#00b9ff" stroke-dasharray="5,2" d="M783.4738,-467.4115C765.6426,-462.4001 744.7891,-456.5394 726.0635,-451.2766"/>
<polygon fill="#00b9ff" stroke="#00b9ff" points="726.7773,-447.8417 716.2032,-448.5054 724.8833,-454.5806 726.7773,-447.8417"/>
</g>
<!-- sourcefile~array_alloc.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge30" class="edge">
<title>sourcefile~array_alloc.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#00b9ff" stroke-dasharray="5,2" d="M780.1798,-479.2011C764.9563,-479.1016 747.834,-478.9897 731.8364,-478.8851"/>
<polygon fill="#00b9ff" stroke="#00b9ff" points="731.5401,-475.3832 721.5174,-478.8177 731.4943,-482.3831 731.5401,-475.3832"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge33" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#002eff" stroke-dasharray="5,2" d="M323.2361,-76.9283C302.529,-74.2126 273.4636,-70.4007 248.5457,-67.1328"/>
<polygon fill="#002eff" stroke="#002eff" points="248.8855,-63.6475 238.5152,-65.8173 247.9752,-70.588 248.8855,-63.6475"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge32" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#002eff" stroke-dasharray="5,2" d="M323.43,-85.1501C283.5858,-92.0833 206.8532,-105.7951 142,-119.5038 132.331,-121.5477 122.1019,-123.8393 112.1567,-126.1372"/>
<polygon fill="#002eff" stroke="#002eff" points="111.2806,-122.7476 102.3375,-128.4284 112.8712,-129.5645 111.2806,-122.7476"/>
</g>
<!-- sourcefile~control_bunch_input.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge34" class="edge">
<title>sourcefile~control_bunch_input.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M453.7412,-9.4871C375.6833,1.9625 241.6018,10.8455 142,-39.5038 106.8304,-57.2823 79.3792,-95.4581 64.7366,-119.4484"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="61.6577,-117.7793 59.5945,-128.1713 67.6879,-121.3341 61.6577,-117.7793"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge38" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M792.7589,-246.1703C761.547,-253.5339 714.0016,-265.4424 673.5,-278.5038"/>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M673.5,-278.5038C628.0696,-293.1548 630.8436,-322.4564 588,-343.5038 558.8736,-357.8126 549.8967,-364.385 517.5,-362.5038"/>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M517.5,-362.5038C475.1528,-360.045 428.2916,-347.9634 395.015,-337.715"/>
<polygon fill="#e700ff" stroke="#e700ff" points="395.7335,-334.2718 385.1439,-334.606 393.6305,-340.9485 395.7335,-334.2718"/>
</g>
<!-- sourcefile~prl_fft.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~prl_fft.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/prl_fft.f90.html" xlink:title="prl_fft.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="705.5,-132.5038 641.5,-132.5038 641.5,-108.5038 705.5,-108.5038 705.5,-132.5038"/>
<text text-anchor="middle" x="673.5" y="-118.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">prl_fft.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge35" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M814.8783,-226.4331C796.5243,-207.7899 759.183,-171.5321 723,-146.5038 718.4096,-143.3286 713.384,-140.268 708.3504,-137.4309"/>
<polygon fill="#e700ff" stroke="#e700ff" points="709.8362,-134.2556 699.3734,-132.5886 706.513,-140.4165 709.8362,-134.2556"/>
</g>
<!-- sourcefile~grid_fields.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~grid_fields.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/grid_fields.f90.html" xlink:title="grid_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="717.5,-250.5038 629.5,-250.5038 629.5,-226.5038 717.5,-226.5038 717.5,-250.5038"/>
<text text-anchor="middle" x="673.5" y="-236.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge36" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M792.9235,-238.5038C773.8629,-238.5038 749.5461,-238.5038 727.8358,-238.5038"/>
<polygon fill="#e700ff" stroke="#e700ff" points="727.7484,-235.0039 717.7483,-238.5038 727.7483,-242.0039 727.7484,-235.0039"/>
</g>
<!-- sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node19" class="node">
<title>sourcefile~common_param.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node19"><a xlink:href=".././sourcefile/common_param.f90.html" xlink:title="common_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="411,-250.5038 290,-250.5038 290,-226.5038 411,-226.5038 411,-250.5038"/>
<text text-anchor="middle" x="350.5" y="-236.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">common_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge37" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M806.7271,-226.4246C786.4967,-214.7327 753.756,-197.6215 723,-189.5038 604.3172,-158.179 565.1556,-146.2455 447,-179.5038 419.0965,-187.3581 391.2857,-205.7728 372.7391,-219.9569"/>
<polygon fill="#e700ff" stroke="#e700ff" points="370.3516,-217.3821 364.6609,-226.319 374.6826,-222.8814 370.3516,-217.3821"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge39" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M816.5338,-250.7599C802.6049,-268.2293 777.0044,-301.6044 759,-332.5038 739.7779,-365.4931 749.2975,-382.8232 723,-410.5038 720.029,-413.6312 716.5979,-416.4562 712.956,-418.9896"/>
<polygon fill="#e700ff" stroke="#e700ff" points="710.8788,-416.1581 704.1928,-424.3769 714.5448,-422.1213 710.8788,-416.1581"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge40" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M815.6167,-250.6928C800.8458,-267.82 774.5187,-300.5074 759,-332.5038 733.7705,-384.522 761.3378,-414.23 723,-457.5038 722.1295,-458.4865 721.2052,-459.4245 720.2358,-460.3198"/>
<polygon fill="#e700ff" stroke="#e700ff" points="718.0089,-457.6138 712.0602,-466.3809 722.1778,-463.237 718.0089,-457.6138"/>
</g>
<!-- sourcefile~phys_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge41" class="edge">
<title>sourcefile~phys_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff008b" stroke-dasharray="5,2" d="M624.2785,-554.1114C593.378,-552.4338 552.8296,-552.2126 517.5,-558.5038"/>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge43" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M500.5681,-188.3372C471.0607,-167.1343 410.0809,-123.3164 375.6288,-98.5605"/>
<polygon fill="#ff0000" stroke="#ff0000" points="377.64,-95.6958 367.4767,-92.7027 373.5552,-101.3804 377.64,-95.6958"/>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge42" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M479.1868,-209.2218C459.7295,-213.6492 435.5879,-219.1425 413.4893,-224.171"/>
<polygon fill="#ff0000" stroke="#ff0000" points="412.478,-220.8115 403.5038,-226.4431 414.0312,-227.637 412.478,-220.8115"/>
</g>
<!-- sourcefile~mpi_var.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node25" class="node">
<title>sourcefile~mpi_var.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node25"><a xlink:href=".././sourcefile/mpi_var.f90.html" xlink:title="mpi_var.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="388,-292.5038 313,-292.5038 313,-268.5038 388,-268.5038 388,-292.5038"/>
<text text-anchor="middle" x="350.5" y="-278.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_var.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge44" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M498.0019,-212.6436C477.0335,-225.3772 442.4594,-245.455 411,-259.5038 406.66,-261.4419 402.0824,-263.3184 397.4676,-265.0997"/>
<polygon fill="#ff0000" stroke="#ff0000" points="396.1637,-261.8502 388.0069,-268.6117 398.5998,-268.4127 396.1637,-261.8502"/>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge46" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M649.807,-132.6541C623.1955,-146.301 579.8417,-168.5338 550.0592,-183.8068"/>
<polygon fill="#ff9900" stroke="#ff9900" points="548.2059,-180.8238 540.9049,-188.5014 551.4002,-187.0525 548.2059,-180.8238"/>
</g>
<!-- sourcefile~modern_fft_lib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node23" class="node">
<title>sourcefile~modern_fft_lib.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node23"><a xlink:href=".././sourcefile/modern_fft_lib.f90.html" xlink:title="modern_fft_lib.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="254,-152.5038 142,-152.5038 142,-128.5038 254,-128.5038 254,-152.5038"/>
<text text-anchor="middle" x="198" y="-138.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modern_fft_lib.F90</text>
</a>
</g>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~modern_fft_lib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge45" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~modern_fft_lib.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M641.1908,-121.8628C564.0165,-125.1088 367.6881,-133.3666 264.1807,-137.7202"/>
<polygon fill="#ff9900" stroke="#ff9900" points="264.0011,-134.2246 254.157,-138.1418 264.2953,-141.2184 264.0011,-134.2246"/>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge47" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M629.2139,-227.7162C609.3325,-222.8733 585.8325,-217.1489 565.5281,-212.203"/>
<polygon fill="#cbff00" stroke="#cbff00" points="566.0877,-208.737 555.5434,-209.7708 564.4309,-215.5382 566.0877,-208.737"/>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge48" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M629.2139,-250.427C611.423,-255.2169 590.7344,-260.7869 572.031,-265.8224"/>
<polygon fill="#cbff00" stroke="#cbff00" points="570.9137,-262.4985 562.1674,-268.478 572.7335,-269.2579 570.9137,-262.4985"/>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge51" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M623.9447,-360.8468C593.27,-362.9302 553.081,-364.5699 517.5,-362.5038"/>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge50" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M643.2108,-344.3762C636.3299,-340.6474 629.4515,-336.0344 624,-330.5038 599.163,-305.3071 617.3027,-279.3307 588,-259.5038 539.4888,-226.6802 472.0444,-223.7265 421.4183,-227.6504"/>
<polygon fill="#00ff66" stroke="#00ff66" points="420.8595,-224.1861 411.206,-228.5519 421.475,-231.159 420.8595,-224.1861"/>
</g>
<!-- sourcefile~stretched_grid.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node24" class="node">
<title>sourcefile~stretched_grid.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_node24"><a xlink:href=".././sourcefile/stretched_grid.f90.html" xlink:title="stretched_grid.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="572,-334.5038 463,-334.5038 463,-310.5038 572,-310.5038 572,-334.5038"/>
<text text-anchor="middle" x="517.5" y="-320.1038" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">stretched_grid.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~stretched_grid.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge49" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~stretched_grid.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M623.7117,-345.6526C610.5091,-342.7751 596.0603,-339.626 582.1901,-336.603"/>
<polygon fill="#00ff66" stroke="#00ff66" points="582.7347,-333.1396 572.2187,-334.4297 581.244,-339.979 582.7347,-333.1396"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge53" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M469.6445,-292.5394C450.2625,-297.4139 427.726,-303.0817 407.503,-308.1678"/>
<polygon fill="#00ffff" stroke="#00ffff" points="406.6294,-304.7784 397.7851,-310.6118 408.3368,-311.567 406.6294,-304.7784"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge52" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M469.6445,-268.4683C450.5155,-263.6574 428.3139,-258.0738 408.2961,-253.0394"/>
<polygon fill="#00ffff" stroke="#00ffff" points="408.9142,-249.5859 398.3625,-250.5411 407.2068,-256.3745 408.9142,-249.5859"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge54" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M455.7898,-280.5038C436.8382,-280.5038 416.2765,-280.5038 398.3952,-280.5038"/>
<polygon fill="#00ffff" stroke="#00ffff" points="398.2091,-277.0039 388.2091,-280.5038 398.2091,-284.0039 398.2091,-277.0039"/>
</g>
<!-- sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge55" class="edge">
<title>sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M315.5542,-250.5309C274.0261,-264.447 208.9488,-284.9269 198,-280.5038"/>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M198,-280.5038C137.7968,-256.1833 88.6885,-193.5674 66.2203,-160.948"/>
<polygon fill="#0066ff" stroke="#0066ff" points="69.0893,-158.9422 60.6025,-152.5999 63.2818,-162.8504 69.0893,-158.9422"/>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge56" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#3200ff" stroke-dasharray="5,2" d="M350.5,-520.5038C284.0994,-506.9103 251.3308,-562.3327 198,-520.5038"/>
<path fill="none" stroke="#3200ff" stroke-dasharray="5,2" d="M198,-520.5038C80.6124,-428.4336 58.2224,-229.5079 53.982,-162.8141"/>
<polygon fill="#3200ff" stroke="#3200ff" points="57.4646,-162.4027 53.4134,-152.613 50.4754,-162.7924 57.4646,-162.4027"/>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge57" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#3200ff" stroke-dasharray="5,2" d="M643.4262,-448.5578C574.4443,-475.5198 406.4736,-537.0791 350.5,-520.5038"/>
<path fill="none" stroke="#3200ff" stroke-dasharray="5,2" d="M350.5,-520.5038C265.5351,-503.1098 220.2805,-392.17 204.5229,-344.3681"/>
<polygon fill="#3200ff" stroke="#3200ff" points="207.8079,-343.1482 201.4494,-334.6735 201.1352,-345.2637 207.8079,-343.1482"/>
</g>
<!-- sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge58" class="edge">
<title>sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M658.7647,-490.5951C632.4036,-511.13 574.5734,-551.3032 517.5,-558.5038"/>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M517.5,-558.5038C375.6239,-576.4036 310.52,-608.7563 198,-520.5038"/>
</g>
<!-- sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge59" class="edge">
<title>sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0098" stroke-dasharray="5,2" d="M166.0095,-310.482C157.5589,-306.2959 148.8857,-300.9859 142,-294.5038 101.2196,-256.1143 73.5504,-194.8217 60.8838,-162.3483"/>
<polygon fill="#ff0098" stroke="#ff0098" points="64.1145,-160.9964 57.3008,-152.8832 57.5678,-163.4746 64.1145,-160.9964"/>
</g>
<!-- sourcefile~modern_fft_lib.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge60" class="edge">
<title>sourcefile~modern_fft_lib.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M141.9392,-140.5038C133.554,-140.5038 124.859,-140.5038 116.3358,-140.5038"/>
<polygon fill="#ff0000" stroke="#ff0000" points="116.0569,-137.0039 106.0569,-140.5038 116.0569,-144.0039 116.0569,-137.0039"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge62" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M462.818,-322.5038C445.2443,-322.5038 425.7294,-322.5038 407.9623,-322.5038"/>
<polygon fill="#00ff00" stroke="#00ff00" points="407.7312,-319.0039 397.7311,-322.5038 407.7311,-326.0039 407.7312,-319.0039"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge61" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M464.7884,-310.4951C458.5472,-308.0176 452.4629,-305.0505 447,-301.5038 426.3793,-288.1162 431.3171,-273.3479 411,-259.5038 408.5882,-257.8604 406.0348,-256.3332 403.3944,-254.9157"/>
<polygon fill="#00ff00" stroke="#00ff00" points="404.6927,-251.6572 394.1602,-250.5092 401.6779,-257.9748 404.6927,-251.6572"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge63" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M469.6445,-310.4683C447.1609,-304.8138 420.4326,-298.0917 397.9946,-292.4486"/>
<polygon fill="#00ff00" stroke="#00ff00" points="398.5696,-288.9843 388.0179,-289.9395 396.8622,-295.7729 398.5696,-288.9843"/>
</g>
<!-- sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~EfferentGraph_edge64" class="edge">
<title>sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M312.9716,-288.1081C281.1572,-292.8052 234.9452,-295.4288 198,-280.5038"/>
</g>
</g>
</svg>
</div><script>var pansourcefileinit_beam_part_distribf90EfferentGraph = svgPanZoom('#sourcefileinit_beam_part_distribf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~init_beam_part_distrib.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileinit_beam_part_distribf90AfferentGraph" width="271pt" height="32pt"
 viewBox="0.00 0.00 271.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~init_beam_part_distrib.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>sourcefile~~init_beam_part_distrib.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 267,-28 267,4 -4,4"/>
<!-- sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~init_beam_part_distrib.f90</title>
<polygon fill="none" stroke="#000000" points="151,-24 0,-24 0,0 151,0 151,-24"/>
<text text-anchor="middle" x="75.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">init_beam_part_distrib.f90</text>
</g>
<!-- sourcefile~aladyn.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~aladyn.f90</title>
<g id="a_sourcefile~~init_beam_part_distrib.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/aladyn.f90.html" xlink:title="ALaDyn.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="263,-24 187,-24 187,0 263,0 263,-24"/>
<text text-anchor="middle" x="225" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALaDyn.F90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90 -->
<g id="sourcefile~~init_beam_part_distrib.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~init_beam_part_distrib.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M186.888,-12C178.9054,-12 170.1823,-12 161.2447,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="161.0909,-8.5001 151.0909,-12 161.0909,-15.5001 161.0909,-8.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/init_beam_part_distrib.html">init_beam_part_distrib</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/init_beam_part_distrib.f90.html#src">init_beam_part_distrib.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-2"></a><span class="c">!                            Copyright 2008-2020  The ALaDyn Collaboration                            !</span>
<a name="ln-3"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-4"></a>
<a name="ln-5"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-6"></a><span class="c">!  This file is part of ALaDyn.                                                                       !</span>
<a name="ln-7"></a><span class="c">!                                                                                                     !</span>
<a name="ln-8"></a><span class="c">!  ALaDyn is free software: you can redistribute it and/or modify                                     !</span>
<a name="ln-9"></a><span class="c">!  it under the terms of the GNU General Public License as published by                               !</span>
<a name="ln-10"></a><span class="c">!  the Free Software Foundation, either version 3 of the License, or                                  !</span>
<a name="ln-11"></a><span class="c">!  (at your option) any later version.                                                                !</span>
<a name="ln-12"></a><span class="c">!                                                                                                     !</span>
<a name="ln-13"></a><span class="c">!  ALaDyn is distributed in the hope that it will be useful,                                          !</span>
<a name="ln-14"></a><span class="c">!  but WITHOUT ANY WARRANTY; without even the implied warranty of                                     !</span>
<a name="ln-15"></a><span class="c">!  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                      !</span>
<a name="ln-16"></a><span class="c">!  GNU General Public License for more details.                                                       !</span>
<a name="ln-17"></a><span class="c">!                                                                                                     !</span>
<a name="ln-18"></a><span class="c">!  You should have received a copy of the GNU General Public License                                  !</span>
<a name="ln-19"></a><span class="c">!  along with ALaDyn.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                                    !</span>
<a name="ln-20"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-21"></a>
<a name="ln-22"></a> <span class="k">module </span><span class="n">init_beam_part_distrib</span>
<a name="ln-23"></a>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">util</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">psolve</span>
<a name="ln-26"></a>  <span class="k">use </span><span class="n">array_alloc</span>
<a name="ln-27"></a>  <span class="k">use </span><span class="n">grid_param</span>
<a name="ln-28"></a>  <span class="k">use </span><span class="n">mpi_field_interface</span>
<a name="ln-29"></a>  <span class="k">use </span><span class="n">mpi_curr_interface</span>
<a name="ln-30"></a>  <span class="k">use </span><span class="n">init_grid_field</span>
<a name="ln-31"></a>  <span class="k">use </span><span class="n">grid_part_util</span>
<a name="ln-32"></a>  <span class="k">use </span><span class="n">code_util</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">maxv</span><span class="p">,</span> <span class="n">mem_psize</span>
<a name="ln-33"></a>  <span class="k">use </span><span class="n">control_bunch_input</span>
<a name="ln-34"></a>  <span class="k">use </span><span class="n">phys_param</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">t_unit</span>
<a name="ln-35"></a>
<a name="ln-36"></a>  <span class="k">implicit none</span>
<a name="ln-37"></a>
<a name="ln-38"></a><span class="k">  </span><span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">bpart</span><span class="p">(:,</span> <span class="p">:)</span>
<a name="ln-39"></a>  <span class="c">!--------------------------</span>
<a name="ln-40"></a>
<a name="ln-41"></a> <span class="k">contains</span>
<a name="ln-42"></a>  <span class="c">!=========================</span>
<a name="ln-43"></a>  <span class="k">subroutine </span><span class="n">beam_data</span><span class="p">(</span><span class="n">ndm</span><span class="p">)</span> <span class="c">!generates bunch phase space distribution in</span>
<a name="ln-44"></a>                                    <span class="c">!                             ebfb(npart,nch)</span>
<a name="ln-45"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ndm</span>
<a name="ln-46"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np_tot</span>
<a name="ln-47"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">ip</span>
<a name="ln-48"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cut</span><span class="p">,</span> <span class="n">xb</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">jp_norm</span>
<a name="ln-49"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nch</span>
<a name="ln-50"></a>   <span class="kt">logical</span> <span class="kd">::</span> <span class="n">data_snd</span>
<a name="ln-51"></a>   <span class="c">!==========================================================</span>
<a name="ln-52"></a>   <span class="c">! bconf defines only the configuration of bunch charges</span>
<a name="ln-53"></a>   <span class="c">!=======================</span>
<a name="ln-54"></a>   <span class="c">! default values</span>
<a name="ln-55"></a>   <span class="c">!=======================</span>
<a name="ln-56"></a>   <span class="n">jp_norm</span><span class="o">=</span><span class="mf">1.</span>
<a name="ln-57"></a>   <span class="n">np_tot</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-58"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-59"></a>    <span class="n">np_tot</span> <span class="o">=</span> <span class="n">np_tot</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-60"></a>   <span class="k">end do</span>
<a name="ln-61"></a><span class="k">   </span><span class="n">cut</span> <span class="o">=</span> <span class="mf">3.</span>
<a name="ln-62"></a>   <span class="n">nch</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">ndm</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-63"></a>   <span class="k">allocate</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">np_tot</span><span class="p">,</span><span class="n">nch</span><span class="p">))</span>
<a name="ln-64"></a>   <span class="c">!---!</span>
<a name="ln-65"></a>   <span class="n">i1</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-66"></a>   <span class="n">charge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">unit_charge</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">hp_int</span><span class="p">)</span> <span class="c">!the particle charge of each electron bunche</span>
<a name="ln-67"></a>   <span class="c">!===============================</span>
<a name="ln-68"></a>  <span class="k">if</span><span class="p">(</span><span class="n">pe0</span><span class="p">)</span><span class="k">then</span>                 <span class="c">!only pe0 generates particle distribution</span>
<a name="ln-69"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">ndm</span><span class="p">)</span>
<a name="ln-70"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-71"></a>    <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-72"></a>     <span class="n">xb</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="o">=</span> <span class="n">xc_bunch</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-73"></a>     <span class="n">wgh</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">jp_norm</span><span class="o">*</span><span class="n">jb_norm</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">sp</span><span class="p">)</span> <span class="c">!the bunch particle weight</span>
<a name="ln-74"></a>     <span class="n">part_ind</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">hp_int</span><span class="p">)</span>
<a name="ln-75"></a>     <span class="n">i2</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-76"></a>     <span class="k">call </span><span class="n">bunch_gen</span><span class="p">(</span><span class="n">ndm</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">sxb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">syb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">syb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">gam</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-77"></a>       <span class="n">epsy</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">epsz</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">cut</span><span class="p">,</span> <span class="n">dg</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">)</span>
<a name="ln-78"></a>
<a name="ln-79"></a>     <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xb</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="c">!x-shifting</span>
<a name="ln-80"></a>     <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">yc_bunch</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="c">!y-shifting</span>
<a name="ln-81"></a>     <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span><span class="n">nch</span><span class="p">)</span> <span class="o">=</span> <span class="n">wgh_cmp</span>
<a name="ln-82"></a>     <span class="n">i1</span> <span class="o">=</span> <span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-83"></a>    <span class="k">end do</span>
<a name="ln-84"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-85"></a>    <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-86"></a>     <span class="n">xb</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="o">=</span> <span class="n">xc_bunch</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a name="ln-87"></a>     <span class="n">wgh</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">jp_norm</span><span class="o">*</span><span class="n">jb_norm</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">sp</span><span class="p">)</span> <span class="c">!the bunch particle weights</span>
<a name="ln-88"></a>     <span class="n">part_ind</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">hp_int</span><span class="p">)</span>
<a name="ln-89"></a>     <span class="n">i2</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-90"></a><span class="c">!====================</span>
<a name="ln-91"></a>     <span class="k">call </span><span class="n">bunch_gen</span><span class="p">(</span><span class="n">ndm</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">sxb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">syb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">syb</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">gam</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-92"></a>       <span class="n">epsy</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">epsz</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">cut</span><span class="p">,</span> <span class="n">dg</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">)</span>
<a name="ln-93"></a><span class="c">!=====================</span>
<a name="ln-94"></a>     <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xb</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="c">!x-shifting</span>
<a name="ln-95"></a>     <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">yc_bunch</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="c">!y-shifting</span>
<a name="ln-96"></a>     <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">zc_bunch</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="c">!y-shifting</span>
<a name="ln-97"></a>     <span class="n">ebfb</span><span class="p">(</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span><span class="n">nch</span><span class="p">)</span> <span class="o">=</span> <span class="n">wgh_cmp</span>
<a name="ln-98"></a>     <span class="n">i1</span> <span class="o">=</span> <span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-99"></a>    <span class="k">end do</span>
<a name="ln-100"></a><span class="k">   end select</span>
<a name="ln-101"></a><span class="k">   </span><span class="n">data_snd</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>            <span class="c">!pe0 sends data to all mpi-task</span>
<a name="ln-102"></a>   <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-103"></a>    <span class="k">call </span><span class="n">exchange_2d_grdata</span><span class="p">(</span><span class="n">data_snd</span><span class="p">,</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">nch</span><span class="p">,</span> <span class="n">np_tot</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">ip</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
<a name="ln-104"></a>   <span class="k">end do</span>
<a name="ln-105"></a><span class="k">  else</span>
<a name="ln-106"></a><span class="k">   </span><span class="n">data_snd</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>           <span class="c">!current mype mpi-task receves particle data for pe0</span>
<a name="ln-107"></a>   <span class="k">call </span><span class="n">exchange_2d_grdata</span><span class="p">(</span><span class="n">data_snd</span><span class="p">,</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">nch</span><span class="p">,</span> <span class="n">np_tot</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mype</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
<a name="ln-108"></a>  <span class="k">end if</span>
<a name="ln-109"></a>  <span class="c">!==============================</span>
<a name="ln-110"></a>  <span class="k">end subroutine</span>
<a name="ln-111"></a>  <span class="c">!===================</span>
<a name="ln-112"></a>  <span class="k">subroutine </span><span class="n">mpi_beam_ftgrid_distribute</span><span class="p">(</span><span class="n">ndm</span><span class="p">)</span>
<a name="ln-113"></a>
<a name="ln-114"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ndm</span>
<a name="ln-115"></a>
<a name="ln-116"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-117"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ic</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">ipp</span><span class="p">,</span> <span class="n">nb_loc</span>
<a name="ln-118"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span>
<a name="ln-119"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nps_loc</span><span class="p">(</span><span class="n">nsb</span><span class="p">),</span> <span class="n">npmax</span><span class="p">,</span> <span class="n">np_tot</span>
<a name="ln-120"></a>   <span class="c">!========= count bunch particles on each (yz) MPI domain in uniform ftgrid</span>
<a name="ln-121"></a>   <span class="n">np_tot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nb_tot</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-122"></a>   <span class="c">! ALL MPI tasks do</span>
<a name="ln-123"></a>   <span class="n">x1</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-124"></a>   <span class="n">x2</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-125"></a>   <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-126"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">ndm</span><span class="p">)</span>
<a name="ln-127"></a><span class="c">!================== 1:   counts local bunch particles of each bunch</span>
<a name="ln-128"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-129"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-130"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-131"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-132"></a>      <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-133"></a>       <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-134"></a>       <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-135"></a>       <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-136"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-137"></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">j</span>
<a name="ln-138"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-139"></a><span class="k">         if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-140"></a><span class="k">          </span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-141"></a>         <span class="k">end if</span>
<a name="ln-142"></a><span class="k">        end if</span>
<a name="ln-143"></a><span class="k">       end do</span>
<a name="ln-144"></a><span class="k">      end do</span>
<a name="ln-145"></a><span class="k">     end do</span>
<a name="ln-146"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-147"></a>    <span class="k">end do</span>
<a name="ln-148"></a><span class="k">    </span><span class="n">nb_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-149"></a>      <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-150"></a>    <span class="n">nb_min</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-151"></a>      <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-152"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-153"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-154"></a>      <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-155"></a>       <span class="n">i</span> <span class="o">=</span> <span class="n">ipp</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="p">(</span><span class="n">ip</span><span class="o">+</span><span class="n">p</span><span class="o">*</span><span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-156"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ic</span><span class="p">)</span><span class="o">==</span><span class="n">nb_max</span><span class="p">)</span> <span class="n">pe_nbmax</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-157"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ic</span><span class="p">)</span><span class="o">==</span><span class="n">nb_min</span><span class="p">)</span> <span class="n">pe_nbmin</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-158"></a>      <span class="k">end do</span>
<a name="ln-159"></a><span class="k">     end do</span>
<a name="ln-160"></a><span class="k">    end do</span>
<a name="ln-161"></a>    <span class="c">!==================</span>
<a name="ln-162"></a>    <span class="c">! The local particle number of each bunch </span>
<a name="ln-163"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-164"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-165"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-166"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-167"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span><span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-168"></a>    <span class="k">else</span>
<a name="ln-169"></a><span class="k">     deallocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">)</span>
<a name="ln-170"></a>     <span class="k">allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span><span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-171"></a>    <span class="k">end if</span>
<a name="ln-172"></a>    <span class="c">!=================================</span>
<a name="ln-173"></a>    <span class="c">!                            2: selected particle coordinates are copied in</span>
<a name="ln-174"></a>    <span class="c">!                            bunch%part array</span>
<a name="ln-175"></a>    <span class="n">nb_loc</span> <span class="o">=</span> <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-176"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-177"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-178"></a>    <span class="n">ipp</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-179"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-180"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-181"></a>    <span class="c">!=========================</span>
<a name="ln-182"></a>    <span class="c">! Here 2D MPI decomp. allowed</span>
<a name="ln-183"></a>    <span class="c">!===================================</span>
<a name="ln-184"></a>    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-185"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-186"></a>     <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-187"></a>     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-188"></a>      <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">i1</span>
<a name="ln-189"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-190"></a><span class="k">       if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-191"></a><span class="k">        </span><span class="n">ii</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-192"></a>        <span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-193"></a>       <span class="k">end if</span>
<a name="ln-194"></a><span class="k">      end if</span>
<a name="ln-195"></a><span class="k">     end do</span>
<a name="ln-196"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-197"></a>    <span class="k">end do</span>
<a name="ln-198"></a><span class="c">!================== 1:   counts local bunch particles of each bunch</span>
<a name="ln-199"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-200"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-201"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-202"></a>      <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-203"></a>       <span class="n">z1</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-204"></a>       <span class="n">z2</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-205"></a>       <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-206"></a>        <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-207"></a>        <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-208"></a>        <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-209"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-210"></a>         <span class="n">i</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">j</span>
<a name="ln-211"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-212"></a><span class="k">          if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">&gt;</span><span class="n">z1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">z2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-213"></a><span class="k">           if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-214"></a><span class="k">            </span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-215"></a>           <span class="k">end if</span>
<a name="ln-216"></a><span class="k">          end if</span>
<a name="ln-217"></a><span class="k">         end if</span>
<a name="ln-218"></a><span class="k">        end do</span>
<a name="ln-219"></a><span class="k">       end do</span>
<a name="ln-220"></a><span class="k">      end do</span>
<a name="ln-221"></a><span class="k">     end do</span>
<a name="ln-222"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-223"></a>    <span class="k">end do</span>
<a name="ln-224"></a><span class="k">    </span><span class="n">nb_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-225"></a>      <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-226"></a>    <span class="n">nb_min</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-227"></a>      <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-228"></a>    <span class="c">!==================</span>
<a name="ln-229"></a>    <span class="c">! The local MPI task</span>
<a name="ln-230"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-231"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-232"></a>    <span class="c">!==================</span>
<a name="ln-233"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-234"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-235"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span><span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-236"></a>    <span class="k">else</span>
<a name="ln-237"></a><span class="k">     deallocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">)</span>
<a name="ln-238"></a>     <span class="k">allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span><span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-239"></a>    <span class="k">end if</span>
<a name="ln-240"></a>    <span class="c">!=================================</span>
<a name="ln-241"></a>    <span class="c">!                            2: selected particle coordinates are copied in</span>
<a name="ln-242"></a>    <span class="c">!                            bunch%part array</span>
<a name="ln-243"></a>    <span class="n">nb_loc</span> <span class="o">=</span> <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-244"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-245"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-246"></a>    <span class="n">z1</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-247"></a>    <span class="n">z2</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-248"></a>    <span class="n">ipp</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-249"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-250"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-251"></a>    <span class="c">!=========================</span>
<a name="ln-252"></a>    <span class="c">! Here 3D MPI decomp. allowed</span>
<a name="ln-253"></a>    <span class="c">!===================================</span>
<a name="ln-254"></a>    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-255"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-256"></a>     <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-257"></a>     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-258"></a>      <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">i1</span>
<a name="ln-259"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-260"></a><span class="k">       if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">&gt;</span><span class="n">z1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">z2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-261"></a><span class="k">        if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-262"></a><span class="k">         </span><span class="n">ii</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-263"></a>         <span class="n">bunch</span><span class="p">(</span><span class="n">ic</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-264"></a>        <span class="k">end if</span>
<a name="ln-265"></a><span class="k">       end if</span>
<a name="ln-266"></a><span class="k">      end if</span>
<a name="ln-267"></a><span class="k">     end do</span>
<a name="ln-268"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-269"></a>    <span class="k">end do</span>
<a name="ln-270"></a><span class="k">   end select</span>
<a name="ln-271"></a><span class="k">  end subroutine</span>
<a name="ln-272"></a>  <span class="c">!=================================</span>
<a name="ln-273"></a>  <span class="k">subroutine </span><span class="n">mpi_beam_distribute</span><span class="p">(</span><span class="n">ndm</span><span class="p">)</span>
<a name="ln-274"></a>
<a name="ln-275"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ndm</span>
<a name="ln-276"></a>
<a name="ln-277"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-278"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ic</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">ipp</span><span class="p">,</span> <span class="n">nb_loc</span>
<a name="ln-279"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span>
<a name="ln-280"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nps_loc</span><span class="p">(</span><span class="n">nsb</span><span class="p">),</span> <span class="n">npmax</span><span class="p">,</span> <span class="n">np_tot</span>
<a name="ln-281"></a>   <span class="c">!========= count bunch particles on each (yz) MPI domain</span>
<a name="ln-282"></a>   <span class="n">np_tot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nb_tot</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-283"></a>   <span class="c">! ALL MPI tasks do</span>
<a name="ln-284"></a>   <span class="n">x1</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-285"></a>   <span class="n">x2</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-286"></a>   <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-287"></a>   <span class="k">select case</span> <span class="p">(</span><span class="n">ndm</span><span class="p">)</span>
<a name="ln-288"></a><span class="c">!================== 1:   counts local bunch particles of each bunch</span>
<a name="ln-289"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-290"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-291"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-292"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-293"></a>      <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-294"></a>       <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-295"></a>       <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-296"></a>       <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-297"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-298"></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">j</span>
<a name="ln-299"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-300"></a><span class="k">         if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-301"></a><span class="k">          </span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-302"></a>         <span class="k">end if</span>
<a name="ln-303"></a><span class="k">        end if</span>
<a name="ln-304"></a><span class="k">       end do</span>
<a name="ln-305"></a><span class="k">      end do</span>
<a name="ln-306"></a><span class="k">     end do</span>
<a name="ln-307"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-308"></a>    <span class="k">end do</span>
<a name="ln-309"></a><span class="k">    </span><span class="n">nb_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-310"></a>      <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-311"></a>    <span class="n">nb_min</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-312"></a>      <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-313"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-314"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-315"></a>      <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-316"></a>       <span class="n">i</span> <span class="o">=</span> <span class="n">ipp</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="p">(</span><span class="n">ip</span><span class="o">+</span><span class="n">p</span><span class="o">*</span><span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-317"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ic</span><span class="p">)</span><span class="o">==</span><span class="n">nb_max</span><span class="p">)</span> <span class="n">pe_nbmax</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-318"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ic</span><span class="p">)</span><span class="o">==</span><span class="n">nb_min</span><span class="p">)</span> <span class="n">pe_nbmin</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-319"></a>      <span class="k">end do</span>
<a name="ln-320"></a><span class="k">     end do</span>
<a name="ln-321"></a><span class="k">    end do</span>
<a name="ln-322"></a>    <span class="c">!==================</span>
<a name="ln-323"></a>    <span class="c">! The local particle number of each bunch </span>
<a name="ln-324"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-325"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-326"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-327"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-328"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span><span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-329"></a>    <span class="k">end if</span>
<a name="ln-330"></a>    <span class="c">!=================================</span>
<a name="ln-331"></a>    <span class="c">!              2: selected particle coordinates are copied in</span>
<a name="ln-332"></a>    <span class="c">!                            bunch%part array</span>
<a name="ln-333"></a>    <span class="n">nb_loc</span> <span class="o">=</span> <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-334"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-335"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-336"></a>    <span class="n">ipp</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-337"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-338"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-339"></a>    <span class="c">!=========================</span>
<a name="ln-340"></a>    <span class="c">! Here 2D MPI decomp. allowed</span>
<a name="ln-341"></a>    <span class="c">!===================================</span>
<a name="ln-342"></a>    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-343"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-344"></a>     <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-345"></a>     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-346"></a>      <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">i1</span>
<a name="ln-347"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-348"></a><span class="k">       if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-349"></a><span class="k">        </span><span class="n">ii</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-350"></a>        <span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-351"></a>       <span class="k">end if</span>
<a name="ln-352"></a><span class="k">      end if</span>
<a name="ln-353"></a><span class="k">     end do</span>
<a name="ln-354"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-355"></a>    <span class="k">end do</span>
<a name="ln-356"></a><span class="c">!================== 1:   counts local bunch particles of each bunch</span>
<a name="ln-357"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-358"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-359"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-360"></a>      <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-361"></a>       <span class="n">z1</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-362"></a>       <span class="n">z2</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-363"></a>       <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-364"></a>        <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-365"></a>        <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-366"></a>        <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-367"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-368"></a>         <span class="n">i</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">j</span>
<a name="ln-369"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-370"></a><span class="k">          if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">&gt;</span><span class="n">z1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">z2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-371"></a><span class="k">           if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-372"></a><span class="k">            </span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-373"></a>           <span class="k">end if</span>
<a name="ln-374"></a><span class="k">          end if</span>
<a name="ln-375"></a><span class="k">         end if</span>
<a name="ln-376"></a><span class="k">        end do</span>
<a name="ln-377"></a><span class="k">       end do</span>
<a name="ln-378"></a><span class="k">      end do</span>
<a name="ln-379"></a><span class="k">     end do</span>
<a name="ln-380"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-381"></a>    <span class="k">end do</span>
<a name="ln-382"></a><span class="k">    </span><span class="n">nb_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-383"></a>      <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-384"></a>    <span class="n">nb_min</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_yloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_zloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">npe_xloc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-385"></a>      <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-386"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-387"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_xloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-388"></a>      <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_zloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-389"></a>       <span class="k">do </span><span class="n">ipp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npe_yloc</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-390"></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">ipp</span> <span class="o">+</span> <span class="n">npe_yloc</span><span class="o">*</span><span class="p">(</span><span class="n">ip</span><span class="o">+</span><span class="n">p</span><span class="o">*</span><span class="n">npe_zloc</span><span class="p">)</span>
<a name="ln-391"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ic</span><span class="p">)</span><span class="o">==</span><span class="n">nb_max</span><span class="p">)</span> <span class="n">pe_nbmax</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-392"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">loc_nbpart</span><span class="p">(</span><span class="n">ipp</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ic</span><span class="p">)</span><span class="o">==</span><span class="n">nb_min</span><span class="p">)</span> <span class="n">pe_nbmin</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-393"></a>       <span class="k">end do</span>
<a name="ln-394"></a><span class="k">      end do</span>
<a name="ln-395"></a><span class="k">     end do</span>
<a name="ln-396"></a><span class="k">    end do</span>
<a name="ln-397"></a>    <span class="c">!==================</span>
<a name="ln-398"></a>    <span class="c">! The local MPI task</span>
<a name="ln-399"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-400"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>
<a name="ln-401"></a>    <span class="c">!==================</span>
<a name="ln-402"></a>    <span class="n">npmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-403"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-404"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">npmax</span><span class="p">,</span><span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-405"></a>    <span class="k">end if</span>
<a name="ln-406"></a>    <span class="c">!=================================</span>
<a name="ln-407"></a>    <span class="c">!                            2: selected particle coordinates are copied in</span>
<a name="ln-408"></a>    <span class="c">!                            bunch%part array</span>
<a name="ln-409"></a>    <span class="n">nb_loc</span> <span class="o">=</span> <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-410"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">imodx</span>
<a name="ln-411"></a>    <span class="n">ip</span> <span class="o">=</span> <span class="n">imodz</span>
<a name="ln-412"></a>    <span class="n">z1</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-413"></a>    <span class="n">z2</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">ip</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-414"></a>    <span class="n">ipp</span> <span class="o">=</span> <span class="n">imody</span>
<a name="ln-415"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-416"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">ipp</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-417"></a>    <span class="c">!=========================</span>
<a name="ln-418"></a>    <span class="c">! Here 3D MPI decomp. allowed</span>
<a name="ln-419"></a>    <span class="c">!===================================</span>
<a name="ln-420"></a>    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-421"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-422"></a>     <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-423"></a>     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-424"></a>      <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">i1</span>
<a name="ln-425"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="n">y1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">y2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-426"></a><span class="k">       if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">&gt;</span><span class="n">z1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">z2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-427"></a><span class="k">        if</span> <span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="n">x1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">x2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-428"></a><span class="k">         </span><span class="n">ii</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-429"></a>         <span class="n">bunch</span><span class="p">(</span><span class="n">ic</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfb</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-430"></a>        <span class="k">end if</span>
<a name="ln-431"></a><span class="k">       end if</span>
<a name="ln-432"></a><span class="k">      end if</span>
<a name="ln-433"></a><span class="k">     end do</span>
<a name="ln-434"></a><span class="k">     </span><span class="n">i1</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-435"></a>    <span class="k">end do</span>
<a name="ln-436"></a><span class="k">   end select</span>
<a name="ln-437"></a>   <span class="c">!=================================</span>
<a name="ln-438"></a>  <span class="k">end subroutine</span>
<a name="ln-439"></a>  <span class="c">!========================</span>
<a name="ln-440"></a>  <span class="k">subroutine </span><span class="n">beam_model_pot</span><span class="p">(</span><span class="n">poten</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">b_am</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-441"></a>    <span class="n">k2</span><span class="p">)</span>
<a name="ln-442"></a>
<a name="ln-443"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">poten</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-444"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">b_am</span>
<a name="ln-445"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span>
<a name="ln-446"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-447"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">r2</span><span class="p">,</span> <span class="n">brad2</span><span class="p">,</span> <span class="n">sx2_inv</span><span class="p">,</span> <span class="n">fact</span><span class="p">,</span> <span class="n">r2max</span><span class="p">,</span> <span class="n">pot0</span>
<a name="ln-448"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zz</span>
<a name="ln-449"></a>   <span class="c">!-----------------------</span>
<a name="ln-450"></a>   <span class="n">brad2</span> <span class="o">=</span> <span class="n">sy</span><span class="o">*</span><span class="n">sy</span> <span class="o">+</span> <span class="n">sz</span><span class="o">*</span><span class="n">sz</span>
<a name="ln-451"></a>   <span class="n">r2max</span> <span class="o">=</span> <span class="n">ymax</span><span class="o">*</span><span class="n">ymax</span> <span class="o">+</span> <span class="n">zmax</span><span class="o">*</span><span class="n">zmax</span>
<a name="ln-452"></a>   <span class="n">pot0</span> <span class="o">=</span> <span class="nb">log</span><span class="p">(</span><span class="n">r2max</span><span class="o">/</span><span class="n">brad2</span><span class="p">)</span>
<a name="ln-453"></a>   <span class="n">sx2_inv</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">sx</span><span class="o">*</span><span class="n">sx</span><span class="p">)</span>
<a name="ln-454"></a>   <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span>
<a name="ln-455"></a>    <span class="n">kk</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-456"></a>    <span class="n">zz</span> <span class="o">=</span> <span class="n">loc_zg</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imodz</span><span class="p">)</span>
<a name="ln-457"></a>    <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span>
<a name="ln-458"></a>     <span class="n">jj</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-459"></a>     <span class="n">yy</span> <span class="o">=</span> <span class="n">loc_yg</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imody</span><span class="p">)</span>
<a name="ln-460"></a>     <span class="n">r2</span> <span class="o">=</span> <span class="n">zz</span><span class="o">*</span><span class="n">zz</span> <span class="o">+</span> <span class="n">yy</span><span class="o">*</span><span class="n">yy</span>
<a name="ln-461"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">r2</span><span class="o">&gt;</span><span class="n">brad2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-462"></a><span class="k">      </span><span class="n">fact</span> <span class="o">=</span> <span class="nb">log</span><span class="p">(</span><span class="n">r2</span><span class="o">/</span><span class="n">brad2</span><span class="p">)</span> <span class="o">-</span> <span class="n">pot0</span>
<a name="ln-463"></a>     <span class="k">else</span>
<a name="ln-464"></a><span class="k">      </span><span class="n">fact</span> <span class="o">=</span> <span class="p">(</span><span class="n">r2</span><span class="o">/</span><span class="n">brad2</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span> <span class="o">-</span> <span class="n">pot0</span>
<a name="ln-465"></a>     <span class="k">end if</span>
<a name="ln-466"></a><span class="k">     do </span><span class="n">i</span> <span class="o">=</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span>
<a name="ln-467"></a>      <span class="n">xx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span><span class="o">-</span><span class="n">xc_bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-468"></a>      <span class="n">poten</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">brad2</span><span class="o">*</span><span class="n">b_am</span><span class="o">*</span><span class="n">fact</span><span class="o">*</span><span class="nb">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xx</span><span class="o">*</span><span class="n">xx</span><span class="o">*</span><span class="n">sx2_inv</span><span class="p">)</span>
<a name="ln-469"></a>     <span class="k">end do</span>
<a name="ln-470"></a><span class="k">    end do</span>
<a name="ln-471"></a><span class="k">   end do</span>
<a name="ln-472"></a><span class="k">  end subroutine</span>
<a name="ln-473"></a>  <span class="c">!=========================</span>
<a name="ln-474"></a>  <span class="k">subroutine </span><span class="n">beam_inject</span>
<a name="ln-475"></a>
<a name="ln-476"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">id_ch</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span>
<a name="ln-477"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nps_loc</span><span class="p">(</span><span class="n">nsb</span><span class="p">),</span><span class="n">nb_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">i1</span>
<a name="ln-478"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span>
<a name="ln-479"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">n</span><span class="p">,</span> <span class="n">n1_alc</span><span class="p">,</span> <span class="n">n2_alc</span><span class="p">,</span> <span class="n">n3_alc</span>
<a name="ln-480"></a>   <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gam2</span>
<a name="ln-481"></a>
<a name="ln-482"></a>   <span class="n">gam2</span> <span class="o">=</span> <span class="n">gam0</span><span class="o">*</span><span class="n">gam0</span>
<a name="ln-483"></a>   <span class="n">id_ch</span> <span class="o">=</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-484"></a>   <span class="c">!=======================</span>
<a name="ln-485"></a>   <span class="n">n1_alc</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-486"></a>   <span class="n">n2_alc</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-487"></a>   <span class="n">n3_alc</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">ebf</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-488"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">ebf_bunch</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-489"></a><span class="k">    allocate</span> <span class="p">(</span><span class="n">ebf_bunch</span><span class="p">(</span><span class="n">n1_alc</span><span class="p">,</span><span class="n">n2_alc</span><span class="p">,</span><span class="n">n3_alc</span><span class="p">,</span><span class="n">nbfield</span><span class="p">))</span>
<a name="ln-490"></a>    <span class="n">ebf_bunch</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-491"></a>   <span class="k">end if</span>
<a name="ln-492"></a>   <span class="c">!=============================</span>
<a name="ln-493"></a>   <span class="c">! The fields of a moving e-bunch in vacuum</span>
<a name="ln-494"></a>   <span class="c">! E_x=-(DPhi/Dx)/gamma^2  , E_y=-DPhi/Dy   E_z=-DPhi/Dz</span>
<a name="ln-495"></a>   <span class="c">! Poisson eq.  D_xE_x+D_yE_y+D_zE_z=omp^2\rho (x-V_b*t_0,y,z)</span>
<a name="ln-496"></a>   <span class="c">! B_x=0   B_y=-V_b*E_z    B_z= V_b*E_y</span>
<a name="ln-497"></a>   <span class="c">!=========================================</span>
<a name="ln-498"></a>   <span class="k">call </span><span class="n">init_random_seed</span><span class="p">(</span><span class="n">mype</span><span class="p">)</span>
<a name="ln-499"></a>   <span class="k">call </span><span class="n">beam_data</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span>
<a name="ln-500"></a>   <span class="c">! Generates phase space coordinates for bparticles on ebfb(np_tot,7)</span>
<a name="ln-501"></a>   <span class="c">! bpart() provisional storage in common to all MPI tasks</span>
<a name="ln-502"></a>   <span class="c">!=======================</span>
<a name="ln-503"></a>   <span class="k">call </span><span class="n">mpi_beam_distribute</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span> <span class="c">!local bpart data are stored in bunch(1)%part struct for each MPI task</span>
<a name="ln-504"></a>
<a name="ln-505"></a>   <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-506"></a>   <span class="n">nb</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>                     <span class="c">!the total bunch particle number</span>
<a name="ln-507"></a>                                              <span class="c">!on each mpi_task</span>
<a name="ln-508"></a><span class="c">!=====================================</span>
<a name="ln-509"></a>   <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-510"></a><span class="k">    </span><span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-511"></a>    <span class="k">if</span><span class="p">(</span><span class="n">nb</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-512"></a><span class="k">     do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-513"></a>      <span class="n">ebfp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span> <span class="o">=</span> <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span>
<a name="ln-514"></a>     <span class="k">end do</span>
<a name="ln-515"></a><span class="k">     deallocate</span> <span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">)</span>
<a name="ln-516"></a>     <span class="k">allocate</span> <span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">np</span><span class="o">+</span><span class="n">nb</span><span class="p">,</span><span class="n">id_ch</span><span class="p">))</span>
<a name="ln-517"></a>     <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-518"></a>      <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebfp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span>
<a name="ln-519"></a>     <span class="k">end do</span>
<a name="ln-520"></a><span class="k">     deallocate</span> <span class="p">(</span><span class="n">ebfp</span><span class="p">)</span>
<a name="ln-521"></a>     <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb</span>
<a name="ln-522"></a>      <span class="n">i1</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="n">np</span>
<a name="ln-523"></a>      <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span> <span class="o">=</span> <span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span>
<a name="ln-524"></a>     <span class="k">end do</span>
<a name="ln-525"></a><span class="k">     allocate</span> <span class="p">(</span><span class="n">ebfp</span><span class="p">(</span><span class="n">np</span><span class="o">+</span><span class="n">nb</span><span class="p">,</span><span class="n">id_ch</span><span class="p">))</span>
<a name="ln-526"></a>     <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span><span class="n">imodz</span><span class="p">,</span><span class="n">imodx</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span><span class="n">imodz</span><span class="p">,</span><span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">nb</span>
<a name="ln-527"></a>    <span class="n">endif</span>
<a name="ln-528"></a>   <span class="k">else</span>
<a name="ln-529"></a><span class="k">    </span><span class="n">nb_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nb</span>
<a name="ln-530"></a>    <span class="k">call </span><span class="n">p_alloc</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lpf_ord</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mem_psize</span><span class="p">)</span>
<a name="ln-531"></a>    <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb</span>
<a name="ln-532"></a>     <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span> <span class="o">=</span> <span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">id_ch</span><span class="p">)</span>
<a name="ln-533"></a>    <span class="k">end do</span>
<a name="ln-534"></a><span class="k">    </span><span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span><span class="n">imodz</span><span class="p">,</span><span class="n">imodx</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nb_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-535"></a>   <span class="k">end if</span>
<a name="ln-536"></a>   <span class="c">! Solves for beam potential UNIFORM GRIDS NEEDED</span>
<a name="ln-537"></a>   <span class="c">!==================================================</span>
<a name="ln-538"></a>   <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-539"></a>   <span class="n">ft_mod</span> <span class="o">=</span> <span class="mi">2</span> <span class="c">!A sine transform along each coordinate</span>
<a name="ln-540"></a>   <span class="n">ft_sym</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-541"></a>   <span class="k">if</span><span class="p">(</span><span class="n">stretch</span><span class="p">)</span><span class="k">then</span>
<a name="ln-542"></a><span class="k">    if</span><span class="p">(</span><span class="n">ndim</span> <span class="o">&gt;</span><span class="mi">2</span> <span class="p">)</span><span class="k">then</span>
<a name="ln-543"></a><span class="k">     allocate</span><span class="p">(</span><span class="n">pot</span><span class="p">(</span><span class="n">n1ft</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">n2ft_loc</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">n3ft_loc</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-544"></a>    <span class="k">else</span>
<a name="ln-545"></a><span class="k">     allocate</span><span class="p">(</span><span class="n">pot</span><span class="p">(</span><span class="n">n1ft</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">n2ft_loc</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">n3ft_loc</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-546"></a>    <span class="n">endif</span>
<a name="ln-547"></a>    <span class="n">pot</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-548"></a>    <span class="k">call </span><span class="n">mpi_beam_ftgrid_distribute</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span> <span class="c">!local bpart data are stored in bunch(1)%part in ftgrid</span>
<a name="ln-549"></a>    <span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">)</span>
<a name="ln-550"></a>    <span class="n">nb</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nps_loc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsb</span><span class="p">))</span>                     <span class="c">!the total bunch particle number</span>
<a name="ln-551"></a>    <span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">ebfb</span><span class="p">))</span><span class="k">deallocate</span><span class="p">(</span><span class="n">ebfb</span><span class="p">)</span>
<a name="ln-552"></a>    <span class="k">allocate</span><span class="p">(</span><span class="n">ebfb</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span><span class="n">nd2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-553"></a>    <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-554"></a>     <span class="n">np</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-555"></a>     <span class="k">call </span><span class="n">set_charge_on_ftgrid</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">pot</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-556"></a>    <span class="k">end do</span>
<a name="ln-557"></a><span class="k">    if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">call </span><span class="n">fill_ftcurr_yzbdsdata</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-558"></a>    <span class="c">!============================</span>
<a name="ln-559"></a>    <span class="c">!In pot(1) beam density</span>
<a name="ln-560"></a>    <span class="c">!=====================================================</span>
<a name="ln-561"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">imody</span><span class="p">)%</span><span class="n">p_ind</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-562"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">loc_yftgrid</span><span class="p">(</span><span class="n">imody</span><span class="p">)%</span><span class="n">p_ind</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-563"></a>    <span class="n">z1</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">imodz</span><span class="p">)%</span><span class="n">p_ind</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-564"></a>    <span class="n">z2</span> <span class="o">=</span> <span class="n">loc_zftgrid</span><span class="p">(</span><span class="n">imodz</span><span class="p">)%</span><span class="n">p_ind</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-565"></a>    <span class="c">!============ ft uniform grid</span>
<a name="ln-566"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">call </span><span class="n">fft_2d_psolv</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">ompe</span><span class="p">,</span> <span class="n">n1ft</span><span class="p">,</span> <span class="n">n1ft_loc</span><span class="p">,</span> <span class="n">n2ft</span><span class="p">,</span> <span class="n">n2ft_loc</span><span class="p">,</span> <span class="n">n3ft</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-567"></a>     <span class="n">n3ft_loc</span><span class="p">,</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-568"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">call </span><span class="n">fft_3d_psolv</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span><span class="n">gam2</span><span class="p">,</span> <span class="n">ompe</span><span class="p">,</span> <span class="n">n1ft</span><span class="p">,</span> <span class="n">n1ft_loc</span><span class="p">,</span> <span class="n">n2ft</span><span class="p">,</span> <span class="n">n2ft_loc</span><span class="p">,</span> <span class="n">n3ft</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-569"></a>     <span class="n">n3ft_loc</span><span class="p">,</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-570"></a>    <span class="c">!Solves Laplacian[poten]=ompe*rho in Fourier space using sin() transform</span>
<a name="ln-571"></a>    <span class="c">!Exit beam potential in jc(1) </span>
<a name="ln-572"></a>    <span class="c">!uniform to stretched grid interpolation inside</span>
<a name="ln-573"></a>    <span class="c">!======================================</span>
<a name="ln-574"></a>   <span class="k">else</span>
<a name="ln-575"></a><span class="k">    do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-576"></a>     <span class="n">np</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-577"></a>     <span class="k">call </span><span class="n">set_grid_charge</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ebfp</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-578"></a>    <span class="k">end do</span>
<a name="ln-579"></a><span class="k">    if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">call </span><span class="n">fill_curr_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-580"></a>    <span class="c">!============================</span>
<a name="ln-581"></a>    <span class="c">!In jc(1) beam density</span>
<a name="ln-582"></a>    <span class="c">!=====================================================</span>
<a name="ln-583"></a>    <span class="n">y1</span> <span class="o">=</span> <span class="n">jy1</span>
<a name="ln-584"></a>    <span class="n">y2</span> <span class="o">=</span> <span class="n">jy2</span>
<a name="ln-585"></a>    <span class="n">z1</span> <span class="o">=</span> <span class="n">kz1</span>
<a name="ln-586"></a>    <span class="n">z2</span> <span class="o">=</span> <span class="n">kz2</span>
<a name="ln-587"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">call </span><span class="n">fft_2d_psolv</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">ompe</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">nx_loc</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">ny_loc</span><span class="p">,</span> <span class="n">nz</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-588"></a>     <span class="n">nz_loc</span><span class="p">,</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-589"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">call </span><span class="n">fft_3d_psolv</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">gam2</span><span class="p">,</span> <span class="n">ompe</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">nx_loc</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">ny_loc</span><span class="p">,</span> <span class="n">nz</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-590"></a>     <span class="n">nz_loc</span><span class="p">,</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-591"></a>    <span class="c">!Solves Laplacian[poten]=ompe*rho in Fourier space using sin() transform</span>
<a name="ln-592"></a>    <span class="c">!Exit beam potential in jc(1) </span>
<a name="ln-593"></a>   <span class="n">endif</span>
<a name="ln-594"></a>   <span class="n">jc</span><span class="p">(:,:,:,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">bet0</span><span class="o">*</span><span class="n">jc</span><span class="p">(:,:,:,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-595"></a>   <span class="c">!==========================</span>
<a name="ln-596"></a>   <span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">ebfb</span><span class="p">))</span><span class="k">deallocate</span><span class="p">(</span><span class="n">ebfb</span><span class="p">)</span>
<a name="ln-597"></a>   <span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span><span class="k">deallocate</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">)</span>
<a name="ln-598"></a>   <span class="c">!===========================</span>
<a name="ln-599"></a>   <span class="k">call </span><span class="n">fill_ebfield_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-600"></a>   <span class="k">call </span><span class="n">initial_beam_fields</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">ebf_bunch</span><span class="p">,</span> <span class="n">gam2</span><span class="p">,</span> <span class="n">bet0</span><span class="p">)</span>
<a name="ln-601"></a>   <span class="c">! generates (Ex,Ey,Ez,By,Bz) bunch fields  Bx=ebf_bunc(4)=0</span>
<a name="ln-602"></a>   <span class="n">ebf_bunch</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-603"></a>   <span class="c">!========================================= Collect data</span>
<a name="ln-604"></a>   <span class="n">ebf</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nfield</span><span class="p">)</span> <span class="o">=</span> <span class="n">ebf</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nfield</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-605"></a>    <span class="n">ebf_bunch</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="n">nfield</span><span class="p">)</span>
<a name="ln-606"></a>   <span class="c">!========================================</span>
<a name="ln-607"></a>   <span class="n">lp_end</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">xc_bunch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">sxb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-608"></a>   <span class="c">!=====================================</span>
<a name="ln-609"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-610"></a>    <span class="c">!==================</span>
<a name="ln-611"></a>    <span class="k">open</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;Initial_bunch_info.dat&#39;</span><span class="p">)</span>
<a name="ln-612"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a27,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Initial target x-position =&#39;</span><span class="p">,</span> <span class="n">targ_in</span>
<a name="ln-613"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a20,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Plasma wave-length =&#39;</span><span class="p">,</span> <span class="n">lambda_p</span>
<a name="ln-614"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;-------------------------------------&#39;</span>
<a name="ln-615"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a17,i4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Number of bunches&#39;</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-616"></a>    <span class="k">do </span><span class="n">i1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-617"></a>    <span class="k">write</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;bunch number =&#39;</span><span class="p">,</span><span class="n">i1</span>
<a name="ln-618"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a25,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Bunch particles per cell &#39;</span><span class="p">,</span> <span class="n">nb_per_cell</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-619"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a23,i8)&#39;</span><span class="p">)</span> <span class="s1">&#39;Bunch particle number  &#39;</span><span class="p">,</span> <span class="n">nb_tot</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-620"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a15,2e14.6)&#39;</span><span class="p">)</span> <span class="s1">&#39;gamma and beta &#39;</span><span class="p">,</span> <span class="n">gam</span><span class="p">(</span><span class="n">i1</span><span class="p">),</span><span class="n">bet0</span>
<a name="ln-621"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a15,2e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Bunch  sizes   &#39;</span><span class="p">,</span> <span class="n">sxb</span><span class="p">(</span><span class="n">i1</span><span class="p">),</span> <span class="n">syb</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-622"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a23,2e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Transverse emittances= &#39;</span><span class="p">,</span> <span class="n">epsy</span><span class="p">(</span><span class="n">i1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-623"></a>      <span class="n">epsz</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-624"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a21,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;Initial xc-position= &#39;</span><span class="p">,</span> <span class="n">xc_bunch</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-625"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a20,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;B charge    [pC] =  &#39;</span><span class="p">,</span> <span class="n">bunch_charge</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-626"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;(a21,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;B_density/P_density  &#39;</span><span class="p">,</span> <span class="n">rhob</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-627"></a>    <span class="k">end do</span>
<a name="ln-628"></a><span class="k">    close</span> <span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<a name="ln-629"></a>   <span class="k">end if</span>
<a name="ln-630"></a><span class="k">  end subroutine</span>
<a name="ln-631"></a>  <span class="c">!========================</span>
<a name="ln-632"></a> <span class="k">end module</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-01-29 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ALaDyn was developed by The ALaDyn Collaboration</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>