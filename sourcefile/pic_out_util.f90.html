<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A High-Accuracy PIC Code for the Maxwell-Vlasov Equations">
    
    <meta name="author" content="The ALaDyn Collaboration" >
    <link rel="icon" href="../favicon.png">

    <title>pic_out_util.f90 &ndash; ALaDyn</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">ALaDyn <small>3.0.1</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Guide</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/aladyn.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/aladyn.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>pic_out_util.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 1.4% of total for source files.">357 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/pic_out_util.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">pic_out_util.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/pic_out_util.html">pic_out_util</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/pic_out_util.f90.html#src">pic_out_util.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~pic_out_util.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilepic_out_utilf90EfferentGraph" width="641pt" height="263pt"
 viewBox="0.00 0.00 641.00 263.46" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph" class="graph" transform="scale(.6303 .6303) rotate(0) translate(4 414)">
<title>sourcefile~~pic_out_util.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-414 1013,-414 1013,4 -4,4"/>
<!-- sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~pic_out_util.f90</title>
<polygon fill="none" stroke="#000000" points="1009,-326 916,-326 916,-302 1009,-302 1009,-326"/>
<text text-anchor="middle" x="962.5" y="-311.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">pic_out_util.f90</text>
</g>
<!-- sourcefile~grid_part_util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~grid_part_util.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/grid_part_util.f90.html" xlink:title="grid_part_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="880,-346 777,-346 777,-322 880,-322 880,-346"/>
<text text-anchor="middle" x="828.5" y="-331.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_part_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~grid_part_util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~grid_part_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M915.6333,-320.995C907.388,-322.2257 898.6942,-323.5233 890.1187,-324.8032"/>
<polygon fill="#ff0000" stroke="#ff0000" points="889.5139,-321.3546 880.1402,-326.2925 890.5473,-328.2779 889.5139,-321.3546"/>
</g>
<!-- sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~mpi_field_interface.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/mpi_field_interface.f90.html" xlink:title="mpi_field_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="741,-226 606,-226 606,-202 741,-202 741,-226"/>
<text text-anchor="middle" x="673.5" y="-211.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_field_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_field_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M915.7802,-308.2453C889.9372,-304.7571 857.3138,-299.8516 828.5,-294"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M828.5,-294C778.4761,-283.841 727.1277,-252.3761 697.887,-232.0674"/>
<polygon fill="#ff0000" stroke="#ff0000" points="699.731,-229.0844 689.5481,-226.1588 695.684,-234.796 699.731,-229.0844"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~mpi_curr_interface.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/mpi_curr_interface.f90.html" xlink:title="mpi_curr_interface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="740,-306 607,-306 607,-282 740,-282 740,-306"/>
<text text-anchor="middle" x="673.5" y="-291.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_curr_interface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~mpi_curr_interface.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M828.5,-294C803.3519,-288.8929 775.4315,-287.5906 750.2939,-287.9672"/>
<polygon fill="#ff0000" stroke="#ff0000" points="749.9896,-284.4734 740.0767,-288.2129 750.1579,-291.4714 749.9896,-284.4734"/>
</g>
<!-- sourcefile~psolve.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~psolve.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/psolve.f90.html" xlink:title="psolve.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="862,-186 795,-186 795,-162 862,-162 862,-186"/>
<text text-anchor="middle" x="828.5" y="-171.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">psolve.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~psolve.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~psolve.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M950.6084,-301.5759C927.3063,-277.2305 875.4698,-223.0729 847.413,-193.7599"/>
<polygon fill="#ff0000" stroke="#ff0000" points="849.6167,-191.0004 840.1736,-186.1963 844.5598,-195.8406 849.6167,-191.0004"/>
</g>
<!-- sourcefile~phys_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~phys_param.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/phys_param.f90.html" xlink:title="phys_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="247,-376 149,-376 149,-352 247,-352 247,-376"/>
<text text-anchor="middle" x="198" y="-361.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">phys_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pic_out_util.f90&#45;&gt;sourcefile~phys_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~pic_out_util.f90&#45;&gt;sourcefile~phys_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M941.5456,-326.1585C894.9834,-351.9907 778.71,-410 673.5,-410 673.5,-410 673.5,-410 508.5,-410 420.2283,-410 319.3501,-391.5832 257.1596,-378.0559"/>
<polygon fill="#ff0000" stroke="#ff0000" points="257.6609,-374.5824 247.1417,-375.8461 256.1531,-381.4181 257.6609,-374.5824"/>
</g>
<!-- sourcefile~grid_part_lib.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~grid_part_lib.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/grid_part_lib.f90.html" xlink:title="grid_part_lib.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="723,-146 624,-146 624,-122 723,-122 723,-146"/>
<text text-anchor="middle" x="673.5" y="-131.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_part_lib.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_util.f90&#45;&gt;sourcefile~grid_part_lib.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~grid_part_util.f90&#45;&gt;sourcefile~grid_part_lib.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M794.9568,-321.9793C788.2903,-318.3331 781.8583,-313.7292 777,-308 742.3616,-267.1524 770.2579,-237.8589 741,-193 730.5084,-176.9141 714.4491,-162.628 700.6266,-152.1438"/>
<polygon fill="#ff0000" stroke="#ff0000" points="702.5201,-149.1927 692.3791,-146.1251 698.3937,-154.8472 702.5201,-149.1927"/>
</g>
<!-- sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~pstruct_data.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/pstruct_data.f90.html" xlink:title="pstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="558,-277 459,-277 459,-253 558,-253 558,-277"/>
<text text-anchor="middle" x="508.5" y="-262.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_util.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~grid_part_util.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M802.8195,-346.0663C772.3748,-359.0148 719.9076,-377.0872 673.5,-372"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M673.5,-372C616.5076,-365.7525 618.976,-324.8079 570,-295 562.1845,-290.2433 553.5053,-285.6335 545.1895,-281.5126"/>
<polygon fill="#ff0000" stroke="#ff0000" points="546.5476,-278.2818 536.0205,-277.0861 543.5043,-284.5856 546.5476,-278.2818"/>
</g>
<!-- sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~fstruct_data.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/fstruct_data.f90.html" xlink:title="fstruct_data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="556.5,-328 460.5,-328 460.5,-304 556.5,-304 556.5,-328"/>
<text text-anchor="middle" x="508.5" y="-313.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fstruct_data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_util.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~grid_part_util.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M673.5,-372C626.355,-366.832 575.0697,-346.9903 542.3979,-332.3864"/>
<polygon fill="#ff0000" stroke="#ff0000" points="543.4318,-329.0111 532.8812,-328.0443 540.5262,-335.3795 543.4318,-329.0111"/>
</g>
<!-- sourcefile~parallel.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~parallel.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/parallel.f90.html" xlink:title="parallel.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="546.5,-104 470.5,-104 470.5,-80 546.5,-80 546.5,-104"/>
<text text-anchor="middle" x="508.5" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">parallel.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M658.4687,-201.9225C644.4134,-190.3868 623.0855,-172.2517 606,-155 588.6998,-137.5315 590.352,-126.7928 570,-113 565.7315,-110.1072 561.0269,-107.578 556.1781,-105.3747"/>
<polygon fill="#cbff00" stroke="#cbff00" points="557.3336,-102.0661 546.7523,-101.5295 554.6895,-108.5475 557.3336,-102.0661"/>
</g>
<!-- sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~grid_param.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/grid_param.f90.html" xlink:title="grid_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="397.5,-214 303.5,-214 303.5,-190 397.5,-190 397.5,-214"/>
<text text-anchor="middle" x="350.5" y="-199.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M605.6666,-215.4331C575.8596,-215.9051 540.4415,-216.252 508.5,-216"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M634.3973,-226.0863C611.3638,-233.2057 582.021,-242.2753 557.4587,-249.8673"/>
<polygon fill="#cbff00" stroke="#cbff00" points="556.128,-246.6152 547.6076,-252.9122 558.1952,-253.303 556.128,-246.6152"/>
</g>
<!-- sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~mpi_field_interface.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M657.8697,-226.0124C638.0288,-240.9902 602.4681,-266.9405 570,-286 562.0354,-290.6754 553.2365,-295.2778 544.8446,-299.4204"/>
<polygon fill="#cbff00" stroke="#cbff00" points="543.0912,-296.3804 535.6089,-303.8815 546.1358,-302.6836 543.0912,-296.3804"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M654.537,-281.9291C639.3231,-271.3111 618.509,-254.528 606,-235 575.5062,-187.3956 609.1248,-153.8081 570,-113 566.0471,-108.8771 561.2526,-105.5636 556.1039,-102.9006"/>
<polygon fill="#00ff66" stroke="#00ff66" points="557.1269,-99.5298 546.5589,-98.7754 554.3498,-105.9554 557.1269,-99.5298"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M659.1251,-281.9025C631.7295,-260.115 569.334,-216.4799 508.5,-216"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M606.8638,-282.2882C594.0193,-280.0307 580.6416,-277.6794 568.0404,-275.4647"/>
<polygon fill="#00ff66" stroke="#00ff66" points="568.581,-272.0061 558.126,-273.7222 567.3692,-278.9004 568.581,-272.0061"/>
</g>
<!-- sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~mpi_curr_interface.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M606.8638,-302.8848C593.5958,-304.6539 579.759,-306.4988 566.7968,-308.2271"/>
<polygon fill="#00ff66" stroke="#00ff66" points="566.066,-304.7935 556.6164,-309.5845 566.9912,-311.7321 566.066,-304.7935"/>
</g>
<!-- sourcefile~prl_fft.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~prl_fft.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/prl_fft.f90.html" xlink:title="prl_fft.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="705.5,-24 641.5,-24 641.5,0 705.5,0 705.5,-24"/>
<text text-anchor="middle" x="673.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">prl_fft.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~prl_fft.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M823.699,-161.6256C812.8758,-135.2609 784.107,-73.1005 741,-38 733.4112,-31.8207 724.1876,-26.9941 715.0277,-23.2694"/>
<polygon fill="#0066ff" stroke="#0066ff" points="716.1698,-19.9601 705.5765,-19.7761 713.7429,-26.526 716.1698,-19.9601"/>
</g>
<!-- sourcefile~grid_fields.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~grid_fields.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/grid_fields.f90.html" xlink:title="grid_fields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="717.5,-104 629.5,-104 629.5,-80 717.5,-80 717.5,-104"/>
<text text-anchor="middle" x="673.5" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_fields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_fields.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M814.1978,-161.9381C797.5488,-148.4124 768.776,-126.5964 741,-113 736.6804,-110.8855 732.1015,-108.9263 727.444,-107.1244"/>
<polygon fill="#0066ff" stroke="#0066ff" points="728.4256,-103.7576 717.8313,-103.6473 726.0444,-110.3402 728.4256,-103.7576"/>
</g>
<!-- sourcefile~common_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~common_param.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/common_param.f90.html" xlink:title="common_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="411,-88 290,-88 290,-64 411,-64 411,-88"/>
<text text-anchor="middle" x="350.5" y="-73.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">common_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M822.3434,-161.7623C810.2596,-139.2202 781.0817,-91.5653 741,-71 648.7556,-23.6707 612.0662,-56.8092 508.5,-52"/>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M508.5,-52C474.2766,-50.1183 436.2904,-55.6414 406.1424,-61.8609"/>
<polygon fill="#0066ff" stroke="#0066ff" points="405.2784,-58.4666 396.2355,-63.9872 406.7473,-65.3107 405.2784,-58.4666"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M794.7652,-175.3417C751.0106,-177.4332 672.422,-182.3882 606,-193 562.0348,-200.024 553.0213,-216.3512 508.5,-216"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~pstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~pstruct_data.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M815.4528,-186.1871C799.3164,-200.48 770.3667,-223.6582 741,-235 685.1142,-256.5838 616.6273,-263.265 568.5074,-265.0454"/>
<polygon fill="#0066ff" stroke="#0066ff" points="568.1441,-261.5549 558.257,-265.3622 568.3604,-268.5516 568.1441,-261.5549"/>
</g>
<!-- sourcefile~psolve.f90&#45;&gt;sourcefile~fstruct_data.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~psolve.f90&#45;&gt;sourcefile~fstruct_data.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M822.7543,-186.3778C807.7754,-218.0423 766.9,-300.5179 741,-315 686.6151,-345.4097 613.2811,-339.5095 563.6244,-330.0316"/>
<polygon fill="#0066ff" stroke="#0066ff" points="564.207,-326.5787 553.7124,-328.0325 562.823,-333.4405 564.207,-326.5787"/>
</g>
<!-- sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~precision_def.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/precision_def.f90.html" xlink:title="precision_def.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="106,-210 0,-210 0,-186 106,-186 106,-210"/>
<text text-anchor="middle" x="53" y="-195.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">precision_def.F90</text>
</a>
</g>
</g>
<!-- sourcefile~phys_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~phys_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M187.3378,-351.7936C162.513,-323.3736 100.6642,-252.5673 70.3303,-217.8403"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="72.8925,-215.4531 63.6778,-210.2243 67.6205,-220.0582 72.8925,-215.4531"/>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M470.2526,-88.1268C455.58,-86.641 438.3247,-84.8936 421.5521,-83.1951"/>
<polygon fill="#ff0000" stroke="#ff0000" points="421.5003,-79.6721 411.1986,-82.1467 420.795,-86.6365 421.5003,-79.6721"/>
</g>
<!-- sourcefile~mpi_var.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node18" class="node">
<title>sourcefile~mpi_var.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node18"><a xlink:href=".././sourcefile/mpi_var.f90.html" xlink:title="mpi_var.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="388,-172 313,-172 313,-148 388,-148 388,-172"/>
<text text-anchor="middle" x="350.5" y="-157.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_var.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M470.3655,-103.0513C462.4601,-105.8835 454.3158,-109.2167 447,-113 429.469,-122.066 428.5081,-129.8897 411,-139 406.7251,-141.2244 402.1634,-143.2976 397.5346,-145.207"/>
<polygon fill="#ff0000" stroke="#ff0000" points="396.073,-142.0196 388.0097,-148.8922 398.5989,-148.548 396.073,-142.0196"/>
</g>
<!-- sourcefile~util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node20" class="node">
<title>sourcefile~util.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node20"><a xlink:href=".././sourcefile/util.f90.html" xlink:title="util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="377.5,-130 323.5,-130 323.5,-106 377.5,-106 377.5,-130"/>
<text text-anchor="middle" x="350.5" y="-115.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~parallel.f90&#45;&gt;sourcefile~util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M470.2526,-98.2939C445.1599,-102.4231 412.5135,-107.7952 387.6461,-111.8873"/>
<polygon fill="#ff0000" stroke="#ff0000" points="386.8086,-108.478 377.5097,-113.5554 387.9453,-115.3851 386.8086,-108.478"/>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M651.5516,-24.1116C630.7771,-35.417 598.5998,-52.5207 570,-66 562.8484,-69.3706 555.1422,-72.7907 547.6846,-75.9946"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="546.2723,-72.7918 538.4316,-79.9174 549.0046,-79.2365 546.2723,-72.7918"/>
</g>
<!-- sourcefile~modern_fft_lib.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node16" class="node">
<title>sourcefile~modern_fft_lib.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node16"><a xlink:href=".././sourcefile/modern_fft_lib.f90.html" xlink:title="modern_fft_lib.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="254,-64 142,-64 142,-40 254,-40 254,-64"/>
<text text-anchor="middle" x="198" y="-49.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modern_fft_lib.F90</text>
</a>
</g>
</g>
<!-- sourcefile~prl_fft.f90&#45;&gt;sourcefile~modern_fft_lib.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~prl_fft.f90&#45;&gt;sourcefile~modern_fft_lib.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M641.1908,-14.7179C564.0165,-21.21 367.6881,-37.7255 264.1807,-46.4327"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="263.8284,-42.9499 254.157,-47.276 264.4152,-49.9253 263.8284,-42.9499"/>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~parallel.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M629.283,-92C606.9322,-92 579.7645,-92 556.8597,-92"/>
<polygon fill="#aaff00" stroke="#aaff00" points="556.6685,-88.5001 546.6685,-92 556.6684,-95.5001 556.6685,-88.5001"/>
</g>
<!-- sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node19" class="node">
<title>sourcefile~grid_field_param.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node19"><a xlink:href=".././sourcefile/grid_field_param.f90.html" xlink:title="grid_field_param.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="570,-146 447,-146 447,-122 570,-122 570,-146"/>
<text text-anchor="middle" x="508.5" y="-131.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid_field_param.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge30" class="edge">
<title>sourcefile~grid_fields.f90&#45;&gt;sourcefile~grid_field_param.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M629.283,-103.2552C609.6699,-108.2477 586.3477,-114.1842 565.4517,-119.5032"/>
<polygon fill="#aaff00" stroke="#aaff00" points="564.5582,-116.119 555.7306,-121.9777 566.285,-122.9026 564.5582,-116.119"/>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge32" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#00ffa9" stroke-dasharray="5,2" d="M623.7324,-122.0714C617.5113,-119.5698 611.4341,-116.575 606,-113 585.4608,-99.4876 590.5526,-84.492 570,-71 546.0847,-55.3004 537.0772,-53.327 508.5,-52"/>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge33" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#00ffa9" stroke-dasharray="5,2" d="M633.5449,-146.1226C624.1209,-149.8516 614.3848,-154.4659 606,-160 586.851,-172.6386 589.5678,-185.0199 570,-197 545.6015,-211.9377 537.1071,-216.2257 508.5,-216"/>
<path fill="none" stroke="#00ffa9" stroke-dasharray="5,2" d="M508.5,-216C475.1225,-215.7367 437.9318,-212.5843 408.0212,-209.3376"/>
<polygon fill="#00ffa9" stroke="#00ffa9" points="408.0905,-205.8236 397.7633,-208.1898 407.3121,-212.7801 408.0905,-205.8236"/>
</g>
<!-- sourcefile~stretched_grid.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node17" class="node">
<title>sourcefile~stretched_grid.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node17"><a xlink:href=".././sourcefile/stretched_grid.f90.html" xlink:title="stretched_grid.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="563,-188 454,-188 454,-164 563,-164 563,-188"/>
<text text-anchor="middle" x="508.5" y="-173.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">stretched_grid.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~stretched_grid.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge31" class="edge">
<title>sourcefile~grid_part_lib.f90&#45;&gt;sourcefile~stretched_grid.f90</title>
<path fill="none" stroke="#00ffa9" stroke-dasharray="5,2" d="M626.2176,-146.0355C607.3177,-150.8464 585.382,-156.43 565.6039,-161.4645"/>
<polygon fill="#00ffa9" stroke="#00ffa9" points="564.6169,-158.104 555.7893,-163.9627 566.3437,-164.8877 564.6169,-158.104"/>
</g>
<!-- sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge34" class="edge">
<title>sourcefile~common_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M301.6948,-88.0665C271.5742,-95.8521 232.2729,-106.6231 198,-118"/>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M198,-118C173.056,-126.2802 165.5038,-125.2384 142,-137 118.3196,-148.85 93.6543,-166.2126 76.3121,-179.3867"/>
<polygon fill="#00a9ff" stroke="#00a9ff" points="73.7288,-176.9595 67.9548,-185.8427 78.0082,-182.4991 73.7288,-176.9595"/>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge35" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M303.4121,-198.7813C273.2576,-197.2105 233.3028,-196.0384 198,-198"/>
</g>
<!-- sourcefile~struct_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node21" class="node">
<title>sourcefile~struct_def.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node21"><a xlink:href=".././sourcefile/struct_def.f90.html" xlink:title="struct_def.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="240.5,-250 155.5,-250 155.5,-226 240.5,-226 240.5,-250"/>
<text text-anchor="middle" x="198" y="-235.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">struct_def.f90</text>
</a>
</g>
</g>
<!-- sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge36" class="edge">
<title>sourcefile~grid_param.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M303.084,-213.1933C286.4194,-217.1272 267.6,-221.5698 250.5392,-225.5973"/>
<polygon fill="#0000ff" stroke="#0000ff" points="249.6553,-222.2097 240.7269,-227.9136 251.2636,-229.0224 249.6553,-222.2097"/>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge37" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M350.5,-265C282.4943,-263.44 263.5274,-296.2584 198,-278"/>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M198,-278C172.682,-270.9455 165.5038,-270.7616 142,-259 118.3196,-247.15 93.6543,-229.7874 76.3121,-216.6133"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="78.0082,-213.5009 67.9548,-210.1573 73.7288,-219.0405 78.0082,-213.5009"/>
</g>
<!-- sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge38" class="edge">
<title>sourcefile~pstruct_data.f90&#45;&gt;sourcefile~struct_def.f90</title>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M458.6807,-265.5845C427.5749,-265.8044 386.6988,-265.8304 350.5,-265"/>
<path fill="none" stroke="#aa00ff" stroke-dasharray="5,2" d="M350.5,-265C316.9568,-264.2306 279.8797,-257.7959 250.6841,-251.4018"/>
<polygon fill="#aa00ff" stroke="#aa00ff" points="251.2296,-247.937 240.7046,-249.1512 249.6896,-254.7655 251.2296,-247.937"/>
</g>
<!-- sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge39" class="edge">
<title>sourcefile~fstruct_data.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M460.2885,-314.5594C398.4866,-311.7064 288.5059,-303.2183 198,-278"/>
</g>
<!-- sourcefile~modern_fft_lib.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge40" class="edge">
<title>sourcefile~modern_fft_lib.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M184.4206,-64.1602C172.936,-74.5504 156.1403,-89.9963 142,-104 116.7103,-129.0455 88.6486,-159.0788 70.9239,-178.3427"/>
<polygon fill="#ff0000" stroke="#ff0000" points="68.1785,-176.158 63.9987,-185.8934 73.3373,-180.8894 68.1785,-176.158"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge41" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M461.6963,-163.914C456.4499,-161.4544 451.4141,-158.5127 447,-155 423.2602,-136.1078 434.6921,-115.952 411,-97 409.2012,-95.5611 407.2972,-94.2175 405.317,-92.9632"/>
<polygon fill="#ffff00" stroke="#ffff00" points="406.6913,-89.7264 396.2351,-88.0178 403.3436,-95.874 406.6913,-89.7264"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge42" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M453.6827,-185.0206C438.8371,-187.4635 422.7306,-190.114 407.7547,-192.5783"/>
<polygon fill="#ffff00" stroke="#ffff00" points="406.8958,-189.1725 397.5968,-194.2499 408.0324,-196.0796 406.8958,-189.1725"/>
</g>
<!-- sourcefile~stretched_grid.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge43" class="edge">
<title>sourcefile~stretched_grid.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M453.6827,-170.4489C435.6521,-168.623 415.7616,-166.6088 398.2956,-164.8401"/>
<polygon fill="#ffff00" stroke="#ffff00" points="398.6263,-161.3557 388.3245,-163.8303 397.921,-168.3201 398.6263,-161.3557"/>
</g>
<!-- sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge44" class="edge">
<title>sourcefile~mpi_var.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M317.4409,-172.0809C286.9219,-182.3046 240.0908,-195.6612 198,-198"/>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M198,-198C171.2697,-199.4853 141.7248,-199.7365 116.3167,-199.5227"/>
<polygon fill="#00ff00" stroke="#00ff00" points="116.1064,-196.0203 106.0684,-199.4099 116.0292,-203.0199 116.1064,-196.0203"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~common_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge45" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~common_param.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M471.5573,-121.9831C463.4185,-119.1699 454.878,-116.0886 447,-113 430.6989,-106.6091 427.2849,-103.432 411,-97 406.2739,-95.1333 401.307,-93.2639 396.3359,-91.4521"/>
<polygon fill="#00ffff" stroke="#00ffff" points="397.428,-88.1256 386.8334,-88.0549 395.0715,-94.7171 397.428,-88.1256"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~grid_param.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge46" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~grid_param.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M467.7593,-146.0004C460.685,-148.6194 453.5141,-151.6313 447,-155 429.469,-164.066 428.5081,-171.8897 411,-181 407.4941,-182.8243 403.7953,-184.5469 400.0248,-186.1608"/>
<polygon fill="#00ffff" stroke="#00ffff" points="398.5563,-182.9786 390.5737,-189.9448 401.1582,-189.4771 398.5563,-182.9786"/>
</g>
<!-- sourcefile~grid_field_param.f90&#45;&gt;sourcefile~mpi_var.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge47" class="edge">
<title>sourcefile~grid_field_param.f90&#45;&gt;sourcefile~mpi_var.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M446.9607,-144.1267C430.9091,-146.7681 413.8452,-149.5761 398.6029,-152.0843"/>
<polygon fill="#00ffff" stroke="#00ffff" points="397.6753,-148.6898 388.3763,-153.7672 398.812,-155.5969 397.6753,-148.6898"/>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge48" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M323.2358,-112.9492C292.074,-108.3146 239.9629,-104.0704 198,-118"/>
</g>
<!-- sourcefile~code_util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_node22" class="node">
<title>sourcefile~code_util.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~EfferentGraph_node22"><a xlink:href=".././sourcefile/code_util.f90.html" xlink:title="code_util.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="238.5,-170 157.5,-170 157.5,-146 238.5,-146 238.5,-170"/>
<text text-anchor="middle" x="198" y="-155.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">code_util.f90</text>
</a>
</g>
</g>
<!-- sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge49" class="edge">
<title>sourcefile~util.f90&#45;&gt;sourcefile~code_util.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M323.2361,-125.1512C302.437,-130.6067 273.205,-138.2741 248.2137,-144.8292"/>
<polygon fill="#0000ff" stroke="#0000ff" points="247.3,-141.4504 238.5152,-147.373 249.0761,-148.2213 247.3,-141.4504"/>
</g>
<!-- sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge50" class="edge">
<title>sourcefile~struct_def.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M155.2795,-226.215C139.9907,-221.9974 122.5635,-217.1899 106.4801,-212.7531"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="107.2414,-209.3325 96.6707,-210.0471 105.3798,-216.0804 107.2414,-209.3325"/>
</g>
<!-- sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90 -->
<g id="sourcefile~~pic_out_util.f90~~EfferentGraph_edge51" class="edge">
<title>sourcefile~code_util.f90&#45;&gt;sourcefile~precision_def.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M157.2235,-169.2487C141.3986,-173.6142 123.0618,-178.6726 106.2215,-183.3182"/>
<polygon fill="#ff0000" stroke="#ff0000" points="105.2185,-179.9641 96.5094,-185.9974 107.0801,-186.712 105.2185,-179.9641"/>
</g>
</g>
</svg>
</div><script>var pansourcefilepic_out_utilf90EfferentGraph = svgPanZoom('#sourcefilepic_out_utilf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~pic_out_util.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilepic_out_utilf90AfferentGraph" width="213pt" height="32pt"
 viewBox="0.00 0.00 213.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~pic_out_util.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>sourcefile~~pic_out_util.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 209,-28 209,4 -4,4"/>
<!-- sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~pic_out_util.f90</title>
<polygon fill="none" stroke="#000000" points="93,-24 0,-24 0,0 93,0 93,-24"/>
<text text-anchor="middle" x="46.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">pic_out_util.f90</text>
</g>
<!-- sourcefile~aladyn.f90 -->
<g id="sourcefile~~pic_out_util.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~aladyn.f90</title>
<g id="a_sourcefile~~pic_out_util.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/aladyn.f90.html" xlink:title="ALaDyn.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="205,-24 129,-24 129,0 205,0 205,-24"/>
<text text-anchor="middle" x="167" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALaDyn.F90</text>
</a>
</g>
</g>
<!-- sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out_util.f90 -->
<g id="sourcefile~~pic_out_util.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~aladyn.f90&#45;&gt;sourcefile~pic_out_util.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M128.873,-12C120.7455,-12 111.9942,-12 103.3372,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="103.261,-8.5001 93.2609,-12 103.2609,-15.5001 103.261,-8.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/pic_out_util.html">pic_out_util</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/pic_out_util.f90.html#src">pic_out_util.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-2"></a><span class="c">!                            Copyright 2008-2020  The ALaDyn Collaboration                            !</span>
<a name="ln-3"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-4"></a>
<a name="ln-5"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-6"></a><span class="c">!  This file is part of ALaDyn.                                                                       !</span>
<a name="ln-7"></a><span class="c">!                                                                                                     !</span>
<a name="ln-8"></a><span class="c">!  ALaDyn is free software: you can redistribute it and/or modify                                     !</span>
<a name="ln-9"></a><span class="c">!  it under the terms of the GNU General Public License as published by                               !</span>
<a name="ln-10"></a><span class="c">!  the Free Software Foundation, either version 3 of the License, or                                  !</span>
<a name="ln-11"></a><span class="c">!  (at your option) any later version.                                                                !</span>
<a name="ln-12"></a><span class="c">!                                                                                                     !</span>
<a name="ln-13"></a><span class="c">!  ALaDyn is distributed in the hope that it will be useful,                                          !</span>
<a name="ln-14"></a><span class="c">!  but WITHOUT ANY WARRANTY; without even the implied warranty of                                     !</span>
<a name="ln-15"></a><span class="c">!  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                      !</span>
<a name="ln-16"></a><span class="c">!  GNU General Public License for more details.                                                       !</span>
<a name="ln-17"></a><span class="c">!                                                                                                     !</span>
<a name="ln-18"></a><span class="c">!  You should have received a copy of the GNU General Public License                                  !</span>
<a name="ln-19"></a><span class="c">!  along with ALaDyn.  If not, see &lt;http://www.gnu.org/licenses/&gt;.                                    !</span>
<a name="ln-20"></a><span class="c">!*****************************************************************************************************!</span>
<a name="ln-21"></a>
<a name="ln-22"></a> <span class="k">module </span><span class="n">pic_out_util</span>
<a name="ln-23"></a>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">grid_part_util</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">mpi_curr_interface</span>
<a name="ln-26"></a>  <span class="k">use </span><span class="n">mpi_field_interface</span>
<a name="ln-27"></a>  <span class="k">use </span><span class="n">psolve</span>
<a name="ln-28"></a>  <span class="k">use </span><span class="n">phys_param</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">electron_mass</span>
<a name="ln-29"></a>
<a name="ln-30"></a>  <span class="k">implicit none</span>
<a name="ln-31"></a>  <span class="c">!=====Contains functions to prepare selected output variables=======</span>
<a name="ln-32"></a> <span class="k">contains</span>
<a name="ln-33"></a>  <span class="c">!=============== Tracking particles============</span>
<a name="ln-34"></a>  <span class="k">subroutine </span><span class="n">initial_tparticles_select</span><span class="p">(</span><span class="n">tx1</span><span class="p">,</span> <span class="n">ty1</span><span class="p">)</span>
<a name="ln-35"></a>
<a name="ln-36"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tx1</span><span class="p">,</span> <span class="n">ty1</span>
<a name="ln-37"></a>
<a name="ln-38"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ik</span><span class="p">,</span> <span class="n">ndv</span><span class="p">,</span> <span class="n">ik_max</span>
<a name="ln-39"></a>   <span class="kt">integer</span> <span class="p">(</span><span class="n">hp_int</span><span class="p">)</span> <span class="kd">::</span> <span class="n">plab</span><span class="p">,</span> <span class="n">last_ind</span>
<a name="ln-40"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">tp_numb</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-41"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">yy</span><span class="p">(</span><span class="n">tp_numb</span><span class="p">),</span> <span class="n">ym</span><span class="p">,</span> <span class="n">ymx</span>
<a name="ln-42"></a>   <span class="c">!========================</span>
<a name="ln-43"></a>   <span class="c">! Define track_tot_nstep</span>
<a name="ln-44"></a>   <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-45"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">dt_loc</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">)</span> <span class="n">p</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">((</span><span class="n">t_out</span><span class="o">-</span><span class="n">t_in</span><span class="p">)</span><span class="o">/</span><span class="n">dt_loc</span><span class="p">)</span>
<a name="ln-46"></a>   <span class="n">track_tot_nstep</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">dp</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="n">tkjump</span><span class="p">,</span><span class="n">dp</span><span class="p">))</span>
<a name="ln-47"></a>   <span class="n">ndv</span> <span class="o">=</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-48"></a>
<a name="ln-49"></a>   <span class="c">! Select particles on each mpi_task</span>
<a name="ln-50"></a>   <span class="c">! xp defined by tx1</span>
<a name="ln-51"></a>   <span class="c">! yp [-4,-3,-2.-1.,0,1,2,3,4], 9 test particles allocated</span>
<a name="ln-52"></a>   <span class="c">!</span>
<a name="ln-53"></a>   <span class="n">yy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ty1</span>
<a name="ln-54"></a>   <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">tp_numb</span>
<a name="ln-55"></a>    <span class="n">yy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">=</span> <span class="n">yy</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span>
<a name="ln-56"></a>   <span class="k">end do</span>
<a name="ln-57"></a><span class="k">   </span><span class="n">ym</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">imody</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-58"></a>   <span class="n">ymx</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">imody</span><span class="p">)%</span><span class="n">gmax</span>
<a name="ln-59"></a>   <span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-60"></a>   <span class="n">ik</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-61"></a>   <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-62"></a><span class="k">    deallocate</span> <span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">)</span>
<a name="ln-63"></a>    <span class="k">deallocate</span> <span class="p">(</span><span class="n">ebfp</span><span class="p">)</span>
<a name="ln-64"></a>    <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-65"></a>   <span class="k">end if</span>
<a name="ln-66"></a><span class="k">   select case</span> <span class="p">(</span><span class="n">ndim</span><span class="p">)</span>
<a name="ln-67"></a>   <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-68"></a>    <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tp_numb</span>
<a name="ln-69"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">ym</span><span class="o">&lt;</span><span class="n">yy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ymx</span><span class="o">&gt;=</span><span class="n">yy</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-70"></a><span class="k">      </span><span class="n">ik</span> <span class="o">=</span> <span class="n">ik</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-71"></a>     <span class="k">end if</span>
<a name="ln-72"></a><span class="k">    end do</span>
<a name="ln-73"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ik</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-74"></a><span class="k">     </span><span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ik</span>
<a name="ln-75"></a>     <span class="k">allocate</span> <span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">ik</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<a name="ln-76"></a>     <span class="n">np</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-77"></a>     <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tp_numb</span>
<a name="ln-78"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ym</span><span class="o">&lt;</span><span class="n">yy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ymx</span><span class="o">&gt;=</span><span class="n">yy</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-79"></a><span class="k">       </span><span class="n">np</span> <span class="o">=</span> <span class="n">np</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-80"></a>       <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">tx1</span>
<a name="ln-81"></a>       <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">yy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-82"></a>       <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">t0_pl</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-83"></a>       <span class="n">part_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">hp_int</span><span class="p">)</span>
<a name="ln-84"></a>       <span class="n">wgh</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sp</span><span class="p">)</span>
<a name="ln-85"></a>       <span class="n">charge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">hp_int</span><span class="p">)</span>
<a name="ln-86"></a>       <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">wgh_cmp</span>
<a name="ln-87"></a>      <span class="k">end if</span>
<a name="ln-88"></a><span class="k">     end do</span>
<a name="ln-89"></a><span class="k">    end if</span>
<a name="ln-90"></a><span class="k">   case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-91"></a>    <span class="k">return</span>
<a name="ln-92"></a><span class="k">   end select</span>
<a name="ln-93"></a><span class="k">   </span><span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-94"></a>   <span class="n">loc_tpart</span><span class="p">(</span><span class="n">mype</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">np</span>
<a name="ln-95"></a>   <span class="k">call </span><span class="n">intvec_distribute</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">loc_tpart</span><span class="p">,</span> <span class="n">npe</span><span class="p">)</span>
<a name="ln-96"></a>   <span class="n">track_tot_part</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-97"></a>   <span class="n">ik_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-98"></a>   <span class="n">last_ind</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-99"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">mype</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="n">last_ind</span> <span class="o">=</span> <span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-100"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">mype</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="n">last_ind</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">mype</span><span class="p">))</span>
<a name="ln-101"></a>   <span class="c">!if(loc_tpart(mype+1)&gt;0)write(6,*)&#39;last particle index&#39;,mype,last_ind</span>
<a name="ln-102"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-103"></a><span class="k">    do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-104"></a>     <span class="n">wgh_cmp</span> <span class="o">=</span> <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ndv</span><span class="p">)</span>
<a name="ln-105"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">part_ind</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">part_ind</span> <span class="o">=</span> <span class="n">part_ind</span> <span class="o">+</span> <span class="n">last_ind</span>
<a name="ln-106"></a>     <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ndv</span><span class="p">)</span> <span class="o">=</span> <span class="n">wgh_cmp</span>
<a name="ln-107"></a>    <span class="k">end do</span>
<a name="ln-108"></a><span class="k">   end if</span>
<a name="ln-109"></a><span class="k">   allocate</span> <span class="p">(</span><span class="n">track_aux</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ndv</span><span class="o">*</span><span class="n">ik_max</span><span class="p">))</span>
<a name="ln-110"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">ebfp</span><span class="p">))</span> <span class="k">allocate</span> <span class="p">(</span><span class="n">ebfp</span><span class="p">(</span><span class="n">ik_max</span><span class="p">,</span><span class="n">ndv</span><span class="p">))</span>
<a name="ln-111"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-112"></a><span class="k">    allocate</span> <span class="p">(</span><span class="n">pdata_tracking</span><span class="p">(</span><span class="n">ndv</span><span class="p">,</span><span class="n">track_tot_part</span><span class="p">,</span><span class="n">track_tot_nstep</span><span class="p">))</span>
<a name="ln-113"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;==== Initial track-Particle data===========&#39;</span>
<a name="ln-114"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;(a19,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;  tot_track_steps  &#39;</span><span class="p">,</span> <span class="n">track_tot_nstep</span>
<a name="ln-115"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;(a19,2i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;  tot_track_parts  &#39;</span><span class="p">,</span> <span class="n">track_tot_part</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-116"></a>      <span class="n">tp_numb</span>
<a name="ln-117"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;(a18,i8)&#39;</span><span class="p">)</span> <span class="s1">&#39;  short_int size  &#39;</span><span class="p">,</span> <span class="nb">huge</span><span class="p">(</span><span class="n">plab</span><span class="p">)</span>
<a name="ln-118"></a>    <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;(a20,e11.4)&#39;</span><span class="p">)</span> <span class="s1">&#39;  track memory(MB) &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-119"></a>      <span class="mf">1.e-06</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">ndv</span><span class="o">*</span><span class="n">track_tot_nstep</span><span class="o">*</span><span class="n">track_tot_part</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span>
<a name="ln-120"></a>   <span class="k">end if</span>
<a name="ln-121"></a><span class="k">  end subroutine</span>
<a name="ln-122"></a>  <span class="c">!============================================</span>
<a name="ln-123"></a>  <span class="k">subroutine </span><span class="n">t_particles_collect</span><span class="p">(</span><span class="n">time_ind</span><span class="p">)</span>
<a name="ln-124"></a>
<a name="ln-125"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">time_ind</span>
<a name="ln-126"></a>
<a name="ln-127"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">ik</span><span class="p">,</span> <span class="n">ik_max</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ndv</span><span class="p">,</span> <span class="n">ndvp</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">kk</span><span class="p">,</span> <span class="n">ik1</span><span class="p">,</span> <span class="n">ik2</span><span class="p">,</span> <span class="n">nst</span>
<a name="ln-128"></a>   <span class="kt">logical</span> <span class="kd">::</span> <span class="n">sr</span>
<a name="ln-129"></a>   <span class="kt">real</span> <span class="kd">::</span> <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">zm</span>
<a name="ln-130"></a>
<a name="ln-131"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">time_ind</span><span class="o">&gt;</span><span class="n">track_tot_nstep</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-132"></a><span class="k">   </span><span class="n">xm</span> <span class="o">=</span> <span class="n">loc_xgrid</span><span class="p">(</span><span class="n">imodx</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-133"></a>   <span class="n">ym</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">imody</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-134"></a>   <span class="n">zm</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">imodz</span><span class="p">)%</span><span class="n">gmin</span>
<a name="ln-135"></a>   <span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-136"></a>   <span class="n">nst</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-137"></a>   <span class="n">ndv</span> <span class="o">=</span> <span class="n">nd2</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-138"></a>   <span class="n">ndvp</span> <span class="o">=</span> <span class="n">ndv</span>
<a name="ln-139"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">stretch</span><span class="p">)</span> <span class="n">nst</span> <span class="o">=</span> <span class="n">str_indx</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">)</span>
<a name="ln-140"></a>   <span class="c">!===================</span>
<a name="ln-141"></a>   <span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-142"></a>   <span class="n">ik</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-143"></a>   <span class="c">!=========== each pe counts track particle number</span>
<a name="ln-144"></a>   <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-145"></a>    <span class="n">wgh_cmp</span> <span class="o">=</span> <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ndv</span><span class="p">)</span>
<a name="ln-146"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">part_ind</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">ik</span> <span class="o">=</span> <span class="n">ik</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-147"></a>   <span class="k">end do</span>
<a name="ln-148"></a><span class="k">   </span><span class="n">loc_tpart</span><span class="p">(</span><span class="n">mype</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ik</span>
<a name="ln-149"></a>   <span class="k">call </span><span class="n">intvec_distribute</span><span class="p">(</span><span class="n">ik</span><span class="p">,</span> <span class="n">loc_tpart</span><span class="p">,</span> <span class="n">npe</span><span class="p">)</span>
<a name="ln-150"></a>   <span class="n">ik_max</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">npe</span><span class="p">))</span>
<a name="ln-151"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">ndvp</span><span class="o">*</span><span class="n">ik_max</span><span class="o">&gt;</span><span class="n">size</span><span class="p">(</span><span class="n">track_aux</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-152"></a><span class="k">    deallocate</span> <span class="p">(</span><span class="n">track_aux</span><span class="p">)</span>
<a name="ln-153"></a>    <span class="k">allocate</span> <span class="p">(</span><span class="n">track_aux</span><span class="p">(</span><span class="n">ndvp</span><span class="o">*</span><span class="n">ik_max</span><span class="p">))</span>
<a name="ln-154"></a>   <span class="k">end if</span>
<a name="ln-155"></a>   <span class="c">!========= each pe stores tpart data in track_aux(ndv,loc_tpart)</span>
<a name="ln-156"></a>   <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-157"></a>   <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span>
<a name="ln-158"></a>    <span class="n">wgh_cmp</span> <span class="o">=</span> <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ndv</span><span class="p">)</span>
<a name="ln-159"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">part_ind</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-160"></a><span class="k">     do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ndv</span>
<a name="ln-161"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-162"></a>      <span class="n">track_aux</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="o">=</span> <span class="n">spec</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">part</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ip</span><span class="p">)</span>
<a name="ln-163"></a>     <span class="k">end do</span>
<a name="ln-164"></a><span class="k">    end if</span>
<a name="ln-165"></a><span class="k">   end do</span>
<a name="ln-166"></a>   <span class="c">!=================</span>
<a name="ln-167"></a>   <span class="c">!  all data are gathered onto pe0 </span>
<a name="ln-168"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">pe0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-169"></a><span class="k">    </span><span class="n">sr</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-170"></a>    <span class="n">ik1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-171"></a>    <span class="k">do </span><span class="n">ipe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npe</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-172"></a>     <span class="n">ik</span> <span class="o">=</span> <span class="n">loc_tpart</span><span class="p">(</span><span class="n">ipe</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-173"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">ik</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-174"></a><span class="k">      call </span><span class="n">exchange_1d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">track_aux</span><span class="p">,</span> <span class="n">ik</span><span class="o">*</span><span class="n">ndvp</span><span class="p">,</span> <span class="n">ipe</span><span class="p">,</span> <span class="n">ipe</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
<a name="ln-175"></a>      <span class="c">!pe0 receives from ipe ik sp_aux data and collects on track array</span>
<a name="ln-176"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-177"></a>      <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ik</span>
<a name="ln-178"></a>       <span class="n">ik2</span> <span class="o">=</span> <span class="n">ik1</span> <span class="o">+</span> <span class="n">p</span>
<a name="ln-179"></a>       <span class="k">do </span><span class="n">ip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ndv</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-180"></a>        <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-181"></a>        <span class="n">pdata_tracking</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">ik2</span><span class="p">,</span> <span class="n">time_ind</span><span class="p">)</span> <span class="o">=</span> <span class="n">track_aux</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-182"></a>        <span class="c">!pdata_tracking(ip,ik2,time_ind)=track_aux(kk)</span>
<a name="ln-183"></a>       <span class="k">end do</span>
<a name="ln-184"></a><span class="k">       </span><span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-185"></a>       <span class="n">wgh_cmp</span> <span class="o">=</span> <span class="n">track_aux</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-186"></a>       <span class="n">pdata_tracking</span><span class="p">(</span><span class="n">ndv</span><span class="p">,</span> <span class="n">ik2</span><span class="p">,</span> <span class="n">time_ind</span><span class="p">)</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">part_ind</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span>
<a name="ln-187"></a>      <span class="k">end do</span>
<a name="ln-188"></a><span class="k">      </span><span class="n">ik1</span> <span class="o">=</span> <span class="n">ik2</span>
<a name="ln-189"></a>     <span class="k">end if</span>
<a name="ln-190"></a><span class="k">    end do</span>
<a name="ln-191"></a><span class="k">    </span><span class="n">loc_tpart</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ik2</span>
<a name="ln-192"></a>   <span class="k">else</span>
<a name="ln-193"></a><span class="k">    </span><span class="n">ik</span> <span class="o">=</span> <span class="n">loc_tpart</span><span class="p">(</span><span class="n">mype</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-194"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ik</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-195"></a><span class="k">     </span><span class="n">sr</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-196"></a>     <span class="k">call </span><span class="n">exchange_1d_grdata</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">track_aux</span><span class="p">,</span> <span class="n">ik</span><span class="o">*</span><span class="n">ndvp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mype</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span> <span class="c">!sends ik data to pe0</span>
<a name="ln-197"></a>    <span class="k">end if</span>
<a name="ln-198"></a><span class="k">   end if</span>
<a name="ln-199"></a><span class="k">  end subroutine</span>
<a name="ln-200"></a>  <span class="c">!=================================================</span>
<a name="ln-201"></a>  <span class="k">subroutine </span><span class="n">fill_density_data</span><span class="p">(</span><span class="n">den</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-202"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">den</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:)</span>
<a name="ln-203"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ic</span>
<a name="ln-204"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">iz</span><span class="p">,</span> <span class="n">n_loc</span>
<a name="ln-205"></a>
<a name="ln-206"></a>   <span class="n">n_loc</span> <span class="o">=</span> <span class="n">loc_ygrid</span><span class="p">(</span><span class="n">imody</span><span class="p">)%</span><span class="n">ng</span>
<a name="ln-207"></a>   <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span>
<a name="ln-208"></a>    <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-209"></a>     <span class="n">iy</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">imody</span><span class="o">*</span><span class="n">n_loc</span>
<a name="ln-210"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">iy</span><span class="p">)</span><span class="o">&gt;</span><span class="n">ymin_t</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">y</span><span class="p">(</span><span class="n">iy</span><span class="p">)</span><span class="o">&lt;</span><span class="n">ymax_t</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-211"></a><span class="k">      do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-212"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">targ_in</span><span class="p">)</span> <span class="n">den</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">den</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span>
<a name="ln-213"></a>      <span class="k">end do</span>
<a name="ln-214"></a><span class="k">     end if</span>
<a name="ln-215"></a><span class="k">    end do</span>
<a name="ln-216"></a><span class="k">   end do</span>
<a name="ln-217"></a><span class="k">   if</span> <span class="p">(</span><span class="n">ndim</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-218"></a><span class="k">   </span><span class="n">n_loc</span> <span class="o">=</span> <span class="n">loc_zgrid</span><span class="p">(</span><span class="n">imodz</span><span class="p">)%</span><span class="n">ng</span>
<a name="ln-219"></a>   <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-220"></a>    <span class="n">iz</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">imodz</span><span class="o">*</span><span class="n">n_loc</span>
<a name="ln-221"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">z</span><span class="p">(</span><span class="n">iz</span><span class="p">)</span><span class="o">&gt;</span><span class="n">zmin_t</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">z</span><span class="p">(</span><span class="n">iz</span><span class="p">)</span><span class="o">&lt;</span><span class="n">zmax_t</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-222"></a><span class="k">     do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-223"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-224"></a>       <span class="n">den</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">=</span> <span class="n">den</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span>
<a name="ln-225"></a>      <span class="k">end do</span>
<a name="ln-226"></a><span class="k">     end do</span>
<a name="ln-227"></a><span class="k">    end if</span>
<a name="ln-228"></a><span class="k">   end do</span>
<a name="ln-229"></a><span class="k">  end subroutine</span>
<a name="ln-230"></a>  <span class="c">!=============================================</span>
<a name="ln-231"></a>  <span class="k">subroutine </span><span class="n">collect_bunch_and_plasma_density</span><span class="p">(</span><span class="n">this_bunch</span><span class="p">,</span> <span class="n">isp</span><span class="p">)</span>
<a name="ln-232"></a>
<a name="ln-233"></a>   <span class="c">!========== bunch density and particles of species isp added on jc(ic)</span>
<a name="ln-234"></a>   <span class="c">!=========================================</span>
<a name="ln-235"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">this_bunch</span><span class="p">,</span> <span class="n">isp</span>
<a name="ln-236"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dery</span><span class="p">,</span> <span class="n">derz</span>
<a name="ln-237"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="n">ik</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-238"></a>
<a name="ln-239"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<a name="ln-240"></a>    <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-241"></a>   <span class="k">end do</span>
<a name="ln-242"></a><span class="k">   </span><span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">isp</span><span class="p">)</span>
<a name="ln-243"></a>
<a name="ln-244"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">this_bunch</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-245"></a><span class="k">    do </span><span class="n">ik</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-246"></a>     <span class="n">nb</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ik</span><span class="p">)</span>
<a name="ln-247"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">nb</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-248"></a><span class="k">      call </span><span class="n">set_grid_charge</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="n">ik</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-249"></a>     <span class="k">end if</span>
<a name="ln-250"></a><span class="k">    end do</span>
<a name="ln-251"></a><span class="k">   else</span>
<a name="ln-252"></a><span class="k">    </span><span class="n">ik</span> <span class="o">=</span> <span class="n">this_bunch</span> <span class="c">!only the selected bunch density</span>
<a name="ln-253"></a>    <span class="n">nb</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ik</span><span class="p">)</span>
<a name="ln-254"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nb</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-255"></a><span class="k">     call </span><span class="n">set_grid_charge</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="n">ik</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">nb</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-256"></a>    <span class="k">end if</span>
<a name="ln-257"></a><span class="k">   end if</span>
<a name="ln-258"></a>   <span class="c">!=========== bunch data on jc(1)</span>
<a name="ln-259"></a>   <span class="c">!==================== data of isp species on jc(2)</span>
<a name="ln-260"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-261"></a><span class="k">    call </span><span class="n">set_grid_charge</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="n">isp</span><span class="p">),</span> <span class="n">ebfp</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-262"></a>   <span class="k">end if</span>
<a name="ln-263"></a><span class="k">   if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-264"></a><span class="k">    do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<a name="ln-265"></a>     <span class="k">call </span><span class="n">fill_curr_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-266"></a>    <span class="k">end do</span>
<a name="ln-267"></a><span class="k">   end if</span>
<a name="ln-268"></a><span class="k">   </span><span class="n">jc</span><span class="p">(</span><span class="n">ix1</span><span class="p">:</span><span class="n">ix2</span><span class="p">,</span> <span class="n">jy1</span><span class="p">:</span><span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">:</span><span class="n">kz2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">jc</span><span class="p">(</span><span class="n">ix1</span><span class="p">:</span><span class="n">ix2</span><span class="p">,</span> <span class="n">jy1</span><span class="p">:</span><span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">:</span><span class="n">kz2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-269"></a>     <span class="n">jc</span><span class="p">(</span><span class="n">ix1</span><span class="p">:</span><span class="n">ix2</span><span class="p">,</span> <span class="n">jy1</span><span class="p">:</span><span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">:</span><span class="n">kz2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-270"></a>   <span class="c">!============ on jc(1) bunch+ particles</span>
<a name="ln-271"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">stretch</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-272"></a><span class="k">    </span><span class="n">kk</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-273"></a>    <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span>
<a name="ln-274"></a>     <span class="n">derz</span> <span class="o">=</span> <span class="n">loc_zg</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imodz</span><span class="p">)</span>
<a name="ln-275"></a>     <span class="n">jj</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-276"></a>     <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span>
<a name="ln-277"></a>      <span class="n">dery</span> <span class="o">=</span> <span class="n">loc_yg</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imody</span><span class="p">)</span><span class="o">*</span><span class="n">derz</span>
<a name="ln-278"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span>
<a name="ln-279"></a>       <span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">dery</span><span class="o">*</span><span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-280"></a>       <span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">dery</span><span class="o">*</span><span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-281"></a>      <span class="k">end do</span>
<a name="ln-282"></a><span class="k">      </span><span class="n">jj</span> <span class="o">=</span> <span class="n">jj</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-283"></a>     <span class="k">end do</span>
<a name="ln-284"></a><span class="k">     </span><span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-285"></a>    <span class="k">end do</span>
<a name="ln-286"></a><span class="k">   end if</span>
<a name="ln-287"></a>   <span class="c">!=============================</span>
<a name="ln-288"></a>  <span class="k">end subroutine</span>
<a name="ln-289"></a>
<a name="ln-290"></a><span class="k">  subroutine </span><span class="n">prl_bden_energy_interp</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<a name="ln-291"></a>
<a name="ln-292"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ic</span>
<a name="ln-293"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dery</span><span class="p">,</span> <span class="n">derz</span>
<a name="ln-294"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">ik</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-295"></a>
<a name="ln-296"></a>   <span class="c">!curr_clean</span>
<a name="ln-297"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<a name="ln-298"></a>    <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-299"></a>   <span class="k">end do</span>
<a name="ln-300"></a><span class="k">   if</span> <span class="p">(</span><span class="n">ic</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">!collects all bunch density</span>
<a name="ln-301"></a>    <span class="k">do </span><span class="n">ik</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsb</span>
<a name="ln-302"></a>     <span class="n">np</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ik</span><span class="p">)</span>
<a name="ln-303"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-304"></a><span class="k">      call </span><span class="n">set_grid_den_energy</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="n">ik</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">)</span>
<a name="ln-305"></a>     <span class="k">end if</span>
<a name="ln-306"></a><span class="k">    end do</span>
<a name="ln-307"></a><span class="k">   else</span>
<a name="ln-308"></a><span class="k">    </span><span class="n">ik</span> <span class="o">=</span> <span class="n">ic</span> <span class="c">!only the ic-bunch density</span>
<a name="ln-309"></a>    <span class="n">np</span> <span class="o">=</span> <span class="n">loc_nbpart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ik</span><span class="p">)</span>
<a name="ln-310"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-311"></a><span class="k">     call </span><span class="n">set_grid_den_energy</span><span class="p">(</span><span class="n">bunch</span><span class="p">(</span><span class="n">ik</span><span class="p">),</span> <span class="n">ebfb</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">)</span>
<a name="ln-312"></a>    <span class="k">end if</span>
<a name="ln-313"></a><span class="k">   end if</span>
<a name="ln-314"></a>   <span class="c">!========= den on [i1-1:i2+2,j1-1:nyp+2,k1-1:nzp+2]</span>
<a name="ln-315"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-316"></a><span class="k">    call </span><span class="n">fill_curr_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-317"></a>   <span class="k">end if</span>
<a name="ln-318"></a>   <span class="c">!do ik=1,2</span>
<a name="ln-319"></a>   <span class="c">! call den_zyxbd(jc,i1,i2,j1,nyf,k1,nzf,ik)</span>
<a name="ln-320"></a>   <span class="c">!end do</span>
<a name="ln-321"></a>   <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span> <span class="c">!positive for electrons</span>
<a name="ln-322"></a>
<a name="ln-323"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">stretch</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-324"></a><span class="k">    </span><span class="n">kk</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-325"></a>    <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span>
<a name="ln-326"></a>     <span class="n">derz</span> <span class="o">=</span> <span class="n">loc_zg</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imodz</span><span class="p">)</span>
<a name="ln-327"></a>     <span class="n">jj</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-328"></a>     <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span>
<a name="ln-329"></a>      <span class="n">dery</span> <span class="o">=</span> <span class="n">loc_yg</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imody</span><span class="p">)</span><span class="o">*</span><span class="n">derz</span>
<a name="ln-330"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span>
<a name="ln-331"></a>       <span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">dery</span><span class="o">*</span><span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-332"></a>       <span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">dery</span><span class="o">*</span><span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-333"></a>      <span class="k">end do</span>
<a name="ln-334"></a><span class="k">      </span><span class="n">jj</span> <span class="o">=</span> <span class="n">jj</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-335"></a>     <span class="k">end do</span>
<a name="ln-336"></a><span class="k">     </span><span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-337"></a>    <span class="k">end do</span>
<a name="ln-338"></a><span class="k">   end if</span>
<a name="ln-339"></a>   <span class="c">!=============================</span>
<a name="ln-340"></a>  <span class="k">end subroutine</span>
<a name="ln-341"></a>  <span class="c">!============================</span>
<a name="ln-342"></a>  <span class="k">subroutine </span><span class="n">prl_den_energy_interp</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span><span class="n">cmp_out</span><span class="p">)</span>
<a name="ln-343"></a>   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ic</span><span class="p">,</span> <span class="n">cmp_out</span>
<a name="ln-344"></a>   <span class="kt">real</span> <span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dery</span><span class="p">,</span> <span class="n">derz</span><span class="p">,</span> <span class="n">ar</span><span class="p">,</span> <span class="n">ai</span>
<a name="ln-345"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-346"></a>
<a name="ln-347"></a>   <span class="c">!=============================</span>
<a name="ln-348"></a>   <span class="c">! nden=1 only charge density</span>
<a name="ln-349"></a>   <span class="c">! nden =2 charge and energy &lt;n(gamma-1)&gt; density</span>
<a name="ln-350"></a>   <span class="c">!=============================</span>
<a name="ln-351"></a>   <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cmp_out</span>
<a name="ln-352"></a>    <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-353"></a>   <span class="k">end do</span>
<a name="ln-354"></a>   <span class="c">!===========================</span>
<a name="ln-355"></a>   <span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-356"></a>   <span class="k">if</span><span class="p">(</span><span class="n">part</span><span class="p">)</span><span class="k">then</span>
<a name="ln-357"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">cmp_out</span><span class="p">)</span>
<a name="ln-358"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-359"></a>     <span class="k">call </span><span class="n">set_grid_charge</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="n">ic</span><span class="p">),</span> <span class="n">ebfp</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-360"></a>     <span class="c">!nden=1 exit density for each ic species</span>
<a name="ln-361"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-362"></a>     <span class="c">!nden=2 exit density and energy density for each species</span>
<a name="ln-363"></a>     <span class="k">if</span> <span class="p">(</span><span class="n">envelope</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-364"></a><span class="k">      if</span><span class="p">(</span><span class="n">ic</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="k">then</span>
<a name="ln-365"></a><span class="k">       do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span>
<a name="ln-366"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span>
<a name="ln-367"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span>
<a name="ln-368"></a>          <span class="n">ar</span> <span class="o">=</span> <span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">env</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">env</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-369"></a>          <span class="n">ai</span> <span class="o">=</span> <span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">env</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">env</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<a name="ln-370"></a>          <span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">ar</span><span class="o">*</span><span class="n">ar</span><span class="o">+</span><span class="n">ai</span><span class="o">*</span><span class="n">ai</span><span class="p">)</span>
<a name="ln-371"></a>         <span class="k">end do</span>
<a name="ln-372"></a><span class="k">        end do</span>
<a name="ln-373"></a><span class="k">       end do</span>
<a name="ln-374"></a><span class="k">       if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">call </span><span class="n">fill_ebfield_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-375"></a>       <span class="k">call </span><span class="n">set_grid_env_den_energy</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="n">ic</span><span class="p">),</span> <span class="n">ebfp</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-376"></a>      <span class="k">else</span>
<a name="ln-377"></a><span class="k">       call </span><span class="n">set_grid_den_energy</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="n">ic</span><span class="p">),</span> <span class="n">ebfp</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">)</span> <span class="c">!ic &gt;1 in envelope scheme</span>
<a name="ln-378"></a>      <span class="n">endif</span>
<a name="ln-379"></a>     <span class="k">else</span>
<a name="ln-380"></a><span class="k">      call </span><span class="n">set_grid_den_energy</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="n">ic</span><span class="p">),</span> <span class="n">ebfp</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">)</span>
<a name="ln-381"></a>     <span class="c">! in jc(1) is plasma norm density in jc(2) &lt;(gam-1)density&gt; using kinetic</span>
<a name="ln-382"></a>     <span class="c">! gamma  for each species</span>
<a name="ln-383"></a>     <span class="k">end if</span>
<a name="ln-384"></a><span class="k">    end select</span>
<a name="ln-385"></a><span class="k">    if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">call </span><span class="n">fill_curr_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span><span class="n">cmp_out</span><span class="p">)</span>
<a name="ln-386"></a>    <span class="k">do </span><span class="n">kk</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cmp_out</span>
<a name="ln-387"></a>     <span class="k">call </span><span class="n">den_zyxbd</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">kk</span><span class="p">)</span>
<a name="ln-388"></a>    <span class="k">end do</span>
<a name="ln-389"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ic</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-390"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">cmp_out</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">mass</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span><span class="o">*</span><span class="n">electron_mass</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-391"></a>     <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-392"></a>   <span class="c">!=========== energy density in Mev*n/n_0</span>
<a name="ln-393"></a>
<a name="ln-394"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">stretch</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-395"></a><span class="k">     select case</span> <span class="p">(</span><span class="n">ndim</span><span class="p">)</span>
<a name="ln-396"></a>     <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-397"></a>     <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-398"></a>     <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span>
<a name="ln-399"></a>      <span class="n">jj</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-400"></a>      <span class="n">dery</span> <span class="o">=</span> <span class="n">loc_yg</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imody</span><span class="p">)</span>
<a name="ln-401"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span>
<a name="ln-402"></a>       <span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">cmp_out</span><span class="p">)</span> <span class="o">=</span> <span class="n">dery</span><span class="o">*</span><span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">cmp_out</span><span class="p">)</span>
<a name="ln-403"></a>      <span class="k">end do</span>
<a name="ln-404"></a><span class="k">     end do</span>
<a name="ln-405"></a><span class="k">     case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-406"></a>     <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kz1</span><span class="p">,</span> <span class="n">kz2</span>
<a name="ln-407"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-408"></a>      <span class="n">derz</span> <span class="o">=</span> <span class="n">loc_zg</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imodz</span><span class="p">)</span>
<a name="ln-409"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jy1</span><span class="p">,</span> <span class="n">jy2</span>
<a name="ln-410"></a>       <span class="n">jj</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span>
<a name="ln-411"></a>       <span class="n">dery</span> <span class="o">=</span> <span class="n">loc_yg</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imody</span><span class="p">)</span><span class="o">*</span><span class="n">derz</span>
<a name="ln-412"></a>       <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span>
<a name="ln-413"></a>        <span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">cmp_out</span><span class="p">)</span> <span class="o">=</span> <span class="n">dery</span><span class="o">*</span><span class="n">jc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">cmp_out</span><span class="p">)</span>
<a name="ln-414"></a>       <span class="k">end do</span>
<a name="ln-415"></a><span class="k">      end do</span>
<a name="ln-416"></a><span class="k">     end do</span>
<a name="ln-417"></a><span class="k">     end select</span>
<a name="ln-418"></a><span class="k">    end if</span>
<a name="ln-419"></a><span class="k">   </span><span class="n">endif</span>
<a name="ln-420"></a>   <span class="c">!======================</span>
<a name="ln-421"></a>  <span class="k">end subroutine</span>
<a name="ln-422"></a>  <span class="c">!=====================</span>
<a name="ln-423"></a>  <span class="k">subroutine </span><span class="n">set_wake_potential</span>
<a name="ln-424"></a>
<a name="ln-425"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">np</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span>
<a name="ln-426"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">k1</span><span class="p">,</span><span class="n">k2</span>
<a name="ln-427"></a>
<a name="ln-428"></a>   <span class="n">jc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-429"></a>   <span class="c">!curr_clean</span>
<a name="ln-430"></a>   <span class="k">do </span><span class="n">ic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsp</span>
<a name="ln-431"></a>    <span class="n">np</span> <span class="o">=</span> <span class="n">loc_npart</span><span class="p">(</span><span class="n">imody</span><span class="p">,</span> <span class="n">imodz</span><span class="p">,</span> <span class="n">imodx</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
<a name="ln-432"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">set_grid_charge_and_jx</span><span class="p">(</span><span class="n">spec</span><span class="p">(</span><span class="n">ic</span><span class="p">),</span> <span class="n">ebfp</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">np</span><span class="p">)</span>
<a name="ln-433"></a>   <span class="k">end do</span>
<a name="ln-434"></a>   <span class="c">!========= jc(1)=charge density jc(2)= Jx at the same current t^{n} time</span>
<a name="ln-435"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">prl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-436"></a><span class="k">    call </span><span class="n">fill_curr_yzxbdsdata</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-437"></a>   <span class="k">end if</span>
<a name="ln-438"></a><span class="k">   if</span> <span class="p">(</span><span class="n">nsp</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-439"></a><span class="k">    call </span><span class="n">fill_density_data</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-440"></a>   <span class="k">else</span>
<a name="ln-441"></a><span class="k">    if</span> <span class="p">(</span><span class="n">dmodel_id</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span> <span class="k">call </span><span class="n">fill_density_data</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-442"></a>   <span class="k">end if</span>
<a name="ln-443"></a><span class="k">   </span><span class="n">jc</span><span class="p">(</span><span class="n">ix1</span><span class="p">:</span><span class="n">ix2</span><span class="p">,</span> <span class="n">jy1</span><span class="p">:</span><span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">:</span><span class="n">kz2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">jc</span><span class="p">(</span><span class="n">ix1</span><span class="p">:</span><span class="n">ix2</span><span class="p">,</span> <span class="n">jy1</span><span class="p">:</span><span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">:</span><span class="n">kz2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">&amp;</span>
<a name="ln-444"></a>     <span class="n">jc</span><span class="p">(</span><span class="n">ix1</span><span class="p">:</span><span class="n">ix2</span><span class="p">,</span> <span class="n">jy1</span><span class="p">:</span><span class="n">jy2</span><span class="p">,</span> <span class="n">kz1</span><span class="p">:</span><span class="n">kz2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-445"></a>   <span class="c">!============== jc(1)=rho-Jx=======================</span>
<a name="ln-446"></a>
<a name="ln-447"></a>   <span class="n">ft_mod</span> <span class="o">=</span> <span class="mi">2</span> <span class="c">!for cosine transform</span>
<a name="ln-448"></a>   <span class="n">ft_sym</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-449"></a>   <span class="k">call </span><span class="n">fft_2d_psolv</span><span class="p">(</span><span class="n">jc</span><span class="p">,</span> <span class="n">jc</span><span class="p">,</span> <span class="n">ompe</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">nx_loc</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">ny_loc</span><span class="p">,</span> <span class="n">nz</span><span class="p">,</span> <span class="n">nz_loc</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-450"></a>     <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">ft_mod</span><span class="p">,</span> <span class="n">ft_sym</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-451"></a>
<a name="ln-452"></a>   <span class="c">!==================================</span>
<a name="ln-453"></a>  <span class="k">end subroutine</span>
<a name="ln-454"></a>  <span class="c">!============================</span>
<a name="ln-455"></a> <span class="k">end module</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-01-29 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ALaDyn was developed by The ALaDyn Collaboration</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>